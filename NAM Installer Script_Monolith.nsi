/*
 * !_ Network Addon Mod Installer _!
 *
 * !_ The following is essential information for adding new options to the installer. _!
 *
 * In former versions of this installer, information for options needed to be added only
 * under Sections and the section description.  Now there are many more places where 
 * information about options must be added; not all of them are required for all options.
 * Detailed descriptions of these routines are included in a comment section preceding
 * them; these comment sections start with a red text line to make them easier to find.
 * (This assumes that you are using the NSIS UDL written by z for Notepad++.)
 *
 * The following places always require new entries when adding new options.
 * See each place individually for comments.
 *
 * 1. Sections
 * 2. ConfirmText()
 * 3. Section descriptions
 * 4. GetOldComponents()
 *
 * The following routine requires new entries in the first part of the main table whenever
 * adding transit stations or textures that have previously been available outside the NAM.
 *
 * 5. DeleteDuplicates()
 *
 * The following routine requires entries whenever radio button options are added.
 *
 * 6. .onSelChange()  (top part)
 *
 * The following routine requires entries whenever bridges or transit stations are added
 * that belong to networks that are optional.
 *
 * 7. .onSelChange()  (bottom part)
 *
 * The list of station overrides needs to be extended whenever new overridden stations are added.
 *
 * 8. StationOverride section macros at end of main sections
 */

;Script originally generated by the HM NIS Edit Script Wizard.

; This defines compression method
;SetCompressor /SOLID lzma
SetCompress off
RequestExecutionLevel highest
MiscButtonText "" "" "&Cancel"
BrandingText "Network Addon Mod Setup"

; HM NIS Edit Wizard helper defines
!define PRODUCT_NAME "Network Addon Mod"
!define PRODUCT_VERSION "36-Alpha02"
!define PRODUCT_PUBLISHER "The NAM Team"
!define PRODUCT_WEB_SITE "http://www.sc4devotion.com"
!define PRODUCT_UNINST_KEY "Software\Microsoft\Windows\CurrentVersion\Uninstall\${PRODUCT_NAME}"
!define PRODUCT_UNINST_ROOT_KEY "HKCU"

;--------------------------------
!include "UMUI.nsh"
!include "Sections.nsh"
!include "FileFunc.nsh"
!include "StrFunc.nsh"
!include "defines.nsh"        ;For Dialogs plugin
!include "WinVer.nsh"

Var AdminAbort
Var AlreadyInstalled
Var ButtonGroup1
Var ButtonGroup2
Var ButtonGroup3
Var ButtonGroup4
Var ButtonGroup5
Var ButtonGroup6
Var ButtonGroup7
Var ButtonGroup8
Var ButtonGroup9
Var ButtonGroup10
Var ButtonGroup11
Var ButtonGroup12
Var ButtonGroup13
Var CalledNWMCore
Var CalledRHWCore
Var CalledSAMCore
Var Cleanitol
Var CleanitolDir
Var CompilerDir
Var ConfElevatedRoad
Var ConfElRail
Var ConfElRailOverRoad
Var ConfGLR
Var ConfMonorail
Var ConfMultiPurpose
Var ConfRail
Var ConfStationOverride
Var ConfTramInAvenue
Var ConfTramInRoad
Var ConfTramInStreet
Var ConfTransitions
Var DirectoryWarning
Var ElRailAlt
Var Eseries
Var InstalledBTM
Var InstalledDoubleHeightElRail
Var InstalledDoubleHeightMonorail
Var InstalledElevatedRoad
Var InstalledElRailOverAvenue
Var InstalledElRailOverRoad
Var InstalledGLR
Var InstalledGoltzschViaduct
Var InstalledHSR
Var InstalledNWM
Var InstalledRailTexture
Var InstalledRHW
Var InstalledRoyalAlbert
Var InstalledRRW
Var InstalledSAM
Var InstalledSAMBridges
Var InstalledSTR
Var InstalledTramInAvenue
Var InstalledTramInRoad
Var InstalledTramInStreet
Var InstalledViaductRail
Var KeepOldSimulator
Var CustomizeSimulator
Var bRight
Var LanguageKnown
Var LanguageReminder
Var LastLoadDir
Var Memory
Var MonolithicNAM
Var NAMAuxDir
Var NAMOldVersion
Var NewNAM
Var OldInstallDir
Var OSLang
Var ParentNode
Var PersistentAutomata
Var RHWNR
Var SavedElRailOverAvenue
Var SavedElevatedRoad
Var SavedGLR
Var SavedHSR
Var SavedNWM
Var SavedRHW1
Var SavedRHW2
Var SavedSAM
Var SC4Docs
Var SC4Exec
Var SC4Lang
Var SC4InstallDir
Var SelectCount
Var Sseries
Var WindowsArchitecture
Var Wine
Var WriteController
Var z___NAM

;Initializations

!insertmacro DirState
!insertmacro Locate
${StrStr}             ;This makes no sense at all.  But it's necessary...
${StrLoc}

; Add splash screen
!define UMUI_LEFTIMAGE_BMP "NAM36Sidebar-Alpha.bmp"
!define MUI_WELCOMEFINISHPAGE_BITMAP "NAM.bmp" ; the logo on the left of the first installer screen - 164x314 pixels by default
!define MUI_WELCOMEPAGE_TITLE_3LINES ; default is 2 lines, but 3 might be better if you have a long title
!define MUI_FINISHPAGE_TITLE_3LINES
!define MUI_WELCOMEPAGE_TEXT "This program allows you to install $(^NameDA) on your computer.\r\n\nIt is strongly recommended that before proceeding, you ensure that SimCity 4 and its related tools are not running.\r\n\nIf you do not wish to install $(^NameDA), click 'Cancel' now; otherwise click 'Next' to continue."
!define MUI_COMPONENTSPAGE_TEXT_COMPLIST "Optionally modify any of the$\r$\ncomponents in this installation type:"

; MUI Settings
!define MUI_ABORTWARNING
!define MUI_ICON "NAM logo.ico"
!define MUI_UNICON "${NSISDIR}\Contrib\Graphics\Icons\modern-uninstall.ico"
;!define MUI_HEADERIMAGE
;!define MUI_HEADERIMAGE_BITMAP "NAM_logo.bmp" ; the logo in the top right corner of the other installer screens - 150x57 pixels by default
;!define MUI_HEADERIMAGE_RIGHT
!define MUI_UI_COMPONENTSPAGE_SMALLDESC "UltraModern_smalldesc.exe"
!define MUI_COMPONENTSPAGE_SMALLDESC

; Language Selection Dialog Settings
!define UMUI_LANGDLL_REGISTRY_ROOT "${PRODUCT_UNINST_ROOT_KEY}"
!define UMUI_LANGDLL_REGISTRY_KEY "${PRODUCT_UNINST_KEY}"
!define UMUI_LANGDLL_REGISTRY_VALUENAME "NSIS:Language"

; Welcome page
!define MUI_PAGE_HEADER_TEXT "$(^NameDA) Installer"
!insertmacro MUI_PAGE_WELCOME
; License page
;!define MUI_LICENSEPAGE_RADIOBUTTONS
!insertmacro MUI_PAGE_LICENSE "license_english.txt" ; a simple TXT file, keep it together with the BMP logos in the same folder where this installer script is located
!define UMUI_USE_INSTALLOPTIONSEX
!define UMUI_INFORMATIONPAGE_USE_RICHTEXTFORMAT
!define UMUI_INFORMATIONPAGE_TEXT "Important information concerning the installation of $(^NameDA)"   
!insertmacro UMUI_PAGE_INFORMATION "Information.rtf"
!define UMUI_MAINTENANCEPAGE_MODIFY
!define UMUI_MAINTENANCEPAGE_REPAIR
!define UMUI_MAINTENANCEPAGE_REMOVE
!define UMUI_MAINTENANCEPAGE_CONTINUE_SETUP
;!insertmacro UMUI_PAGE_MAINTENANCE
!define UMUI_SETUPTYPEPAGE_TEXT "Please select a setup type.  If you want want to choose individual components, or select options that override standard SimCity 4 features, please select the Custom Installation."
!define UMUI_SETUPTYPEPAGE_MINIMAL_TITLE "&Traffic Simulator and Maxis Fixes Only"
!define UMUI_SETUPTYPEPAGE_MINIMAL_TEXT "The NAM traffic simulator will be installed, along with the Traffic Simulator Configuration Tool, the NAM Traffic Data Views, and the standard version of the NAM automata controller.  None of the NAM networks will be installed."
!define UMUI_SETUPTYPEPAGE_MINIMAL "Traffic Simulator and Maxis Fixes Only"
!define UMUI_SETUPTYPEPAGE_STANDARD_TITLE "N&etworks and Traffic Simulator"
!define UMUI_SETUPTYPEPAGE_STANDARD_TEXT "This is equivalent to the traffic simulator installation above, with the addition of all the NAM networks (except the Bullet Train Mod and Maxis Highway Override), all transit lots (e.g., stations), additional bridges, and certain other required options."
!define UMUI_SETUPTYPEPAGE_STANDARD "Networks and Traffic Simulator"
!define UMUI_SETUPTYPEPAGE_COMPLETE "Complete Installation"
!define UMUI_SETUPTYPEPAGE_COMPLETE_TITLE "C&omplete Standard Installation"
!define UMUI_SETUPTYPEPAGE_COMPLETE_TEXT "All standard features of the NAM will be installed, including  networks, bridges, all components of the traffic simulator, custom menu icons, extended queries, Maxis highway additions, roundabouts, all turning lane types, and wide radius curves."
!define UMUI_SETUPTYPEPAGE_CUSTOM_TITLE "C&ustom Installation"
!define UMUI_SETUPTYPEPAGE_CUSTOM_TEXT "Choose which of the components of the complete installation you want installed, as well as the type of traffic simulator and automata controller, rail viaduct and texture styles, one-way arrow mods, and the NAM installation location."
!define UMUI_SETUPTYPEPAGE_DEFAULTCHOICE ${UMUI_COMPLETE}
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE SetupTypeLeave
!insertmacro UMUI_PAGE_SETUPTYPE
!define MUI_DIRECTORYPAGE_TEXT_TOP "Setup will install $(^NameDA) in the following folder. To install in a different folder, click Browse and select another folder.$\r$\n$\nIn general, it is recommended that you install the NAM in the selected folder.  You can also install the NAM in the SimCity 4 Plugins folder if you like.  In any case, the NAM must be installed somewhere in your Plugins hierarchy. $DirectoryWarning"
!define MUI_DIRECTORYPAGE_TEXT_DESTINATION "Destination Folder (Must contain $\"Plugins$\" in the path)"
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE CheckDir
!insertmacro MUI_PAGE_DIRECTORY
; Components page
Page custom GetOldComponents                ; Must be separate page so it never gets skipped.
!define MUI_PAGE_CUSTOMFUNCTION_LEAVE ComponentsLeave
!insertmacro MUI_PAGE_COMPONENTS
!define UMUI_TEXT_INSTCONFIRM_TEXTBOX_TITLE "Selected Configuration:"
!define UMUI_CONFIRMPAGE_TEXTBOX ConfirmText
!insertmacro UMUI_PAGE_CONFIRM
!define MUI_PAGE_CUSTOMFUNCTION_PRE RecordNAM
!insertmacro MUI_PAGE_INSTFILES
; Finish page
!define MUI_FINISHPAGE_TEXT "$(^NameDA) has been installed on your computer.  It is strongly recommended that you view the ReadMe file, as it contains much valuable information about the use of the NAM.  If you wish to view the documentation later, you can find it in the $\"Documentation$\" subfolder of the $\"NAM Auxiliary Files$\" folder.\r\n\nIf you are installing this version of the NAM over an older, existing version, please leave the first checkbox checked.  This simply ensures that your traffic simulator and/or customizer are updated to the latest version."
!define MUI_FINISHPAGE_TEXT_LARGE
!define MUI_FINISHPAGE_RUN
!define MUI_FINISHPAGE_RUN_TEXT "&Install/Start Traffic Simulator Configuration Tool                                                     (also allows customization of new Data Views)"
!define MUI_FINISHPAGE_RUN_FUNCTION LaunchTSCT
!define MUI_FINISHPAGE_SHOWREADME "$NAMAuxDir\Documentation\Read First-NAM 34.htm" ; the path of your readme file, once it is installed
!define MUI_PAGE_CUSTOMFUNCTION_PRE CheckTSCT
!insertmacro MUI_PAGE_FINISH
!define MUI_CUSTOMFUNCTION_ABORT AbortNAM

; Uninstaller pages
!insertmacro MUI_UNPAGE_INSTFILES

; MUI end ------
!include "NAM Languages.nsh"

Name "${PRODUCT_NAME} ${PRODUCT_VERSION}"
OutFile "NetworkAddonMod Setup ${PRODUCT_VERSION}.exe"
InstallDir "$DOCUMENTS\SimCity 4\Plugins\Network Addon Mod"
ShowInstDetails show
ShowUnInstDetails show

; Setting pre-defined installation types
InstType "Traffic Simulator and Maxis Fixes Only"
InstType "Networks and Traffic Simulator"
InstType "Complete Installation"
InstType "/CUSTOMSTRING=Custom Installation"

; Defining Groups for the components selection page
Section "Main NAM Files" sec1 ; sec1 is a short name for description reference (see below)
SectionIn RO ; RO means read-only, so the user cannot deselect this
SectionIn 1 2 3 4 ; in which installation types (defined above) this section will show up
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  Delete "$INSTDIR\uninst_*.exe"
  Delete "$INSTDIR\Data Views\NetworkAddonMod_Zone_Data_View.dat"
  Call SaveTrafficSim
  Delete "$INSTDIR\NetworkAddonMod*.dat"
  Delete "$INSTDIR\Additional Bridges\Additional Bridges.txt"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_Additional_Bridges_Plugin.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-2_Concrete_Girder_Bridge.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-2_Small_Steel_Arch_Bridge.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-4_Large_Steel_Arch_Bridge.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-4_Steel_Girder_Bridge.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-4_Steel_Girder_Bridge_Dual.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-4_Suspension_Bridge_Compact.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-6S_Cable-Stayed_Bridge_Compact.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-6S_Concrete_Arch_Bridge.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-6S_Concrete_Arch_Bridge_Dual.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-6S_Steel_Arch_Bridge_Compact.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-8S_Undertruss_Bridge.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-10S_Cable_Stayed_Bridge.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-10S_Large_Concrete_Arch.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_RHW-MIS_Bridges.dat"
  Delete "$INSTDIR\Additional Bridges\NetworkAddonMod_Rural_Street_and_Rail_Bridge.dat"
  RMDir /r "$INSTDIR\Additional Bridges\Avenue Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Bridge Props and Models"
  RMDir /r "$INSTDIR\Additional Bridges\El Rail Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Elevated Highway Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Ground Highway Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Monorail Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Network Widening Mod Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Railway Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Real Highway Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Real Railway Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Road Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Rural Street and Rail Bridge"
  RMDir /r "$INSTDIR\Additional Bridges\Street Addon Mod Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Street Bridges"
  RMDir /r "$INSTDIR\Additional Bridges\Tram in Road Bridges"
  RMDir /r "$INSTDIR\Bullet Train Mod"
  RMDir /r "$INSTDIR\Canal Addon Mod"
  RMDir /r "$INSTDIR\Cosmetic Addons"
  RMDir /r "$INSTDIR\Custom Menu Icon Layouts"
  RMDir /r "$INSTDIR\Data Views"
  RMDir /r "$INSTDIR\Diagonal Streets"
  RMDir /r "$INSTDIR\El Rail"
  RMDir /r "$INSTDIR\Fractionally Angled Networks"
  RMDir /r "$INSTDIR\Flexible Underpasses"
  RMDir /r "$INSTDIR\High Elevated Monorail"
  RMDir /r "$INSTDIR\High Speed Rail Project"
  RMDir /r "$INSTDIR\Hole Diggers and Ground Raisers"
  RMDir /r "$INSTDIR\Locale Files"
  RMDir /r "$INSTDIR\Maxis Highway Override"
  RMDir /r "$INSTDIR\Network Widening Mod"
  RMDir /r "$INSTDIR\Rail"
  RMDir /r "$INSTDIR\Railway Addon Mod"
  RMDir /r "$INSTDIR\Rail Textures"
  RMDir /r "$INSTDIR\Real Highway Mod"
  RMDir /r "$INSTDIR\Roundabouts"
  RMDir /r "$INSTDIR\Rural Roads Plugin"
  RMDir /r "$INSTDIR\Street Addon Mod"
  RMDir /r "$INSTDIR\Traffic Simulator"
  RMDir /r "$INSTDIR\Traffic Simulator Configuration Tool"
  RMDir /r "$INSTDIR\Ground Light Rail"
  RMDir /r "$INSTDIR\Turning Lanes"
  RMDir /r "$INSTDIR\Wide Radius Curves"
  RMDir /r "$INSTDIR\z_Left Hand Plugin"
  RMDir /r "$NAMAuxDir\Documentation"
  RMDir /r "$NAMAuxDir\Tools\Controller Compiler"
  RMDir /r "$z___NAM\El Rail Alternate Implementation"
  RMDir /r "$z___NAM\Mass Transit Lots"
  RMDir /r "$z___NAM\Maxis Highway Override"
  RMDir /r "$z___NAM\MTA Station Overrides"
  RMDir /r "$z___NAM\Road Textures"
  RMDir /r "$z___NAM\Shinkansen Bullet Train Mod"
  RMDir /r "$z___NAM\z Props and Models"
  StrCpy $0 "$SC4Docs\SimCity 4"
  Call DeleteCompressedNAM
  StrCpy $0 $SC4InstallDir
  Call DeleteCompressedNAM
  RMDir /r "$INSTDIR\Automata Controller"
  RMDir /r "$INSTDIR\High Speed Rail Project"
  RMDir /r "$INSTDIR\Network Widening Mod"
  RMDir /r "$INSTDIR\Plugins"
  RMDir /r "$INSTDIR\Railway Addon Mod"
  RMDir /r "$INSTDIR\Real Highway Mod"
  RMDir /r "$INSTDIR\Rural Roads Plugin"
  RMDir /r "$INSTDIR\Street Addon Mod"
  Call ClearStations
  ${If} $Cleanitol > 0
    File /r "Tools\BSC Cleanitol TM"
    !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
      File "Cleanitol_NetworkAddonMod.txt"  
      StrCpy $5 "Cleanitol_NetworkAddonMod.txt"
    !insertmacro UMUI_ENDIF_INSTALLFLAG
    !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_MINIMAL}
      File "Cleanitol_NAM_TrafficSimulator.txt"
      StrCpy $5 "Cleanitol_NAM_TrafficSimulator.txt"
    !insertmacro UMUI_ENDIF_INSTALLFLAG
    MessageBox MB_OK|MB_ICONEXCLAMATION "The Cleanitol program will now be run in your Plugins folders to remove any files that conflict with the NAM.  These files will be moved to a backup folder whose name will be displayed by Cleanitol.  This process may take a while; please be patient and let it run to completion.$\r$\n$\r$\nSome mass transit stations or lots that you have installed separately may show up in your Cleanitol output.  These lots are not being deleted from the game, but are being upgraded to NAM Standard lots.$\r$\n$\r$\nWhen Cleanitol finishes, after optionally examining the results, please press Cleanitol's Quit button."
    StrCpy $0 "$SC4Docs\SimCity 4\Plugins"
    Call CheckDatPacked
    StrCpy $0 "$SC4InstallDir\Plugins"
    Call CheckDatPacked
    ExecWait '"$INSTDIR\BSC Cleanitol TM\BSC Cleanitol TM.exe" $5'
    RMDir /r "$INSTDIR\BSC Cleanitol TM"
    Delete "$INSTDIR\Cleanitol_NetworkAddonMod.txt"
    Delete "$INSTDIR\Cleanitol_NAM_TrafficSimulator.txt"
    Call DeleteDuplicates
  ${EndIf}
  Call UpdateStations
  SetOutPath "$INSTDIR"
  File "NAM logo.ico"
  !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
    StrCpy $WriteController 1
    Call ProcessController
    SetOutPath "$INSTDIR"
    File "NetworkAddonMod_IndividualNetworkRULs.dat"
    File "NetworkAddonMod_Bridges_Plugin_Controller.dat"
    File "NetworkAddonMod_a_Controller_Marker.dat"
    File "NetworkAddonMod_a_EP1Paths.dat"
    File "NetworkAddonMod_UI.dat"
    File "NetworkAddonMod_BaseContent.dat"
    File "NetworkAddonMod_BridgeSupport.dat"
    File "NetworkAddonMod_Props.dat"
    SetOutPath "$INSTDIR\Cosmetic Addons"
    File "Cosmetic Addons\NetworkAddonMod_OverpassUpdate_Maxis_Components_Plugin.dat"
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  SetOutPath "$INSTDIR\Locale Files"
  File "Locale Files\*.dat"
SectionEnd

Function CheckDatPacked
CDP0:
  StrCpy $1 "$0\Plugins_Compressed"
  ${DirState} $1 $2
  ${If} $2 = 1
CDP1:
    MessageBox MB_ABORTRETRYIGNORE|MB_DEFBUTTON2|MB_ICONEXCLAMATION "The NAM installer has detected a folder of DatPacked files in $1.  As Cleanitol cannot search DatPacked files, please remove this folder temporarily from your Plugins folder and replace it with the original, uncompressed files.  If Cleanitol makes no changes to these files, you can simply move them back and return the Plugins_Compressed folder to its place.  However, if Cleanitol makes any changes to these files, you should recompress them using the DatPacker, and remove your old Plugins_Compressed folder.$\r$\n$\nSelect $\"Abort$\" to abort the installation.  Select $\"Retry$\" if you have replaced your Plugins_Compressed folder with the original files.  Select $\"Ignore$\" to ignore this problem and just continue (not recommended)." IDRETRY CDP0 IDIGNORE CDP2
    MessageBox MB_YESNO|MB_DEFBUTTON2|MB_ICONQUESTION "Your current NAM has already been uninstalled, and you will have to reinstall the NAM if you wish to use it.  Are you sure you want to abort the installation?" IDNO CDP1
    RMDir /r $INSTDIR
    DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}"
    DeleteRegKey HKCU "Software\Network Addon Mod"
    Abort "Installation aborted."
CDP2:
    MessageBox MB_YESNO|MB_DEFBUTTON2|MB_ICONQUESTION "Are you sure you want to continue without having Cleanitol do a full job?  This may result in various unknown problems in using the NAM." IDNO CDP0
  ${EndIf}
FunctionEnd

Section "Documentation" sec2
SectionIn RO ; Documentation optimally should be installed. Note, if user doesnt install readme files the finsh page can't display the readme file.
SectionIn 1 2 3 4
  SetOutPath $NAMAuxDir
  SetOverwrite ifnewer
  File /r "Documentation"
  SetOutPath "$NAMAuxDir\Documentation"
  File "Information*.rtf"
  SetOutPath "$NAMAuxDir\Documentation"
  File /r /x "*.dat" /x "Additional Bridges.txt" "Additional Bridges"
SectionEnd

Section /o "Run Cleanitol and the Station Updater" sec4
SectionEnd

SectionGroup /e "Traffic Driving Side" sec3
Section "Game traffic drives on right side of road" controller1
SectionIn 2 3 4
SectionEnd

Section /o "Game traffic drives on left side of road" controller2
  !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
    SetOutPath "$INSTDIR\z_Left Hand Plugin"
    SetOverwrite ifnewer
    File "z_Left Hand Plugin\NetworkAddonMod_LEFT_HAND_VERSIONS_ONLY_Required_Additional_Plugin.dat"
    File "z_Left Hand Plugin\NetworkAddonMod_Bridges_LEFT_HAND_VERSIONS_ONLY_Required_Additional_Plugin.dat"
  !insertmacro UMUI_ENDIF_INSTALLFLAG
SectionEnd

Section /o -controller controller3
SectionIn 4
SectionEnd
SectionGroupEnd

!define DefaultSimulator 1

!macro _TrafficSection num capacity selected
!ifdef "${selected}"
Section "NAM Traffic Simulator ${capacity}" capa${num}
SectionIn 1 2 3 4
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_MINIMAL}
      StrCpy $CustomizeSimulator 1
  !insertmacro UMUI_ENDIF_INSTALLFLAG
!else
Section /o "NAM Traffic Simulator ${capacity}" capa${num}
!endif
  Call SimulatorSetup
  File "Traffic Simulator\NetworkAddonMod_Traffic_Plugin_Z_${capacity}.dat"
  File "Data Views\NetworkAddonMod_Volume_Data_View_Z_${capacity}.dat"
SectionEnd
!macroend

!define TrafficSection `!insertmacro _TrafficSection`

Function SimulatorSetup
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  Delete "$INSTDIR\NetworkAddonMod_Traffic_Plugin_*.dat"
  Delete "$INSTDIR\NetworkAddonMod_Volume_Data_View_*.dat"
FunctionEnd

SectionGroup "!Traffic Simulator and Related Options" secgrp1
SectionGroup /e "Select Traffic Simulator and Capacity Levels" sec11
${TrafficSection} 1 Classic 0
${TrafficSection} 2 Low 0
${TrafficSection} 3 Medium DefaultSimulator
${TrafficSection} 4 High 0
${TrafficSection} 5 Ultra 0

Section /o "Keep my previous traffic simulator" capa6
  CopyFiles "$INSTDIR\..\*_Z_*.dat" "$INSTDIR\"
  Delete "$INSTDIR\..\*_Z_*.dat"
SectionEnd

Section /o "Build a custom traffic simulator" capa7
  Call SimulatorSetup
  StrCpy $CustomizeSimulator 1
  File "Traffic Simulator\NetworkAddonMod_Traffic_Plugin_Z_Medium.dat"
  File "Data Views\NetworkAddonMod_Volume_Data_View_Z_Medium.dat"
SectionEnd
SectionGroupEnd

Section "New Zones Data View" sec16
SectionIn 1 2 3 4
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  File "Data Views\NetworkAddonMod_Zone_Data_View.dat"
SectionEnd

SectionGroup /e "Automata Controller Type" sec10
Section /o "Persistent Automata" auto0
  StrCpy $PersistentAutomata 1
SectionEnd

Section "Standard Automata Numbers" auto1
SectionIn 1 2 3 4
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  Delete $OUTDIR\NetworkAddonMod_Automata_Plugin_*.dat
  ${If} $PersistentAutomata = 0
    File "Automata Controller\NetworkAddonMod_Automata_Plugin_Standard.dat"
  ${Else}
    File "Automata Controller\NetworkAddonMod_Automata_Plugin_Standard_Persist.dat"
  ${EndIf}
SectionEnd

Section /o "Standard Automata Numbers 24h" auto2
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  Delete $OUTDIR\NetworkAddonMod_Automata_Plugin_*.dat
  ${If} $PersistentAutomata = 0
    File "Automata Controller\NetworkAddonMod_Automata_Plugin_Automata24.dat"
  ${Else}
    File "Automata Controller\NetworkAddonMod_Automata_Plugin_Automata24_Persist.dat"
  ${EndIf}
SectionEnd

Section /o "Radical Automata Numbers" auto3
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  Delete $OUTDIR\NetworkAddonMod_Automata_Plugin_*.dat
  ${If} $PersistentAutomata = 0
    File "Automata Controller\NetworkAddonMod_Automata_Plugin_Radical.dat"
  ${Else}
    File "Automata Controller\NetworkAddonMod_Automata_Plugin_Radical_Persist.dat"
  ${EndIf}
SectionEnd

Section /o "Radical Automata Numbers 24h" auto4
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  Delete $OUTDIR\NetworkAddonMod_Automata_Plugin_*.dat
  ${If} $PersistentAutomata = 0
    File "Automata Controller\NetworkAddonMod_Automata_Plugin_Radical_Automata24.dat"
  ${Else}
    File "Automata Controller\NetworkAddonMod_Automata_Plugin_Radical_Automata24_Persist.dat"
  ${EndIf}
SectionEnd
SectionGroupEnd
SectionGroupEnd

Function SaveTrafficSim
  ${If} ${SectionIsSelected} ${capa6}
    CopyFiles "$INSTDIR\*_Z_*.dat" "$INSTDIR\.."
  ${EndIf}
FunctionEnd

SectionGroup /e "!NAM Networks and Network Expansions" secgrp2
SectionGroup "Bullet Train Mod (BTM)" sec24
Section /o "Main Bullet Train Mod" btm1
  SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
  SetOverwrite ifnewer
  File "Bullet Train Mod\Core Files\*.dat"
SectionEnd

Section /o "Ground Texture" btm2
  SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
  SetOverwrite ifnewer
  File "Bullet Train Mod\Ground Texture\ML Shinkansen MOD ground texture.dat"
SectionEnd

Section /o "Alternate Concrete Texture" btm3
  SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
  SetOverwrite ifnewer
  File "Bullet Train Mod\Concrete Texture\z ML Shinkansen MOD concrete texture.dat"
SectionEnd

Section /o "Fence Prop" btm4
  SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
  SetOverwrite ifnewer
  File "Bullet Train Mod\ML Shinkansen MOD Fence.dat"
SectionEnd

Section /o "N700 Series Shinkansen Train" btm5
  SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
  SetOverwrite ifnewer
  File "Bullet Train Mod\N700 series Shinkansen\N700 series Shinkansen.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Canal Addon Mod (CAN-AM)" sec15
Section "SimGoober's Canals" can1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Canal Addon Mod"
  SetOverwrite ifnewer
  Delete "$OUTDIR\NetworkAddonMod_CanAM_Props_CAL.dat"
  File "Canal Addon Mod\NetworkAddonMod_CanAM_Plugin.dat"
  File "Canal Addon Mod\NetworkAddonMod_CanAM_Props_SG.dat"
SectionEnd

Section /o "Callagrafx' Canals" can2
  SetOutPath "$INSTDIR\Canal Addon Mod"
  SetOverwrite ifnewer
  Delete "$OUTDIR\NetworkAddonMod_CanAM_Props_SG.dat"
  File "Canal Addon Mod\NetworkAddonMod_CanAM_Plugin.dat"
  File "Canal Addon Mod\NetworkAddonMod_CanAM_Props_CAL.dat"
SectionEnd
SectionGroupEnd

Section "Diagonal Streets" plugin2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Diagonal Streets"
  SetOverwrite ifnewer
  File "Diagonal Streets\NetworkAddonMod_Diagonal_Streets_Plugin.dat"
  SetOutPath "$INSTDIR\INRUL Overrides"
  File "INRUL Overrides\NetworkAddonMod_Diagonal_Streets_Plugin_INRULs.dat"
SectionEnd

Section "Double-Height Monorail / Bullet Train Mod" plugin6
SectionIn 2 3 4
  SetOutPath "$INSTDIR\High Elevated Monorail"
  SetOverwrite ifnewer
  File "High Elevated Monorail\NetworkAddonMod_High_Monorail_Plugin.dat"
SectionEnd

SectionGroup "El Rail" plugin5
SectionGroup "El Rail Alternate Implementation" elrail1
Section /o "Core El Rail Network" elrail_alt1
  SetOutPath "$z___NAM\El Rail Alternate Implementation"
  SetOverwrite ifnewer
  File "El Rail\El Rail Alternate Implementation\*.dat"
  File /r "El Rail\El Rail Alternate Implementation\Core Files"
  ${If} ${SectionIsSelected} ${btm1}
	SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
	SetOverwrite ifnewer
    File "El Rail\El Rail Alternate Implementation\z ML Shinkansen MOD Patch\*.dat"
  ${EndIf}
SectionEnd

Section /o "El Rail Catenaries" elrail_alt2
  SetOutPath "$z___NAM\El Rail Alternate Implementation"
  SetOverwrite ifnewer
  File "El Rail\El Rail Alternate Implementation\Catenary and Fence Props\z ML JPN ELR T21 Catenary Prop.dat"
SectionEnd

Section /o "El Rail Fence Props" elrail_alt3
  SetOutPath "$z___NAM\El Rail Alternate Implementation"
  SetOverwrite ifnewer
  File "El Rail\El Rail Alternate Implementation\Catenary and Fence Props\z ML JPN ELR T21 Fence Prop.dat"
SectionEnd

Section /o "El Rail Ground Texture" elrail_alt4
  SetOutPath "$z___NAM\El Rail Alternate Implementation"
  SetOverwrite ifnewer
  File "El Rail\El Rail Alternate Implementation\Ground Texure\z Ground Texture.dat"
SectionEnd

Section /o "El Rail Cool Color Concrete Texture" elrail_alt5
  SetOutPath "$z___NAM\El Rail Alternate Implementation"
  SetOverwrite ifnewer
  File "El Rail\El Rail Alternate Implementation\Concrete Texture\Cool Color Concrete Texture.dat"
SectionEnd
SectionGroupEnd

Section "El Rail over Avenue Networks" elrail2a
SectionIn 2 3 4
  SetOutPath "$INSTDIR\El Rail"
  SetOverwrite ifnewer
  File /r "El Rail\El Rail over Avenue Networks"
SectionEnd

Section "El Rail over Road Networks" elrail2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\El Rail"
  SetOverwrite ifnewer
  File /r "El Rail\El Rail over Road Networks"
SectionEnd

Section "Double-Height Elevated Rail" elrail3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\El Rail"
  SetOverwrite ifnewer
  File "El Rail\NetworkAddonMod_High_ElRail_Plugin.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Elevated Road Networks" sec26
Section "Draggable Elevated Road Networks" elroadnet1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Elevated Road Networks"
  SetOverwrite ifnewer
  File "Road Viaducts\NetworkAddonMod_RoadViaducts_Draggable.dat"
SectionEnd

Section "Modular Elevated Road Networks" elroadnet2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Elevated Road Networks"
  SetOverwrite ifnewer
  File "Road Viaducts\NetworkAddonMod_RoadViaducts.dat"
SectionEnd
SectionGroupEnd

Section "Flexible Underpasses (FLUPs)" plugin8
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Flexible Underpasses"
  SetOverwrite ifnewer
  File "Flexible Underpasses\NetworkAddonMod_FLUPs_Plugin.dat"
  File "Flexible Underpasses\NetworkAddonMod_FLUPs_Props.dat"
  Call FLUPs
SectionEnd

SectionGroup "Fractionally Angled Networks (FANs)" sec22
Section "Fractionally Angled Road Networks (FARs)" fan1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Fractionally Angled Networks"
  SetOverwrite ifnewer
  File "Fractionally Angled Networks\*_Roads.dat"
  File "Fractionally Angled Networks\*_OneWayRoads.dat"
  File "Fractionally Angled Networks\*_Avenues.dat"
SectionEnd

Section "Fractionally Angled Railroads (FARRs)" fan2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Fractionally Angled Networks"
  SetOverwrite ifnewer
  File "Fractionally Angled Networks\*_Rails.dat"
  Call FARR
SectionEnd

Section "Draggable FAR" fan3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Fractionally Angled Networks"
  SetOverwrite ifnewer
  File "Fractionally Angled Networks\*draggable*.dat"
  SetOutPath "$INSTDIR\INRUL Overrides\"
  File "INRUL Overrides\NetworkAddonMod_FAN_WRC_INRULs.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Ground Light Rail / Tram" sec18
Section "Ground Light Rail" tram1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Ground Light Rail"
  SetOverwrite ifnewer
  File "Ground Light Rail\NetworkAddonMod_GroundLightRail_Plugin.dat"
  File "Ground Light Rail\NetworkAddonMod_GroundLightRailDrag_Plugin.dat"
  SetOutPath "$INSTDIR\INRUL Overrides"
  File "INRUL Overrides\NetworkAddonMod_GroundLightRail_Plugin_INRULs.dat"
SectionEnd

Section "Tram in Avenue" tram2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Ground Light Rail"
  SetOverwrite ifnewer
  File "Ground Light Rail\NetworkAddonMod_GroundLightRailxAvenue_Plugin.dat"
SectionEnd

Section "Tram in Road" tram3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Ground Light Rail"
  SetOverwrite ifnewer
  SetOverwrite ifnewer
  File "Ground Light Rail\NetworkAddonMod_GroundLightRailxRoad_Plugin.dat"
SectionEnd

Section "Tram in Street" tram4
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Ground Light Rail"
  SetOverwrite ifnewer
  File "Ground Light Rail\NetworkAddonMod_GroundLightRailxStreet_Plugin.dat"
SectionEnd

Section /o "Extended Draggable Ground Light Rail" tram5
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Ground Light Rail"
  SetOverwrite ifnewer
  File "Ground Light Rail\NetworkAddonMod_GroundLightRailDrag_Extension.dat"
SectionEnd
SectionGroupEnd

Section "High Speed Rail Plugin" sec30
SectionIn 2 3 4
  SetOutPath "$INSTDIR\High Speed Rail Project"
  SetOverwrite ifnewer
  File "High Speed Rail Project\*.dat"
  ${If} $bRight = 0
    SetOutPath "$INSTDIR\z_Left Hand Plugin"
    File "z_Left Hand Plugin\HSR_LEFT_HAND_VERSIONS_ONLY_Required_Additional_Plugin.dat"
  ${EndIf}
SectionEnd

Section /o "Maxis Highway Override" sec23
  SetOutPath "$z___NAM"
  SetOverwrite ifnewer
  File /r "Maxis Highway Override"
  SetOutPath "$z___NAM\Maxis Highway Override"
  ${Unless} ${SectionIsSelected} ${elrail_alt1}
    Delete "$OUTDIR\z_Moonlinght_Alternate_ELR_Patch.dat"
	SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
	Delete "$OUTDIR\z_Moonlinght_Alternate_ELR_Patch.dat"
  ${EndIf}
  ${If} ${SectionIsSelected} ${elrail_alt1}
	SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
	File "Maxis Highway Override\z_Moonlinght_Alternate_ELR_Patch.dat"
  ${EndIf}
  ${Unless} ${SectionIsSelected} ${btm1}
    SetOutPath "$z___NAM\Maxis Highway Override"
	Delete "$OUTDIR\z_BTM_Patch.dat"
	SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
    Delete "$OUTDIR\z_BTM_Patch.dat"
  ${EndIf}
  ${If} ${SectionIsSelected} ${btm1}
	SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
    File "Maxis Highway Override\z_BTM_Patch.dat"
  ${EndIf}
SectionEnd

!macro _NWMSection num nwmname
Section "NWM ${nwmname}" nwm${num}
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Network Widening Mod"
  SetOverwrite ifnewer
!if "${nwmname}" != "Triple-Tile Networks"
  File "Network Widening Mod\NetworkWideningMod_${nwmname}.dat"
!else
  File "Network Widening Mod\NetworkWideningMod_TripleTile.dat"
!endif
  StrCpy $1 ${nwmname}
  Call NWMCore
SectionEnd
!macroend

!define NWMSection `!insertmacro _NWMSection`

Function NWMCore
  SetOutPath "$INSTDIR\Network Widening Mod"
  SetOverwrite ifnewer
  ${If} $CalledNWMCore = 0
    File "Network Widening Mod\NetworkWideningMod_Core.dat"
    File "Network Widening Mod\NetworkWideningMod_ElRail_over_Road_NWM.dat"
    File "Network Widening Mod\NetworkWideningMod_LotSupport.dat"
    ${StrStr} $2 $1 "TLA"
    ${If} $2 != ""
      ${If} $bRight = 0
        File "Network Widening Mod\TLA Center Turn Arrows\tla_center_arrows_addon_LHD.dat"
        SetOutPath "$INSTDIR\z_Left Hand Plugin"
        File "z_Left Hand Plugin\Network Widening Mod_LEFT_HAND_VERSIONS_ONLY_Required_Additional_Plugin.dat"
      ${Else}
        File "Network Widening Mod\TLA Center Turn Arrows\tla_center_arrows_addon_RHD.dat"
      ${EndIf}
      StrCpy $CalledNWMCore 1
    ${EndIf}
  ${EndIf}
FunctionEnd

SectionGroup "Network Widening Mod (NWM)" sec20
SectionGroup "NWM Networks" nwmgroup1
${NWMSection} 1 "TLA-3"
${NWMSection} 2 "AVE-2"
${NWMSection} 3 "ARD-3"
${NWMSection} 4 "OWR-1"
${NWMSection} 5 "OWR-3"
${NWMSection} 6 "NRD-4"
${NWMSection} 7 "TLA-5"
${NWMSection} 8 "OWR-4"
${NWMSection} 9 "OWR-5"
${NWMSection} 10 "RD-4"
${NWMSection} 11 "RD-6"
${NWMSection} 12 "Triple-Tile Networks"
SectionGroupEnd

Section /o "Legacy Transition Piece Wealthification" nwmgroup2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Network Widening Mod"
  SetOverwrite ifnewer
  File "Network Widening Mod\NetworkWideningMod_LegacyPuzzleWealthing.dat"
SectionEnd
SectionGroupEnd

Section "Ped Malls" sec28
SectionIn 2 3 4
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  File "NetworkAddonMod_PedMalls.dat"
SectionEnd

SectionGroup "Rail" sec33
Section "RealRailway (RRW)" rail1
  SetOutPath "$z___NAM\y_RealRailway"
  SetOverwrite ifnewer
  File "Rail\RealRailway\*.dat"
  SetOutPath "$INSTDIR\INRUL Overrides"
  File "INRUL Overrides\RealRailway_Core_INRULs.dat"
  ${If} $bRight = 0
    SetOutPath "$INSTDIR\z_Left Hand Plugin\z_RealRailway"
    File "z_Left Hand Plugin\RealRailway_LHD.dat"
  ${EndIf}
  ${Unless} ${SectionIsSelected} ${btm1}
    SetOutPath "$z___NAM\y_RealRailway"
	Delete "$OUTDIR\zML Shinkansen MOD for STR RRW.dat"
  ${EndIf}
  ${If} ${SectionIsSelected} ${btm1}
	SetOutPath "$z___NAM\y_RealRailway"
    File "Rail\RealRailway\zML Shinkansen MOD for STR RRW.dat"
  ${EndIf}
  ${Unless} ${SectionIsSelected} ${elrail_alt1}
    SetOutPath "$z___NAM\y_RealRailway"
	Delete "$OUTDIR\zML JPN EL Rail 2013 for STR RRW.dat"
  ${EndIf}
  ${If} ${SectionIsSelected} ${elrail_alt1}
	SetOutPath "$z___NAM\y_RealRailway"
    File "Rail\RealRailway\zML JPN EL Rail 2013 for STR RRW.dat"
  ${EndIf}
  ${Unless} ${SectionIsSelected} ${sec23}
    SetOutPath "$z___NAM\y_RealRailway"
	Delete "$OUTDIR\z_RRW_MHO_Patch.dat"
  ${EndIf}
  ${If} ${SectionIsSelected} ${sec23}
	SetOutPath "$z___NAM\y_RealRailway"
    File "Rail\RealRailway\z_RRW_MHO_Patch.dat"
  ${EndIf}
  Call RRW
SectionEnd

SectionGroup /e "Maxis Rail" rail0
Section "Single Track Rail (STR) (Maxis-spec)" rail2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Rail\Railway Addon Mod"
  SetOverwrite ifnewer
  File "Rail\Railway Addon Mod\RailwayAddonMod_STR_WideRadiusCurves.dat"
  File "Rail\Railway Addon Mod\RailroadAddonMod_Viaducts.dat"
  File "Rail\Railway Addon Mod\RailwayAddonMod_STR_DraggableNetwork.dat"
  ${If} $bRight = 0
    SetOutPath "$INSTDIR\z_Left Hand Plugin"
    File "z_Left Hand Plugin\RailwayAddonMod_STR_LEFT_HAND_VERSIONS_ONLY_Required_Additional_Plugin.dat"
  ${EndIf}
SectionEnd
SectionGroup "Maxis Rail Texture Style" sec14
Section "Darker textures by SFBT" rail_texture1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Rail Textures"
  SetOverwrite ifnewer
  Delete "$OUTDIR\Rail* Addon*\zzz_Dual_Rail_Texture_*.dat"
  File "Rail\Rail Textures\SFBT_Rail Textures Mod_Darker Textures.dat"
SectionEnd

Section /o "Alternative textures by dedgren" rail_texture2
  SetOutPath "$INSTDIR\Railway Addon Mod"
  SetOverwrite ifnewer
  Delete "$INSTDIR\*\SFBT_Rail Textures Mod_Darker Textures.dat"
  File "Rail\Rail Textures\zzz_Dual_Rail_Texture_Maxis_Upgrade.dat"
  File "Rail\Rail Textures\zzz_Dual_Rail_Texture_NAM_Upgrade.dat"
  File "Rail\Rail Textures\zzz_Dual_Rail_Texture_STR_Upgrade.dat"
SectionEnd

Section /o "Maxis default (not recommended)" rail_texture3
  Delete "$INSTDIR\*\SFBT_Rail Textures Mod_Darker Textures.dat"
  Delete "$INSTDIR\Rail* Addon*\zzz_Dual_Rail_Texture_*.dat"
SectionEnd
SectionGroupEnd
SectionGroupEnd

Section "Underground Rail" rail5
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Rail"
  SetOverwrite ifnewer
  File /r "Rail\Underground Rail"
SectionEnd

Section "Viaduct Rail Puzzle Pieces" rail6
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Rail"
  SetOverwrite ifnewer
  File "Rail\NetworkAddonMod_RailViaducts.dat"
SectionEnd

SectionGroupEnd

!define RHWLevel `!insertmacro _RHWLevel`
!define RHWSection `!insertmacro _RHWSection`

!macro _RHWLevel level level_name
SectionGroup "RHW ${level_name} Networks" rhw${level}
!if ${level} < 3
${RHWSection} ${level} 0 ${level_name} RHW-2
${RHWSection} ${level} 1 ${level_name} RHW-3
!endif
${RHWSection} ${level} 2 ${level_name} MIS
${RHWSection} ${level} 3 ${level_name} RHW-4
${RHWSection} ${level} 4 ${level_name} RHW-6S
!if ${level} < 3
${RHWSection} ${level} 5 ${level_name} RHW-8S
${RHWSection} ${level} 6 ${level_name} RHW-10S
${RHWSection} ${level} 7 ${level_name} RHW-6C
${RHWSection} ${level} 8 ${level_name} RHW-8C
!endif
SectionGroupEnd
!macroend

!macro _RHWSection level network level_name network_name
!if ${level} = 5
Section "RHW DD${network_name}" rhw${level}${network}
!else if ${level} = 6
Section "${network_name}" rhw${level}${network}
!else
Section "RHW ${level_name} ${network_name}" rhw${level}${network}
!endif
!if ${level} < 3
SectionIn 2 3 4
!else if ${level} >= 5
SectionIn 2 3 4
!endif
  Call RHWCore
  SetOutPath "$INSTDIR\Real Highway Mod\${level_name}"
  SetOverwrite ifnewer
!if ${level} < 5
  File "Real Highway Mod\${level_name}\RealHighway_${level_name}_${network_name}.dat"
!if ${level} >= 1
!if ${level} <= 2
    File "Real Highway Mod\${level_name}\RealHighway_${level_name}_Width_Transitions.dat"
!endif
!endif
!else if ${level} = 5
  File "Real Highway Mod\${level_name}\RealHighway_DD_${network_name}.dat"
!else if ${level} = 6
  File "Real Highway Mod\RealHighway_FractionalAngleNetworking.dat"
!endif
SectionEnd
!macroend

Function RHWCore
  SetOutPath "$INSTDIR\Real Highway Mod"
  SetOverwrite ifnewer
  ${If} $CalledRHWCore = 0
    File /x "RealHighway_FLUPs.dat" /x "RealHighway_OneWayRoad_Roundabout_Arrows_Reduction_Plugin.dat" /x "RealHighway_Regional_Transport_Map.dat" /x "a_RealHighwayMod_LegacyButtons.dat" "Real Highway Mod\*.dat"
    ${If} $bRight = 0
      SetOutPath "$INSTDIR\z_Left Hand Plugin"
      File "z_Left Hand Plugin\RealHighwayMod_LEFT_HAND_VERSIONS_ONLY_Required_Additional_Plugin.dat"
      File "z_Left Hand Plugin\RealHighwayMod_Locale_LHDOnly_english.dat"
    ${EndIf}
    StrCpy $CalledRHWCore 1
  ${EndIf}
FunctionEnd

SectionGroup "RealHighway Mod (RHW)" sec19
${RHWLevel} 0 L0
${RHWLevel} 1 L1
${RHWLevel} 2 L2
${RHWLevel} 3 L3
${RHWLevel} 4 L4
SectionGroup "DDRHW Networks" rhw5
${RHWSection} 5 3 DDRHW RHW-4
SectionGroupEnd
${RHWSection} 6 0 FARHW FARHW
SectionGroup "RealHighway Additional Options" sec34
	Section /o "RealHighway Regional Transport View" rhw_op1
		SetOutPath "$INSTDIR\Real Highway Mod"
		SetOverwrite ifnewer
		${If} ${SectionIsSelected} ${sec19}
		${OrIf} ${SectionIsPartiallySelected} ${sec19}
		${OrIf} ${SectionIsSelected} ${sec23}
		File "Real Highway Mod\RealHighway_Regional_Transport_Map.dat"
		${EndIf}
	SectionEnd

	Section "Single Median Barriers for Compact RHW Networks" rhw_op2
		SectionIn 2 3 4
		SetOutPath "$z___NAM\Cosmetic Addons\RHW Single Median Barriers"
		SetOverwrite ifnewer
		File "Cosmetic Addons\RHW-Ctype_SingleMedianBarriers\*.dat"
		${If} $bRight = 0
		File /r "z_LHD_Support"
		${EndIf}
	SectionEnd

	Section "Legacy Deprecated Height Transitions" rhw_op3
		SetOutPath "$INSTDIR\Real Highway Mod"
		SetOverwrite ifnewer
		File "Real Highway Mod\a_RealHighwayMod_LegacyButtons.dat"
	SectionEnd
	SectionGroupEnd
SectionGroupEnd

Section "Rural Roads Plugin" rurp1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Rural Roads Plugin"
  SetOverwrite ifnewer
  File "Rural Roads Plugin\*.dat"
SectionEnd

!macro _SamSection num samname
Section "SAM Set ${num} - ${samname}" sam${num}
SectionIn 2 3 4
  StrCpy $0 ${num}
  Call SamCore
  File "Street Addon Mod\Textures\SAM - ${num} - *.dat"
SectionEnd
!macroend

!define SamSection `!insertmacro _SamSection`

Function SamCore
  SetOutPath "$INSTDIR\Street Addon Mod\Textures"
  SetOverwrite ifnewer
  ${If} $CalledSAMCore = 0
    File "Street Addon Mod\*.dat"
    ${If} $bRight = 0
      SetOutPath "$INSTDIR\z_Left Hand Plugin"
      File "z_Left Hand Plugin\StreetAddonMod_LEFT_HAND_VERSIONS_ONLY_Required_Additional_Plugin.dat"
      SetOutPath "$INSTDIR\Street Addon Mod\Textures"
    ${EndIf}
    StrCpy $CalledSAMCore 1
  ${EndIf}
FunctionEnd

SectionGroup "Street Addon Mod (SAM)" sec21
${SamSection} 1 "Parking Lots"
${SamSection} 2 "Herringbone Brick Streets"
${SamSection} 3 "PEG Dirt Streets"
${SamSection} 4 "PEG Gravel Streets"
${SamSection} 5 "Trolca Dirt Streets"
${SamSection} 6 "Klinker Streets"
${SamSection} 7 "Asphalt Streets"
${SamSection} 8 "Cobblestone Streets"
${SamSection} 9 "Brick Streets"
${SamSection} 10 "Japanese Streets"
${SamSection} 11 "Industrial Streets"
SectionGroupEnd
SectionGroupEnd

SectionGroup "!Stations, Ports, and Network Transitions" secgrp3
Section "Upgraded Maxis Transit Lots" transit1
SectionIn 1 2 3 4 RO
  SetOutPath "$z___NAM\Mass Transit Lots"
  SetOverwrite ifnewer
  File "Transit Lots\Maxis Transit Lots\Maxis Stations, Tollbooths, and Transitions.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
SectionEnd

SectionGroup "Maxis Airports" transit2
Section "Low Capacity Airports (Maxis)" air1
SectionEnd

Section "Medium Capacity Airports (4x)" air2
SectionIn 1 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots"
  SetOverwrite ifnewer
  File "Transit Lots\Maxis Transit Lots\Maxis Airports - Medium.dat"
SectionEnd

Section /o "High Capacity Airports (8x)" air3
  SetOutPath "$z___NAM\Mass Transit Lots"
  SetOverwrite ifnewer
  File "Transit Lots\Maxis Transit Lots\Maxis Airports - Large.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Bus Rapid Transit Stations" transit4
Section "BriPizza Elevated Roadway Station" brt1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Bus Rapid Transit Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Bus Rapid Transit Stations\BriPizza Elevated Road Stop.dat"
SectionEnd
/*
Section "Modern Arched Bus Rapid Transit Station" brt2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Bus Rapid Transit Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Bus Rapid Transit Stations\Modern Arched Bus Rapid Transit Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\High Speed Rail Stations\Modern Arched GHSR Station\GHSR Station Model.SC4Model"
  File "Transit Lots\Props and Models\Transit Station Textures.dat"
SectionEnd
*/
Section "Overhanging Bus Rapid Transit Station" brt3
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Bus Rapid Transit Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Modern Overhanging Stations\Overhanging Elevated Road Station.SC4Lot"
  File "Transit Lots\Modern Overhanging Stations\elevatedroadotherside_774e73ce.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Modern Overhanging Stations\railoverroadfinal-0x5ad0e817_0xb9dcad21_0x30000.SC4Model"
SectionEnd

SectionGroup "Bus Rapid Transit Filter Lots" brt4
Section "Bus Rapid Transit Filter for L0 RHW-2" brt_filter0
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Bus Rapid Transit Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Bus Rapid Transit Stations\Bus Filter for L0 RHW-2.SC4Lot"
SectionEnd

Section "Bus Rapid Transit Filter for L1 RHW-2" brt_filter1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Bus Rapid Transit Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Bus Rapid Transit Stations\Bus Filter for L1 RHW-2.SC4Lot"
SectionEnd

Section "Bus Rapid Transit Filter for L2 RHW-2" brt_filter2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Bus Rapid Transit Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Bus Rapid Transit Stations\Bus Filter for L2 RHW-2.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\Transit Station Textures.dat"
SectionEnd
SectionGroupEnd
SectionGroupEnd

SectionGroup "El Rail Stations" transit3
Section "El Rail Station with Bus and Subway" eltrain0a
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\El Rail Station with Bus and Subway.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\BusSign_Ninja.*"
SectionEnd

Section "Victorian El Rail Station (Orthogonal)" eltrain0
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Victorian Stations\Victorian El Rail Station Orthogonal.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Morifari Victorian Stations\Victorian Station Orthognal.SC4Model"
SectionEnd

Section "Victorian El Rail Station (Diagonal)" eltrain1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Victorian Stations\Victorian El Rail Station Diagonal.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Victorian Stations\Victorian Station Diagonal.SC4Model"
SectionEnd

Section "Modern El Train Station" eltrain2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations\Modern El Train Station"
  SetOverwrite ifnewer
  File "Transit Lots\Modern Train Stations\MEBSP_Station_149b6c88.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models\Modern Train Station"
  File "Transit Lots\Modern Train Stations\MEBSP-0x5ad0e817_0x921be49a_0x30000.SC4Model"
  File "Transit Lots\Modern Train Stations\MEBSP_Roof_Prop.dat"
SectionEnd

Section "Overhanging El Rail Station" eltrain2a
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Modern Overhanging Stations\Overhanging El Rail Station.SC4Lot"
  File "Transit Lots\Modern Overhanging Stations\elrailotherside_374e7322.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
SectionEnd

Section "Diagonal El Rail Station" eltrain3
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Diagonal Station Set\Diagonal El-Rail Station_77abc775.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Diagonal Station Set\finaldiagrender2-0x5ad0e817_0xba3a4922_0x30000.SC4Model"
SectionEnd

Section "Morifari Straight El Rail Station" eltrain4
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari Straight El Rail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari_Diagonal_and_Straight_Rail_Station.dat"
SectionEnd

Section "Morifari Diagonal El Rail Station" eltrain5
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari Diagonal El Rail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari_Diagonal_and_Straight_Rail_Station.dat"
SectionEnd

Section "Double-Height Elevated Rail Station" eltrain6
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Double Height Stations\Double Height Light Rail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Double Height Stations\Double Height Model File.SC4Model"
SectionEnd

SectionGroup "El Rail over Avenue Stations" eltrain7
Section "Morgan-Lake Station" elrailave1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations\El Rail over Road"
  SetOverwrite ifnewer
  File /r "Transit Lots\Morgan-Lake Station"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\BusSign_Ninja.*"
  File "Transit Lots\Props and Models\El Rail Prop.dat"
SectionEnd
SectionGroupEnd

SectionGroup "El Rail over Road Stations" eltrain8
Section "CTA Madison and Wells Station" elrailroad1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations\El Rail over Road"
  SetOverwrite ifnewer
  File /r "Transit Lots\CTA Madison-Wells Station"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\Ardecila_Intersection_Textures.dat"
  File "Transit Lots\Props and Models\BusSign_Ninja.*"
  File "Transit Lots\Props and Models\SubStairs_Mcdrye_Black.SC4Model"
  File "Transit Lots\Props and Models\Subway Stairs.SC4Desc"
SectionEnd

Section /o "CTA Ashland Station" elrailroad2
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations\El Rail over Road"
  SetOverwrite ifnewer
  File /r "Transit Lots\CTA Ashland Station"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\Ardecila_Intersection_Textures.dat"
  File "Transit Lots\Props and Models\BusSign_Ninja.*"
  File "Transit Lots\Props and Models\SubStairs_Mcdrye_Black.SC4Model"
  File "Transit Lots\Props and Models\Subway Stairs.SC4Desc"
SectionEnd

Section "Overhanging El Rail over Road Station" elrailroad3
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations\El Rail over Road\Overhanging El Rail over Road Station"
  SetOverwrite ifnewer
  File "Transit Lots\Modern Overhanging Stations\Overhanging El Rail over Road.SC4Lot"
  File "Transit Lots\Modern Overhanging Stations\elrailoverroadotherside_774e73cc.SC4Lot"
  File "Transit Lots\Modern Overhanging Stations\El_Road_Textures_Standard_Med_High.dat"
  SetOutPath "$z___NAM\Mass Transit Lots\El Rail Stations"
  File "Transit Lots\Modern Overhanging Stations\elrailotherside_374e7322.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Modern Overhanging Stations\railoverroadfinal-0x5ad0e817_0xb9dcad21_0x30000.SC4Model"
SectionEnd
SectionGroupEnd
SectionGroupEnd

SectionGroup "GLR and Tram Stations" transit5
SectionGroup "GLR Stations" glr
Section "SFBT Dentei GLR Station (Orthogonal)" glr1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\GLR and Tram Stations"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Stations\SFBT Dentei Tram Stations\GLR orthogonal Dentei station_b597d5b9.SC4Lot"
  File "Transit Lots\GLR and Tram\Stations\SFBT Dentei Tram Stations\RR-Dentei_Props.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\GLR and Tram\SFBT_GLR_Station_Resources.dat"
SectionEnd

Section "SFBT Dentei GLR Station (Diagonal)" glr2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\GLR and Tram Stations"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Stations\SFBT Dentei Tram Stations\GLR diagonal Dentei station_b597d62a.SC4Lot"
  File "Transit Lots\GLR and Tram\Stations\SFBT Dentei Tram Stations\RR-Dentei_Props.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\GLR and Tram\SFBT_GLR_Station_Resources.dat"
SectionEnd

Section "Modern GLR Station" glr3
  SetOutPath "$z___NAM\Mass Transit Lots\GLR and Tram Stations"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Stations\Modern GLR Station\*.*"
SectionEnd
SectionGroupEnd

SectionGroup "Tram Stations" tram_stations
Section "SFBT Dentei Tram-in-Avenue Station (Orthogonal)" tram_station1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\GLR and Tram Stations"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Stations\SFBT Dentei Tram Stations\TramAve 2x2 orthogonal Dentei station_9545f6eb.SC4Lot"
  File "Transit Lots\GLR and Tram\Stations\SFBT Dentei Tram Stations\RR-Dentei_Props.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\GLR and Tram\SFBT_GLR_Station_Resources.dat"
SectionEnd

Section "SFBT Dentei Tram-in-Avenue Station (Diagonal)" tram_station2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\GLR and Tram Stations"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Stations\SFBT Dentei Tram Stations\TramAve 2x3 diagonal Dentei station_1541eca0.SC4Lot"
  File "Transit Lots\GLR and Tram\Stations\SFBT Dentei Tram Stations\RR-Dentei_Props.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\GLR and Tram\SFBT_GLR_Station_Resources.dat"
SectionEnd

Section /o "SFBT Tram-in-Road Station (Single Length)" tram_station3
  SetOutPath "$z___NAM\Mass Transit Lots\GLR and Tram Stations"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Stations\SFBT Tram-in-Road Stations\TramRoad1x1stop_d67e1351.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\GLR and Tram\Stations\SFBT Tram-in-Road Stations\TramRoadStopModels.dat"
  File "Transit Lots\GLR and Tram\SFBT_GLR_Station_Resources.dat"
SectionEnd

Section "SFBT Tram-in-Road Station (Double Length)" tram_station4
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\GLR and Tram Stations"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Stations\SFBT Tram-in-Road Stations\TramRoad1x2stop_d67e1686.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\GLR and Tram\Stations\SFBT Tram-in-Road Stations\TramRoadStopModels.dat"
  File "Transit Lots\GLR and Tram\SFBT_GLR_Station_Resources.dat"
SectionEnd

Section /o "SFBT Tram-in-Road Station (Triple Length)" tram_station5
  SetOutPath "$z___NAM\Mass Transit Lots\GLR and Tram Stations"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Stations\SFBT Tram-in-Road Stations\TramRoad1x3stop_d67e18c7.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\GLR and Tram\Stations\SFBT Tram-in-Road Stations\TramRoadStopModels.dat"
  File "Transit Lots\GLR and Tram\SFBT_GLR_Station_Resources.dat"
SectionEnd

Section "SFBT Tram-on-Street Stop" tram_station6
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\GLR and Tram Stations"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Stations\SFBT Tram-on-Street Stop\SFBT_TramStreet_Stop.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\GLR and Tram\SFBT_GLR_Station_Resources.dat"
SectionEnd
SectionGroupEnd
SectionGroupEnd

SectionGroup "High Speed Rail Stations" transit6
Section "Modern Arched HSR Station" hsr1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\High Speed Rail Stations"
  SetOverwrite ifnewer
  File /r "Transit Lots\High Speed Rail Stations\Modern Arched HSR Station"
SectionEnd

Section "Modern Arched GHSR Station" hsr2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\High Speed Rail Stations\Modern Arched GHSR Station"
  SetOverwrite ifnewer
  File "Transit Lots\High Speed Rail Stations\Modern Arched GHSR Station\GHSR Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Diagonal Station Set\finaldiagrender2-0x5ad0e817_0xba3a4922_0x30000.SC4Model"
SectionEnd

Section "Diagonal HSR Station" hsr3
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\High Speed Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\High Speed Rail Stations\Diagonal HSR Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Diagonal Station Set\finaldiagrender2-0x5ad0e817_0xba3a4922_0x30000.SC4Model"
SectionEnd

Section "Overhanging HSR Station" hsr4
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\High Speed Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Modern Overhanging Stations\Overhanging HSR Station.SC4Lot"
  File "Transit Lots\Modern Overhanging Stations\HSROtherside_774e73cd.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Modern Overhanging Stations\railoverroadfinal-0x5ad0e817_0xb9dcad21_0x30000.SC4Model"
SectionEnd

Section "Morifari Straight HSR Station" hsr5
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\High Speed Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari Straight HSR Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari_Diagonal_and_Straight_Rail_Station.dat"
  File "Transit Lots\Props and Models\EL Network Props.dat"
SectionEnd

Section "HSRP Transit Hub" hsr6
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\High Speed Rail Stations"
  SetOverwrite ifnewer
  File /r "Transit Lots\High Speed Rail Stations\HSRP Transit Hub"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\BusSign_Ninja.*"
SectionEnd
SectionGroupEnd

SectionGroup "Monorail and Bullet Train Stations" transit7
Section "Modern Monorail and Bullet Train Station" monorail0
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Monorail Stations"
  SetOverwrite ifnewer
  File /r "Transit Lots\Modern Monorail and Bullet Train Station"
SectionEnd

Section "Overhanging Monorail / Bullet Train Station" monorail1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Monorail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Modern Overhanging Stations\Overhanging Monorail Station.SC4Lot"
  File "Transit Lots\Modern Overhanging Stations\monorailotherside_774e73ca.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Modern Overhanging Stations\railoverroadfinal-0x5ad0e817_0xb9dcad21_0x30000.SC4Model"
SectionEnd

Section "Diagonal Monorail / Bullet Train Station" monorail2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Monorail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Diagonal Station Set\Diagonal Monorail BTM Station_77abd579.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Diagonal Station Set\finaldiagrender2-0x5ad0e817_0xba3a4922_0x30000.SC4Model"
SectionEnd

Section "Double-Height Monorail / Bullet Train Station" monorail3
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Monorail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Double Height Stations\Double Height Monorial or BTM Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Double Height Stations\Double Height Model File.SC4Model"
SectionEnd

Section /o "Japanese Bullet Train Station" monorail4
SectionIn RO
  SetOutPath "$z___NAM\Mass Transit Lots\Monorail Stations\Japanese Bullet Train Station"
  SetOverwrite ifnewer
  File "Transit Lots\ML Shinkansen Station\ML 4x1 Shinkansen Station_98dce3a3.SC4Lot"
  File "Transit Lots\ML Shinkansen Station\ML Shinkansen Station.dat"
SectionEnd

Section "Morifari Straight Monorail / Bullet Train Station" monorail5
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Monorail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari Straight Monorail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari_Diagonal_and_Straight_Rail_Station.dat"
SectionEnd

Section "Morifari Diagonal Monorail / Bullet Train / HSR Station" monorail6
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Monorail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari Diagonal Monorail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari_Diagonal_and_Straight_Rail_Station.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Multi-Purpose Stations" transit8
Section /o "BriPizza 15m Multi-Purpose Station" multi1
  SetOutPath "$z___NAM\Mass Transit Lots\Multi-Purpose Stations"
  SetOverwrite ifnewer
  File /r /x "Utils3x1_ENnamRailSta---Overhead_V2_13d2bd58.SC4Lot" "Transit Lots\Multi-Purpose Stations\BriPizza 15m Station"
SectionEnd

Section "BriPizza 15m Station with Parking" multi2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Multi-Purpose Stations"
  SetOverwrite ifnewer
  File /r /x "Utils3x1_NEnamLRStaV1_33d321b7.SC4Lot" "Transit Lots\Multi-Purpose Stations\BriPizza 15m Station"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\BusSign_Ninja.*"
SectionEnd

Section /o "BriPizza Arched Station" multi3
  SetOutPath "$z___NAM\Mass Transit Lots\Multi-Purpose Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Multi-Purpose Stations\BriPizza Arched Station.dat"
SectionEnd

Section "BriPizza 0m-15m Multi-Purpose Station" multi4
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Multi-Purpose Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Multi-Purpose Stations\BriPizza 0m-15m Multi-Purpose Station.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\BusSign_Ninja.*"
  File "Transit Lots\Props and Models\RoadSideSubstairs_Ninja_0x8e26cb8b.SC4Model"
  File "Transit Lots\Props and Models\Subway Stairs.SC4Desc"
SectionEnd

Section "BriPizza 15m-30m Multi-Purpose Station" multi5
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Multi-Purpose Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Multi-Purpose Stations\BriPizza 15m-30m Multi-Purpose Station.dat"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\BusSign_Ninja.*"
  File "Transit Lots\Props and Models\RoadSideSubstairs_Ninja_0x8e26cb8b.SC4Model"
  File "Transit Lots\Props and Models\Subway Stairs.SC4Desc"
SectionEnd

Section /o "BriPizza Norikae Station" multi6
  SetOutPath "$z___NAM\Mass Transit Lots\Multi-Purpose Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Multi-Purpose Stations\BriPizza Norikae Station.dat"
SectionEnd

Section "Ninja Boulevard Kiosk" multi7
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Multi-Purpose Stations\Ninja Boulevard Kiosk and Station"
  SetOverwrite ifnewer
  File "Transit Lots\Multi-Purpose Stations\Ninja Boulevard Kiosk and Station\*Kiosk*.*"
SectionEnd

Section "Ninja Boulevard Station" multi8
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Multi-Purpose Stations\Ninja Boulevard Kiosk and Station"
  SetOverwrite ifnewer
  File "Transit Lots\Multi-Purpose Stations\Ninja Boulevard Kiosk and Station\*Station*.*"
SectionEnd
SectionGroupEnd

SectionGroup "Network Transitions and Connectors" transit9
Section "SFBT GLR to Subway Transition" transition0
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Tram Transitions"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Transitions\SFBT Subway-Tram-Transition\SFBT_Subway-Tram_Transition.SC4Lot"
  File "Transit Lots\GLR and Tram\Transitions\SFBT Subway-Tram-Transition\SFBT_Subway-Tram_Transition.SC4Model"
SectionEnd

Section "RTMT Tram to Subway Transitions" transition1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Tram Transitions"
  SetOverwrite ifnewer
  File "Transit Lots\GLR and Tram\Transitions\RTMT Tram Transitions\*.*"
  ${If} $bRight = 0
    Delete "$OUTDIR\RTMT_Tram_Transition_Paths_Right.dat"
  ${Else}
    Delete "$OUTDIR\RTMT_Tram_Transition_Paths_Left.dat"
  ${EndIf}
SectionEnd

Section "Subway to Underground Rail Connectors (ESURE)" transition2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\ESURE"
  SetOverwrite ifnewer
  File "Transit Lots\ESURE\Subway_to_Underground_Rail_Connector.dat"
  File "Transit Lots\ESURE\NAM_URailRTMT_RoadTexture_Standard.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Rail Stations" transit10
Section "Modern Arched Rail Station" rail_station1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Modern Arched Rail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\High Speed Rail Stations\Modern Arched GHSR Station\GHSR Station Model.SC4Model"
SectionEnd

SectionGroup "Viaduct Rail Stations" rail_station2
Section "Modern Viaduct Rail Station" viaduct_rail0
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Modern Train Stations\Modern Viaduct Rail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models\Modern Train Station"
  File "Transit Lots\Modern Train Stations\MEBSP-0x5ad0e817_0x921be49a_0x30000.SC4Model"
  File "Transit Lots\Modern Train Stations\MEBSP_Roof_Prop.dat"
SectionEnd

Section "Overhanging Viaduct Rail Station" viaduct_rail1
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Modern Overhanging Stations\Overhanging Viaduct Rail Station.SC4Lot"
  File "Transit Lots\Modern Overhanging Stations\viaductrailotherside_774e73cb.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Modern Overhanging Stations\railoverroadfinal-0x5ad0e817_0xb9dcad21_0x30000.SC4Model"
SectionEnd

Section "Diagonal Viaduct Rail Station" viaduct_rail2
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Diagonal Station Set\Diagonal Viaduct Rail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Props and Models\EL Network Props.dat"
  File "Transit Lots\Diagonal Station Set\finaldiagrender2-0x5ad0e817_0xba3a4922_0x30000.SC4Model"
SectionEnd

Section "Victorian Viaduct Rail Station (Orthogonal)" viaduct_rail3
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Victorian Stations\morifari_Viaduct_Rail_Station_orthogonal.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Victorian Stations\Victorian Station Orthognal.SC4Model"
SectionEnd

Section "Victorian Viaduct Rail Station (Diagonal)" viaduct_rail4
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Victorian Stations\morifari_Viaduct_Rail_Station_diagonal.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Victorian Stations\Victorian Station Diagonal.SC4Model"
SectionEnd

Section "Morifari Straight Viaduct Rail Station" viaduct_rail5
  SetOutPath "$z___NAM\Mass Transit Lots\Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari Straight Viaduct Rail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari_Diagonal_and_Straight_Rail_Station.dat"
  File "Transit Lots\Props and Models\EL Network Props.dat"
SectionEnd

Section "Morifari Diagonal Viaduct Rail Station" viaduct_rail6
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots\Rail Stations"
  SetOverwrite ifnewer
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari Diagonal Viaduct Rail Station.SC4Lot"
  SetOutPath "$z___NAM\z Props and Models"
  File "Transit Lots\Morifari Diagonal and Straight Rail Stations\Morifari_Diagonal_and_Straight_Rail_Station.dat"
  File "Transit Lots\Props and Models\EL Network Props.dat"
SectionEnd
SectionGroupEnd
SectionGroupEnd
SectionGroupEnd

SectionGroup /e "!Additional Features and Customizations" secgrp4
SectionGroup "Additional Bridges" plugin1
Section "Basic Additional Bridges" bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\NetworkAddonMod_Additional_Bridges_Plugin.dat"
  File "Additional Bridges\Additional Bridges.txt"
SectionEnd

SectionGroup "Avenue Bridges" bridge2
Section "JENX PARIS Pont Alexandre III" avenue_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Avenue Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Avenue Bridges\JENXPARIS_Pont_Alexandre_III\NetworkAddonMod_Pont_AlexandreIII.dat"
  SetOutPath "$INSTDIR\Additional Bridges\Bridge Props and Models"
  File "Additional Bridges\Road Bridges\JENXPARISPontNeuf\JENXPARIS_Prop_Bridge_Light_Cones_R1.dat"
SectionEnd

Section "Millau Viaduct" avenue_bridge2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Avenue Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Avenue Bridges\NetworkAddonMod_Millau_Viaduct\NetworkAddonMod_Millau_Viaduct.dat"
SectionEnd
SectionGroupEnd

SectionGroup "El Rail Bridges" bridge3
Section "Concrete Box Girder El Rail Bridge" elrail_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\El Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\El Rail Bridges\NetworkAddonMod_El_Rail_Bridge_Pack\NetworkAddonMod_Concrete_El-Rail_Bridge.dat"
SectionEnd

Section "Steel Bailey Under Truss El Rail Bridge" elrail_bridge2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\El Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\El Rail Bridges\NetworkAddonMod_El_Rail_Bridge_Pack\NetworkAddonMod_Undertruss_El-Rail_Bridge.dat"
SectionEnd

Section "Cable Stayed El Rail Bridge" elrail_bridge3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\El Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\El Rail Bridges\NetworkAddonMod_El_Rail_Bridge_Pack\NetworkAddonMod_Cable_Stayed_El-Rail_Bridge.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Elevated Highway Bridges" bridge4
Section "Jeronij TsingMa Single Deck Bridge" elhighway_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Elevated Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Elevated Highway Bridges\Jeronij_TsingMa_Single_Deck_Bridge\NetworkAddonMod_Tsing_Ma_Bridge.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Ground Highway Bridges" bridge5
Section "Akashi Kaikyo Bridge" grndhighway_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Ground Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Ground Highway Bridges\NetworkAddonMod_Akashi_Kaikyo_Bridge\NetworkAddonMod_Akashi_Kaikyo_Bridge.dat"
SectionEnd
SectionGroupEnd

SectionGroup "High Speed Rail Bridges" bridge6
Section "Basic HSR Bridge" hsr_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_HSR_Bridge.dat"
SectionEnd

Section "Basic GHSR Bridge" hsr_bridge2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_GHSR_Bridge.dat"
SectionEnd

Section "Concrete Box-Girder GHSR Bridge" hsr_bridge3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Box_Girder_GHSR_Bridge.dat"
SectionEnd

Section "Cable Stayed HSR Bridge" hsr_bridge4
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Cable_Stayed_HSR_Bridge.dat"
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_HSR_Bridge_Props.dat"
SectionEnd

Section "Cable Stayed GHSR Bridge" hsr_bridge5
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Cable_Stayed_GHSR_Bridge.dat"
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_HSR_Bridge_Props.dat"
SectionEnd

Section "HSR Concrete Pier Bridge" hsr_bridge6
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Concrete_HSR_Bridge.dat"
SectionEnd

Section "GHSR Concrete Pier Bridge" hsr_bridge7
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Concrete_GHSR_Bridge.dat"
SectionEnd

Section "HSR Suspension Bridge" hsr_bridge8
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_High_Speed_Rail_Suspension_Bridge.dat"
SectionEnd

Section "Bailey Truss HSR Bridge" hsr_bridge9
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_LatticeGrid_HSR_Bridge.dat"
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_HSR_Bridge_Props.dat"
SectionEnd

Section "Warren Thru-Truss GHSR Bridge" hsr_bridge10
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_ThruTruss_GHSR_Bridge.dat"
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_HSR_Bridge_Props.dat"
SectionEnd

Section "Fences for HSR and GHSR Bridges" hsr_bridge11
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\High Speed Rail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_HSR_Bridge_Fence_Props.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Monorail Bridges" bridge7
Section "AIT Concrete Pier Monorail Bridge" monorail_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Monorail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Monorail Bridges\NetworkAddonMod_Monorail_Bridges\NetworkAddonMod_AITPier_Monorail_Bridge.dat"
SectionEnd

Section "Cable-Stayed Monorail Bridge" monorail_bridge2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Monorail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Monorail Bridges\NetworkAddonMod_Monorail_Bridges\NetworkAddonMod_Cable_Stayed_Monorail_Bridge.dat"
SectionEnd

Section "Monorail Suspension Bridge" monorail_bridge3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Monorail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Monorail Bridges\NetworkAddonMod_Monorail_Bridges\NetworkAddonMod_Monorail_Suspension_Bridge.dat"
SectionEnd

Section "Concrete Y-Pier Monorail Bridge" monorail_bridge4
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Monorail Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Monorail Bridges\NetworkAddonMod_Monorail_Bridges\NetworkAddonMod_YPier_Monorail_Bridge.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Network Widening Mod Bridges" bridge15
Section "RD-4 Bridge" nwm_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Network Widening Mod Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Network Widening Mod Bridges\NetworkAddonMod_RD4_Bridge.dat"
SectionEnd

Section "RD-6 Bridge" nwm_bridge2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Network Widening Mod Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Network Widening Mod Bridges\NetworkAddonMod_RD6_Bridge.dat"
SectionEnd
SectionGroupEnd


SectionGroup "Railway Bridges" bridge8
Section "Gltzsch Viaduct" rail_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\Goeltzschtalbruecke\Goeltzschtalbruecke.dat"
SectionEnd

Section "JRJ Warzone Bridge" rail_bridge2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File /r "Additional Bridges\Railway Bridges\JRJ Warzone Bridge"
SectionEnd

Section "Garabit Viaduct" rail_bridge3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Garabit_Viaduct\NetworkAddonMod_Garabit_Rail_Bridge.dat"
SectionEnd

Section "Howe Truss Rail Bridge (Standard)" rail_bridge4
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Howe_Truss_Rail_Bridge\NetworkAddonMod_Howe_Truss_Bridge.dat"
SectionEnd

Section "Howe Truss Rail Bridge (Single Track)" rail_bridge5
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Howe_Truss_Rail_Bridge\NetworkAddonMod_Howe_Truss_STR_Bridge.dat"
SectionEnd

Section "Metal Arch Rail Bridge" rail_bridge6
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Metal_Arch_Rail_Bridge\NetworkAddonMod_Metal_Arch_Rail_Bridge.dat"
SectionEnd

Section "Metal Pylon Bridge" rail_bridge7
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Metal_Pylon_Bridge\NetworkAddonMod_Metal_Pylon_Rail_Bridge.dat"
SectionEnd

Section "Modern Rail Bridge" rail_bridge8
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Modern_Rail_Bridge\NetworkAddonMod_Modern_Rail_Bridge.dat"
SectionEnd

Section "Plate Girder Single Track Rail Bridge" rail_bridge9
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Plate_Girder_STR_Bridge\NetworkAddonMod_Plate_Girder_STR_Bridge.dat"
SectionEnd

SectionGroup "Wooden Trestle Single Track Rail Bridge" rail_bridge10
Section "Bridge Structure" wooden_trestle_rail_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges\Wooden Trestle STR Bridge"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Wooden_Trestle_STR_Bridge\NetworkAddonMod_Wooden_Trestle_STR_Bridge.dat"
SectionEnd

Section /o "Stronger Wake Effect" wooden_trestle_rail_bridge2
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges\Wooden Trestle STR Bridge"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Wooden_Trestle_STR_Bridge\TS_Wooden_Trestle_STR_All_Wake.dat"
SectionEnd

Section /o "Weaker Wake Effect" wooden_trestle_rail_bridge3
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges\Wooden Trestle STR Bridge"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_Wooden_Trestle_STR_Bridge\TS_Wooden_Trestle_STR_Alternating_Wake.dat"
SectionEnd
SectionGroupEnd

Section "Royal Albert Single Track Rail Bridge" rail_bridge11
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\Royal_Albert_STR_Bridge\Royal_Albert_STR_Bridge.dat"
SectionEnd

Section "PvM JRJ Green Garabit Rail Bridge" rail_bridge12
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Railway Bridges\NetworkAddonMod_PvM_Garabit_Green_Rail_JRJ.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Real Highway Bridges" bridge9
Section "RHW-2 Concrete Girder Bridge" rhw_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-2_Concrete_Girder_Bridge.dat"
SectionEnd

Section "RHW-2 Small Steel Arch Bridge" rhw_bridge2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-2_Small_Steel_Arch_Bridge.dat"
SectionEnd

Section "RHW-4 Concrete Arch Bridge" rhw_bridge16
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4S_Concrete_Arch_Bridge.dat"
SectionEnd

Section "RHW-4 Large Steel Arch Bridge" rhw_bridge3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Large_Steel_Arch_Bridge.dat"
SectionEnd

Section "RHW-4 Steel Girder Bridge" rhw_bridge4
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Steel_Girder_Bridge.dat"
SectionEnd

Section "RHW-4 Steel Girder Bridge Dual" rhw_bridge5
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Steel_Girder_Bridge_Dual.dat"
SectionEnd

Section "RHW-4 Steel Girder Bridge Dual 2" rhw_bridge5a
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Steel_Girder_Bridge_Dual_2.dat"
SectionEnd

Section "RHW-4 Suspension Bridge Compact" rhw_bridge6
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Suspension_Bridge_Compact.dat"
SectionEnd

Section "RHW-6S Cable-Stayed Bridge Compact" rhw_bridge7
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-6S_Cable-Stayed_Bridge_Compact.dat"
SectionEnd

Section "RHW-6S Concrete Arch Bridge" rhw_bridge8
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-6S_Concrete_Arch_Bridge.dat"
SectionEnd

Section "RHW-6S Concrete Arch Bridge Dual" rhw_bridge9
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-6S_Concrete_Arch_Bridge_Dual.dat"
SectionEnd

Section "RHW-6S Steel Arch Bridge Compact" rhw_bridge10
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-6S_Steel_Arch_Bridge_Compact.dat"
SectionEnd

Section "RHW-8S Undertruss Bridge" rhw_bridge11
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-8S_Undertruss_Bridge.dat"
SectionEnd

Section "RHW-10S Cable Stayed Bridge" rhw_bridge12
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-10S_Cable_Stayed_Bridge.dat"
SectionEnd

Section "RHW-10S Large Concrete Arch" rhw_bridge13
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-10S_Large_Concrete_Arch.dat"
SectionEnd

Section "RHW-MIS Bridges" rhw_bridge14
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-MIS_Bridges.dat"
SectionEnd

Section "DDRHW-4 Basic Bridge" rhw_bridge15
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Highway Bridges\NetworkAddonMod_DDRHW-4_Basic_Bridge.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Real Railway Mod Bridges" bridge16
Section "Single-Track Timber Trestle RRW Bridge" rrw_bridge1
SectionIn 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Railway Bridges\NetworkAddonMod_RRW_1_Timber_Trestle.dat"
  SetOutPath "$INSTDIR\Additional Bridges\Real Railway Bridges\Wake Effects RRW"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Railway Bridges\Wake Effects RRW\Timber Trestle Wake Effect.dat"
SectionEnd

Section "Dual-Track Iron Girder RRW Bridge" rrw_bridge2
SectionIn 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Railway Bridges\NetworkAddonMod_RRW_2_Iron_Girder.dat"
  SetOutPath "$INSTDIR\Additional Bridges\Real Railway Bridges\Wake Effects RRW"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Railway Bridges\Wake Effects RRW\Iron Girder Wake Effect.dat"
SectionEnd

Section "Dual-Track Steel Overtruss RRW Bridge" rrw_bridge3
SectionIn 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Railway Bridges\NetworkAddonMod_RRW_2_Steel_Overtruss.dat"
  SetOutPath "$INSTDIR\Additional Bridges\Real Railway Bridges\Wake Effects RRW"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Railway Bridges\Wake Effects RRW\Steel Overtruss Wake Effect.dat"
SectionEnd

Section "Dual-Track Stone Arch RRW Bridge" rrw_bridge4
SectionIn 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Real Railway Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Real Railway Bridges\NetworkAddonMod_RRW_2_Stone_Arch.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Road Bridges" bridge10
Section "Kwanyoni Bridge" road_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\CSX Kwanyoni Bridge\NetworkAddonMod_Kwanyoni_Bridge.dat"
SectionEnd

Section "DT Road Bridge" road_bridge2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\DT Road Bridge\NetworkAddonMod_Dusktrooper_Road_Bridge.dat"
SectionEnd

Section "JENX Tower Bridge" road_bridge3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\JENX Tower Bridge\NetworkAddonMod_Tower_Bridge.dat"
  SetOutPath "$INSTDIR\Additional Bridges\Bridge Props and Models"
  File "Additional Bridges\Road Bridges\JENXPARISPontNeuf\JENXPARIS_Prop_Bridge_Light_Cones_R1.dat"
SectionEnd

Section "JENX PARIS Pont Royal" road_bridge4
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\JENXPARIS_Pont_Royal\NetworkAddonMod_Pont_Royal_Bridge.dat"
  SetOutPath "$INSTDIR\Additional Bridges\Bridge Props and Models"
  File "Additional Bridges\Road Bridges\JENXPARISPontNeuf\JENXPARIS_Prop_Bridge_Light_Cones_R1.dat"
SectionEnd

Section "JENX PARIS Pont Saint Michel" road_bridge5
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\JENXPARIS_Pont_Saint_Michel\NetworkAddonMod_Pont_Saint_Michel_Bridge.dat"
  SetOutPath "$INSTDIR\Additional Bridges\Bridge Props and Models"
  File "Additional Bridges\Road Bridges\JENXPARISPontNeuf\JENXPARIS_Prop_Bridge_Light_Cones_R1.dat"
SectionEnd

Section "JENX PARIS Pont Neuf (Road)" road_bridge6
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges\JENX PARIS Pont Neuf"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\JENXPARISPontNeuf\NetworkAddonMod_Pont_Neuf_Bridge_Road.dat"
  SetOutPath "$INSTDIR\Additional Bridges\Bridge Props and Models"
  File "Additional Bridges\Road Bridges\JENXPARISPontNeuf\JENXPARIS_Prop_Bridge_Light_Cones_R1.dat"
SectionEnd

Section "Krummbach Bridge" road_bridge7
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\JRJ_Krummbach_Bridge_Road\NetworkAddonMod_Krummbach_Bridge.dat"
SectionEnd

Section "Old Road Bridge" road_bridge8
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\NetworkAddonMod_Old_Road_Bridge\NetworkAddonMod_Old_Road_Bridge.dat"
SectionEnd

Section "Pont Sant Angelo" road_bridge9
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\PontSantAngelo.dat"
SectionEnd

Section "Wooden Covered Road Bridge" road_bridge10
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\Wooden Covered Road Bridge\NetworkAddonMod_Wooden_Covered_Bridge.dat"
SectionEnd
SectionGroupEnd

Section "Rural Street and Rail Bridge" bridge11
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Rural Street and Rail Bridge\NetworkAddonMod_Rural_Street_and_Rail_Bridge.dat"
SectionEnd

Section "Street Addon Mod (SAM) Bridges" bridge12
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Street Addon Mod Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Street Addon Mod Bridges\Street Addon Mod Bridges.dat"
SectionEnd

SectionGroup "Street Bridges" bridge13
Section "Concrete Street Bridge" street_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Street Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Street Bridges\NetworkAddonMod_Concrete_Street_Bridge\NetworkAddonMod_Concrete_Street_Bridge.dat"
SectionEnd

Section "Covered Street Bridge" street_bridge2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Street Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Street Bridges\Covered_Street_Bridge.dat"
SectionEnd

Section "JENX PARIS Pont Neuf (Street)" street_bridge3
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Street Bridges\JENX PARIS Pont Neuf"
  SetOverwrite ifnewer
  File "Additional Bridges\Road Bridges\JENXPARISPontNeuf\NetworkAddonMod_Pont_Neuf_Bridge_Street.dat"
  File "Additional Bridges\Road Bridges\JENXPARISPontNeuf\JENXPARIS_Prop_Bridge_Light_Cones_R1.dat"
SectionEnd

Section "Steel Girder Street Bridge" street_bridge4
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Street Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Street Bridges\Steel_Girder_Street_Bridge.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Tram in Road Bridges" bridge14
Section "Pont Notre Dame" TiR_bridge1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Additional Bridges\Tram in Road Bridges"
  SetOverwrite ifnewer
  File "Additional Bridges\Tram in Road Bridges\JENXPARIS_Pont_Notre_Dame_GLR-in-Road\NetworkAddonMod_Pont_Notre_Dame_TIR.dat"
  File "Additional Bridges\Road Bridges\JENXPARISPontNeuf\JENXPARIS_Prop_Bridge_Light_Cones_R1.dat"
SectionEnd
SectionGroupEnd
SectionGroupEnd

Section "Bridge Height Mod" bridge_height
SectionIn 2 3 4
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  File "NetworkAddonMod_BridgeHeightMod.dat"
SectionEnd

SectionGroup "Custom Menu Icon Layouts" sec5
Section "Custom Highway Menu" menu1
SectionIn 3 4
  SetOutPath "$INSTDIR\Custom Menu Icon Layouts"
  SetOverwrite ifnewer
  File "Custom Menu Icon Layouts\NetworkAddonMod_Custom_Highway_Menu_Plugin_Optional.dat"
SectionEnd

Section "Custom Rail Menu" menu2
SectionIn 3 4
  SetOutPath "$INSTDIR\Custom Menu Icon Layouts"
  SetOverwrite ifnewer
  File "Custom Menu Icon Layouts\NetworkAddonMod_Custom_Rail_Menu_Plugin_Optional.dat"
SectionEnd

Section "Custom Misc. Transportation Menu" menu3
SectionIn 3 4
  SetOutPath "$INSTDIR\Custom Menu Icon Layouts"
  SetOverwrite ifnewer
  File "Custom Menu Icon Layouts\NetworkAddonMod_Custom_Misc_Transport_Menu_Plugin_Optional.dat"
SectionEnd
SectionGroupEnd

Section /o "Enable Decoupling of Networks and Rules" sec25
SectionEnd

Section "Extended Station Queries" sec31
SectionIn 2 3 4
  SetOutPath "$z___NAM\Mass Transit Lots"
  SetOverwrite ifnewer
  Delete "$z___NAM\Mass Transit Lots\NetworkAddonMod_Queries_*.dat"
  ${Select} $SC4Lang
  ${Case5} 3 5 6 9 20     ; German, Spanish, Swedish, Danish, and Polish
    File "Transit Lots\Extended Station Queries\NetworkAddonMod_Queries_Wide.dat"
  ${CaseElse}
    File "Transit Lots\Extended Station Queries\NetworkAddonMod_Queries_Standard.dat"
  ${EndSelect}
SectionEnd

Section "High Speed Rail Textures by vershner" hsr_tex
SectionIn 2 3 4
  SetOutPath "z___NAM\Cosmetic Addons"
  SetOverwrite ifnewer
  File "Cosmetic Addons\HighSpeedRail_vershner_texture.dat"
SectionEnd


SectionGroup "Hole Diggers and Ground Raisers" sec29
Section "Standard Hole Diggers and Ground Raisers" hole1
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Hole Diggers and Ground Raisers"
  SetOverwrite ifnewer
  File /r "Hole Diggers and Ground Raisers\Standard Lots"
SectionEnd

Section "Auto-Destruct Hole Diggers and Ground Raisers" hole2
SectionIn 2 3 4
  SetOutPath "$INSTDIR\Hole Diggers and Ground Raisers"
  SetOverwrite ifnewer
  File /r "Hole Diggers and Ground Raisers\Auto-Destruct Lots"
SectionEnd
SectionGroupEnd

Section "NAM Standard Station Features" sec36
SectionIn 1 2 3 4
SectionEnd

Section "Maxis Highway Interchange & Ramp Additions" sec27
SectionIn 2 3 4
  SetOutPath "$INSTDIR"
  SetOverwrite ifnewer
  File "NetworkAddonMod_HighwayInterchanges.dat"
SectionEnd

SectionGroup "One-Way Arrow Mods" sec7
Section /o "Eliminate One-Way Arrows" arrow1
  SetOutPath "$INSTDIR\Cosmetic Addons"
  SetOverwrite ifnewer
  ;File "Cosmetic Addons\NetworkAddonMod_OneWayRoad_Arrows_Reduction_Plugin.dat"
  ;SetOutPath "$INSTDIR\INRUL Overrides"
  ;File "INRUL Overrides\NetworkAddonMod_OneWayRoad_Arrows_Reduction_Plugin_INRULs.dat"
  ;SetOutPath "$INSTDIR\Cosmetic Addons"
  ;${If} ${SectionIsSelected} ${sec20}
  ;${OrIf} ${SectionIsPartiallySelected} ${sec20}
    File "Cosmetic Addons\NetworkAddonMod_NWM_OWR_arrow_remover.dat"
  ;${EndIf}
SectionEnd

Section /o "Reduce One-Way Arrows by Half" arrow2
  SetOutPath "$INSTDIR\Cosmetic Addons"
  SetOverwrite ifnewer
  File "Cosmetic Addons\NetworkAddonMod_OneWayRoad_Arrows_Half_Reduction_Plugin.dat"
  ${If} ${SectionIsSelected} ${sec19}
  ${OrIf} ${SectionIsPartiallySelected} ${sec19}
    File "Real Highway Mod\RealHighway_OneWayRoad_Roundabout_Arrows_Reduction_Plugin.dat"
  ${EndIf}
SectionEnd

Section /o "Eliminate One-Way Arrows at Roundabouts" arrow3
  SetOutPath "z___NAM\Cosmetic Addons"
  SetOverwrite ifnewer
  File "Cosmetic Addons\NetworkAddonMod_OneWayRoad_Roundabout_Arrows_Reduction_Plugin.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Rail Viaduct Puzzle Piece Style" sec6
Section "Grey Rocks (default)" style1
SectionIn 2 3 4
  Delete "$OUTDIR\NetworkAddonMod_Rail_Viaduct_Style_*.dat"
SectionEnd

Section /o "Brown Bricks" style2
  Delete "$OUTDIR\NetworkAddonMod_Rail_Viaduct_Style_*.dat"
  SetOutPath "$INSTDIR\Rail Textures"
  SetOverwrite ifnewer
  File "Rail\Rail Textures\NetworkAddonMod_Rail_Viaduct_Style_Brown.dat"
SectionEnd

Section /o "Red Bricks" style3
  Delete "$OUTDIR\NetworkAddonMod_Rail_Viaduct_Style_*.dat"
  SetOutPath "$INSTDIR\Rail Textures"
  SetOverwrite ifnewer
  File "Rail\Rail Textures\NetworkAddonMod_Rail_Viaduct_Style_Red.dat"
SectionEnd
SectionGroupEnd

SectionGroup "!Road Textures and Markings" sec32
SectionGroup /e "!Main Road Texture Style" road_texture_style1
Section /o "Maxis Standard Road Textures (American style)" road_texture1
  Call AmericanRoadTextures
SectionEnd

Section "Retextured Standard Road Textures (American style)" road_texture2
SectionIn 2 3 4
  Call AmericanRoadTextures
  File /r /x "zzzNAM_Retexture_and_Cosmetic_Mod_Culdesac_Plugin_Superhands.dat" /x "zzzNAM_Retexture_and_Cosmetic_Mod_NYC_Intersections_Optional.dat" /x "images" /x "*.htm" /x "*.url" /x "uninst.exe" "Road Textures\Standard Retexture and Cosmetic Mod"
SectionEnd

Function AmericanRoadTextures
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  ${If} ${SectionIsSelected} ${tram1}
    File "Road Textures\T-RAM North American Textures.dat"
  ${EndIf}
  ${If} $bRight = 0
    ${If} ${SectionIsSelected} ${sec19}
    ${OrIf} ${SectionIsPartiallySelected} ${sec19}
      SetOutPath "$z___NAM\Road Textures\Standard Retexture and Cosmetic Mod\z_LeftHandDriveSupport"
      SetOverwrite ifnewer
      File "Road Textures\Euro Cosmetic Re-Texture Mod\RHW\z0_Standard_LeftHandDriveSupport\z1_*"
    ${EndIf}
  ${EndIf}
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
FunctionEnd

Section /o "Standard Euro Road Textures" road_texture3
  Call EuroRoadTextures
SectionEnd

Section /o "Australian Euro Road Textures" road_texture4
  Call EuroRoadTextures
  ${If} ${SectionIsSelected} ${nwmgroup1}
  ${OrIf} ${SectionIsPartiallySelected} ${nwmgroup1}
    File "Road Textures\Euro Cosmetic Re-Texture Mod\NWM\NWM_v2_Euro_Textures_Mod_Australia_Alternative_Set\*.dat"
  ${EndIf}
SectionEnd

Section /o "Hamburg Euro Road Textures" road_texture5
  Call EuroRoadTextures
  ${If} ${SectionIsSelected} ${nwmgroup1}
  ${OrIf} ${SectionIsPartiallySelected} ${nwmgroup1}
    File "Road Textures\Euro Cosmetic Re-Texture Mod\NWM\NWM_v2_Euro_Textures_Mod_Hamburg_Alternative_Set\*.dat"
  ${EndIf}
SectionEnd

Section /o "Euro Road Textures - Single Solid Line" road_texture6
  Call EuroRoadTextures
  ${If} ${SectionIsSelected} ${nwmgroup1}
  ${OrIf} ${SectionIsPartiallySelected} ${nwmgroup1}
    File "Road Textures\Euro Cosmetic Re-Texture Mod\NWM\NWM_v2_Euro_Textures_Mod_SingleSolidLine_Alternative_Set\*.dat"
  ${EndIf}
SectionEnd
SectionGroupEnd

SectionGroup "Options for American-Style Road Textures" road_texture7a
Section /o "New York City-style Large Intersections" road_texture_option1b
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Standard Retexture and Cosmetic Mod\zzzNAM_Retexture_and_Cosmetic_Mod_NYC_Intersections_Optional.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Options for European-Style Road Textures" road_texture7
SectionGroup "Alternative Euro TuLEP Textures" road_texture_option1
Section /o "Dexter's UK Euro TuLEP Textures" tulep1
  SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod"
  SetOverwrite ifnewer
  File "Road Textures\Euro Cosmetic Re-Texture Mod\Alternative Texture Sets\z1_NetworkAddonMod_TurningLanes_Extension_Plugin_EuroTRM_DexterUK.dat"
SectionEnd

Section /o "Mandelsoft's Euro TuLEP Textures" tulep2
  SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod"
  SetOverwrite ifnewer
  File "Road Textures\Euro Cosmetic Re-Texture Mod\Alternative Texture Sets\z1_NetworkAddonMod_TurningLanes_Extension_Plugin_EuroTRM_MRTNRLN.dat"
SectionEnd

Section /o "Riiga's Euro TuLEP Textures (Dashed)" tulep3
  SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod"
  SetOverwrite ifnewer
  File "Road Textures\Euro Cosmetic Re-Texture Mod\Alternative Texture Sets\z2_Riiga_Euro_TuLEPs_Dashed.dat"
SectionEnd

Section /o "UK Old Euro TuLEP Textures" tulep4
  SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod"
  SetOverwrite ifnewer
  File /r "Road Textures\Euro Cosmetic Re-Texture Mod\Alternative Texture Sets\UK Old NAM TuLEPs"
  ${If} $bRight = 0
    SetOutPath "$INSTDIR\z_Left Hand Plugin"
    File "z_Left Hand Plugin\StreetAddonMod_LEFT_HAND_VERSIONS_ONLY_Required_Additional_Plugin.dat"
    File "z_Left Hand Plugin\z3_MRTNRLN_EuroTextures_RTL_Avenue_UKoldNAM_LHD.dat"
  ${EndIf}
SectionEnd
SectionGroupEnd

Section /o "Additional UK Texture Replacements" road_texture_option2
  SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod"
  SetOverwrite ifnewer
  File "Road Textures\Euro Cosmetic Re-Texture Mod\Alternative Texture Sets\z1_Dexter_UK_Textures.dat"
SectionEnd
SectionGroupEnd

SectionGroup "Alternate Arrow Textures" road_texture8
Section /o "Arrow Textures for Australia" alt_arrow1
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_AUS.dat"
SectionEnd

Section /o "Arrow Textures for Belgium" alt_arrow2
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_BE.dat"
SectionEnd

Section /o "Arrow Textures for Schellingen" alt_arrow3
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_BRS.dat"
SectionEnd

Section /o "Arrow Textures for Switzerland" alt_arrow4
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_CH.dat"
SectionEnd

Section /o "Arrow Textures for Germany" alt_arrow5
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_DE.dat"
SectionEnd

Section /o "Arrow Textures for Denmark" alt_arrow6
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_DK.dat"
SectionEnd

Section /o "Arrow Textures for France" alt_arrow7
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_FR.dat"
SectionEnd

Section /o "Arrow Textures for Imaginia" alt_arrow8
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_IM.dat"
SectionEnd

Section /o "Arrow Textures for the Netherlands" alt_arrow9
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_NL.dat"
SectionEnd

Section /o "Arrow Textures for Ontario" alt_arrow10
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_Ontario.dat"
SectionEnd

Section /o "Arrow Textures for Burgtheland" alt_arrow11
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_RBU.dat"
SectionEnd

Section /o "Arrow Textures for Sweden" alt_arrow12
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_SE.dat"
SectionEnd

Section /o "Arrow Textures for the United States" alt_arrow13
  SetOutPath "$z___NAM\Road Textures"
  SetOverwrite ifnewer
  File "Road Textures\Shared Arrow Sets\Shared_ArrowTextures_USA.dat"
SectionEnd
SectionGroupEnd

Section /o "Cul-de-Sacs" road_texture9
  SetOverwrite ifnewer
  ${If} ${SectionIsSelected} ${road_texture1}
  ${OrIf} ${SectionIsSelected} ${road_texture2}
    SetOutPath "$z___NAM\Road Textures\Standard Retexture and Cosmetic Mod"
    File "Road Textures\Standard Retexture and Cosmetic Mod\zzzNAM_Retexture_and_Cosmetic_Mod_Culdesac_Plugin_Superhands.dat"
  ${Else}
    SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod"
    File "Road Textures\Euro Cosmetic Re-Texture Mod\Alternative Texture Sets\z8_eurotexture_CulDeSac.dat"
  ${EndIf}
SectionEnd

Section /o "Asphalt Textures for Maxis Highways" road_texture10
  Delete "$z___NAM\Road Textures\Maxis Highway Asphalt\zzzMHW_Retexture_America.dat"
  SetOutPath "$z___NAM\a_Maxis Highway Textures"
  SetOverwrite ifnewer
  ${If} ${SectionIsSelected} ${road_texture1}
  ${OrIf} ${SectionIsSelected} ${road_texture2}
    File "Road Textures\Maxis Highway Asphalt\zzzMHW_Retexture_America.dat"
  ${Else}
    File "Road Textures\Maxis Highway Asphalt\zzzMHW_Retexture_Euro.dat"
  ${EndIf}
SectionEnd
SectionGroupEnd

Function EuroRoadTextures
  SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod"
  SetOverwrite ifnewer
  File "Road Textures\Euro Cosmetic Re-Texture Mod\SFBT_Legacy\*.dat"
  File "Road Textures\Euro Cosmetic Re-Texture Mod\NewTextures - ESSENTIAL\*.dat"
  ${If} ${SectionIsSelected} ${nwmgroup1}
  ${OrIf} ${SectionIsPartiallySelected} ${nwmgroup1}
    File /r "Road Textures\Euro Cosmetic Re-Texture Mod\NWM\NWM_v2_Euro_Textures_Mod"
  ${EndIf}
  ${If} ${SectionIsSelected} ${sec19}
  ${OrIf} ${SectionIsPartiallySelected} ${sec19}
    SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod\RHW"
    File /r "Road Textures\Euro Cosmetic Re-Texture Mod\RHW\0_Standard"
  ${EndIf}
  ${If} $bRight = 0
    SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod\z_LeftHandDriveSupport"
    File "Road Textures\Euro Cosmetic Re-Texture Mod\z_LeftHandDriveSupport\*"
    ${If} ${SectionIsSelected} ${sec19}
    ${OrIf} ${SectionIsPartiallySelected} ${sec19}
      File "Road Textures\Euro Cosmetic Re-Texture Mod\RHW\z0_Standard_LeftHandDriveSupport\z1_*"
    ${EndIf}
	${If} ${SectionIsSelected} ${rail1}
	  File "Road Textures\Euro Cosmetic Re-Texture Mod\RRW\z0_LeftHandDriveSupport\z4_*"
	${EndIf}
  ${EndIf}
  SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod"
  ${If} ${SectionIsSelected} ${elrailroad3}
    File "Transit Lots\Modern Overhanging Stations\El_Road_Textures_Euro_Med_High.dat"
  ${EndIf}
  SetOutPath "$z___NAM\Road Textures\Euro Cosmetic Re-Texture Mod\NWM_v2_Euro_Textures_Mod"
FunctionEnd

SectionGroup "Roundabouts and Other Interchanges" sec8
Section "Street Roundabouts" round2
SectionIn 3 4
  SetOutPath "$INSTDIR\Roundabouts"
  SetOverwrite ifnewer
  File "Roundabouts\NetworkAddonMod_Roundabouts_Streets_Plugin.dat"
  ${If} ${SectionIsSelected} ${fan3}
  SetOutPath "$INSTDIR\INRUL Overrides"
  File "INRUL Overrides\NetworkAddonMod_Roundabouts_Streets_x_draggable_FANs.dat"
  ${Else}
  SetOutPath "$INSTDIR\INRUL Overrides"
  File "INRUL Overrides\NetworkAddonMod_Roundabouts_Streets_Plugin_INRULs.dat"
  ${EndIf}
SectionEnd

Section "Road Roundabouts" round1
SectionIn 3 4
  SetOutPath "$INSTDIR\Roundabouts"
  SetOverwrite ifnewer
  File "Roundabouts\NetworkAddonMod_Roundabouts_Roads_Plugin.dat"
  ${If} ${SectionIsSelected} ${fan3}
  SetOutPath "$INSTDIR\INRUL Overrides"
    File "INRUL Overrides\NetworkAddonMod_Roundabouts_Roads_x_draggable_FANs.dat"
  ${Else}
  SetOutPath "$INSTDIR\INRUL Overrides"
  File "INRUL Overrides\NetworkAddonMod_Roundabouts_Roads_Plugin_INRULs.dat"
  ${EndIf}
SectionEnd

Section "Oneway Roundabouts" round3
SectionIn 3 4
  SetOutPath "$INSTDIR\Roundabouts"
  SetOverwrite ifnewer
  File "Roundabouts\NetworkAddonMod_Roundabouts_OneWayRoads_Plugin.dat"
  SetOutPath "$INSTDIR\INRUL Overrides"
  File "INRUL Overrides\NetworkAddonMod_Roundabouts_OneWayRoads_Plugin_INRULs.dat"
SectionEnd

Section "Avenue Roundabouts and Interchanges" round4
SectionIn 3 4
  SetOutPath "$INSTDIR\Roundabouts"
  SetOverwrite ifnewer
  File "Roundabouts\NetworkAddonMod_Roundabouts_Avenues_Plugin.dat"
SectionEnd

Section "Turbo Roundabouts" round5
SectionIn 3 4
  SetOutPath "$INSTDIR\Roundabouts"
  SetOverwrite ifnewer
  File "Roundabouts\NetworkAddonMod_Roundabouts_Turbo_Plugin.dat"
  ${If} $bRight = 0
    SetOutPath "$INSTDIR\z_Left Hand Plugin"
    File "z_Left Hand Plugin\NetworkAddonMod_Roundabouts_Turbo_LHD_Plugin.dat"
  ${EndIf}
SectionEnd
SectionGroupEnd

SectionGroup "Turning Lanes" sec9
Section "Road Turning Lanes" turn2
SectionIn 3 4
  SetOutPath "$INSTDIR\Turning Lanes"
  SetOverwrite ifnewer
  File "Turning Lanes\NetworkAddonMod_TurningLanes_Roads_Plugin.dat"
SectionEnd

Section "Avenue Turning Lanes" turn1
SectionIn 3 4
  SetOutPath "$INSTDIR\Turning Lanes"
  SetOverwrite ifnewer
  File "Turning Lanes\NetworkAddonMod_TurningLanes_Avenues_Plugin.dat"
  SetOutPath "$INSTDIR\INRUL Overrides"
  SetOverwrite ifnewer
  File "INRUL Overrides\NetworkAddonMod_TurningLanes_Avenues_Plugin_INRULs.dat"
SectionEnd

Section "FLEX Turn Lanes (FTLs)" turn4
SectionIn 3 4
  SetOutPath "$INSTDIR\Turning Lanes"
  SetOverwrite ifnewer
  File "Turning Lanes\NetworkAddonMod_TurningLanes_Flexible.dat"
SectionEnd

Section "One-Way Road Signalized Intersections and Turn Arrows (SITAP)" turn5
SectionIn 3 4
  SetOutPath "$INSTDIR\Turning Lanes"
  SetOverwrite ifnewer
  File "Turning Lanes\NetworkAddonMod_TurningLanes_OneWayRoadSignalization_Plugin.dat"
SectionEnd

Section "Turning Lane Extension Plugin (TuLEP) (Old/Deprecated)" turn3
SectionIn 3 4
  SetOutPath "$INSTDIR\Turning Lanes"
  SetOverwrite ifnewer
  File "Turning Lanes\NetworkAddonMod_TurningLanes_Extension_Plugin.dat"
SectionEnd

/*
*/
SectionGroupEnd

SectionGroup "Wide Radius Curves" sec13
Section "Wide Curves for Streets, Roads, and Avenues" curve1
SectionIn 3 4
  SetOutPath "$INSTDIR\Wide Radius Curves"
  SetOverwrite ifnewer
  File "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_Streets_Plugin.dat"
  File "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_*Roads_Plugin.dat"
  File "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_Avenues_Plugin.dat"
  File "Wide Radius Curves\zAvenue90degCurve_AlternativeTextures.dat"
SectionEnd

Section "Wide Curves for Rails" curve2
SectionIn 3 4
  SetOutPath "$INSTDIR\Wide Radius Curves"
  SetOverwrite ifnewer
  File "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_Rails_Plugin.dat"
  ${If} ${SectionIsSelected} ${rail1}
    File "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_RRW.dat"
  ${Else}
    File "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_Rails_Button.dat"
  ${EndIf}
SectionEnd

Section "Wide Curves for Monorail and Bullet Train" curve3
SectionIn 3 4
  SetOutPath "$INSTDIR\Wide Radius Curves"
  SetOverwrite ifnewer
  File "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_Monorail_Plugin.dat"
SectionEnd
SectionGroupEnd
SectionGroupEnd

Function FARR
  ${If} ${SectionIsSelected} ${rail1}
    File "Fractionally Angled Networks\NetworkAddonMod_FractionallyAngled_RRW.dat"
  ${EndIf}
FunctionEnd

Function FLUPs
  ${If} ${SectionIsSelected} ${sec19}
  ${OrIf} ${SectionIsPartiallySelected} ${sec19}
    File "Real Highway Mod\RealHighway_FLUPs.dat"
  ${EndIf}
FunctionEnd

Function RRW
	/*
  ${If} ${SectionIsSelected} ${rail2}
    File "Rail\RealRailway\RealRailway_Networks_STR.dat"
  ${EndIf}
  ${If} ${SectionIsSelected} ${rail6}
    File "Rail\RealRailway\RealRailway_Networks_L1_DTR.dat"
	File "Rail\RealRailway\RealRailway_Networks_L2_DTR.dat"
  ${EndIf}
  */
  ${If} ${SectionIsSelected} ${road_texture1}
  ${OrIf} ${SectionIsSelected} ${road_texture2}
    File "Rail\RealRailway\Props\RealRailway_Props_US.dat"
  ${Else}
    File "Rail\RealRailway\Props\RealRailway_Props_EU.dat"
  ${EndIf}
FunctionEnd

Function ClearStation0              ; Root function
FunctionEnd

Function AddStation0                ; Root function
FunctionEnd

!define _CurStation 0

!macro _StationOverride1 num subdir author station old_station type 
Section /o "-${station}" station${num}    ; Note:  The /o option doesn't work with hidden sections
  SetOutPath "$z___NAM\MTA Station Overrides\${subdir}\${author}"
  SetOverwrite ifnewer
  ${If} ${SectionIsSelected} ${sec36}
    File "Transit Lots\Station Overrides\${type}Complete\${subdir}\${author}\${station}"
  ${Else}
    File "Transit Lots\Station Overrides\${type}Simple\${subdir}\${author}\${station}"
  ${EndIf}
SectionEnd
!macroend

!macro _StationOverride subdir author station old_station
!define /math CurStation ${_CurStation} + 1
!undef _CurStation
!define _CurStation ${CurStation}
!insertmacro _StationOverride1 ${CurStation} "${subdir}" "${author}" "${station}" "${old_station}" ""
!insertmacro _StationOverride1 D${CurStation} "${subdir}" "${author}" "${station}" "${old_station}" "DAMN "

!define /math mnum ${CurStation} - 1

Function ClearStation${CurStation}
  Call ClearStation${mnum}
  !insertmacro UnselectSection ${station${CurStation}}
  !insertmacro UnselectSection ${stationD${CurStation}}
FunctionEnd

Function AddStation${CurStation}
  Call AddStation${mnum}
  nsArray::SetList Stations ${station${CurStation}} "${subdir}" "${author}" "${station}" "${old_station}" /end
FunctionEnd

!ifdef StationNum
!undef StationNum
!endif
!define StationNum ${CurStation}
!undef CurStation
!undef mnum
!macroend

!define StationOverride `!insertmacro _StationOverride`
!define NoSimple 1

/*
 * !_ New stations for the Station Overrides go here. _!
 * The first station name is the current one, while the second one (if present)
 * is a previous one.  If there are multiple previous ones, use multiple lines.
 * See "BSC_SimCityRailUtils_v2.dat" in this table for an extended example.
 */

${StationOverride} "El Rail Stations" "Ill Tonkso" "Utils1x1_TonksoBlueLineStation_0359_cf6731dc.SC4Lot" ""
${StationOverride} "El Rail Stations" "Ill Tonkso" "Utils1x1_TonksoRedLineStation_0359_af68132e.SC4Lot" ""
${StationOverride} "El Rail Stations" "morifari" "Embankment_Station_Free-Standing.dat" ""
${StationOverride} "El Rail Stations" "morifari" "Embankment_Station_Integrated.dat" ""
${StationOverride} "El Rail Stations" "Swamper77" "NAM Light Rail Station_ef780f62.SC4Lot" ""
${StationOverride} "El Rail Stations" "Swamper77" "NAM Light Rail-Bus Station_ef780f63.SC4Lot" ""
${StationOverride} "El Rail Stations" "TWrecks" "Caribou Elevated Rail Station New.SC4Lot" ""
${StationOverride} "El Rail Stations\UnderRailShops" "Deadwoods" "DEDWD_ElRailShops_3wide_afc60212.SC4Lot"  ""
${StationOverride} "El Rail Stations\UnderRailShops" "Deadwoods" "DEDWD_ElRailShops_4wide_4fc493c9.SC4Lot"  ""
${StationOverride} "El Rail Stations\UnderRailShops" "Deadwoods" "DEDWD_ElRailShops_5wide_afc5e523.SC4Lot" ""
${StationOverride} "El Rail Stations\UnderRailShops" "Deadwoods" "DEDWD_ElRailShops_6wide_afc5f8c4.SC4Lot"  ""
${StationOverride} "GLR and Tram Stations" "Andreas" "SFBT_GLR_in_Avenue_Station_b37aee39.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "Antoine" "Antoine_GLR_in_Avenue_No_Stairs_TSC_33c306f2.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "Antoine" "Antoine_GLR_in_Avenue_Stairs_TSC_b3c30745.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "GoaSkin" "GLR_Station_with_central_platform_8feeb38c.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "gshmails" "Shmails GLR Station #1 - Euro style_53a01f31.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "gshmails" "Shmails GLR Station #1_d39e48e0.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "gshmails" "Shmails GLR Station #2_939e493e.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "gshmails" "Shmails GLR Station #3 - Euro Style_d3a01d43.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "gshmails" "Shmails GLR Station #3_939e4979.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "gshmails" "ShmailsGLRStationAvenue1b_93ad3872.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "Ill Tonkso" "GLR_Ill_Tonkso_White_station_3x1_3020f26e.SC4Lot" ""
${StationOverride} "GLR and Tram Stations" "JEC" "cercaniasglrestacion_cfb202a9.SC4Lot" ""
${StationOverride} "Monorail Stations\UnderRailShops" "Deadwoods" "DEDWD_MonoRailShops_3wide_afc608cf.SC4Lot"  ""
${StationOverride} "Monorail Stations\UnderRailShops" "Deadwoods" "DEDWD_MonoRailShops_4wide_6fc49b71.SC4Lot"  ""
${StationOverride} "Monorail Stations\UnderRailShops" "Deadwoods" "DEDWD_MonoRailShops_5wide_afc5ea09.SC4Lot"  ""
${StationOverride} "Monorail Stations\UnderRailShops" "Deadwoods" "DEDWD_MonoRailShops_6wide_afc5f965.SC4Lot"  ""
${StationOverride} "Rail Stations" "barbyw" "BLS_JENX_Passenger_ Station_b50394bf.SC4Lot"  ""
${StationOverride} "Rail Stations" "Cogeo" "SemitransparentTrainStations_Lots.dat"  ""
${StationOverride} "Rail Stations" "Equinox" "DTB_TR_MANTA_1x3S_3134975a.SC4Lot" ""
${StationOverride} "Rail Stations" "frogface" "Estacao Da Luz.dat" ""
${StationOverride} "Rail Stations" "frogface" "FrogfaceStation_0d732a4b.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "BirmingsfieldInternational_b041ec19.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "ITS_Brenntia_Queen_Elizabeth_Station_131b2428.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "ITS_Charing_Cross_Railway_Station_90b220a5.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "ITS_NarrowModernBlue_30042e62.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "ITS_NDEX_Baron_Cross_d2a17d8e.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "ITS_NDEX_Hasbury_Station_7294481e.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "ITS_StPancras_Reissue_5139aa0d.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "NDEX_ITS_Langstrath_Central_f3608ea0.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "NDEX_ITS_Surbiton_73209a74.SC4Lot" ""
${StationOverride} "Rail Stations" "Ill Tonkso" "Utils2x2_Tonks4platformfinal_035B_4f8d9bc7.SC4Lot" ""
${StationOverride} "Rail Stations" "ITC" "Utils3x2_ITC Mission Style Medium Train Station_7664f02c.SC4Lot"  ""
${StationOverride} "Rail Stations" "Jasoncw" "Jasoncw - Large Train Station (2x4) fixed.SC4Lot" ""
${StationOverride} "Rail Stations" "Jasoncw" "Jasoncw - Medium Train Station (1x4) fixed.SC4Lot" ""
${StationOverride} "Rail Stations" "Jasoncw" "Jasoncw - Perry Station.SC4Lot" ""
${StationOverride} "Rail Stations" "Jasoncw" "Jasoncw - Small Train Station (1x2) fixed.SC4Lot" ""
${StationOverride} "Rail Stations" "JEC" "Utils2x2_Stadelhofen_0dff175c.SC4Lot" ""
${StationOverride} "Rail Stations" "logan123456" "Ut_25x14_logan123_Main_Railway_Station_9a59b654.SC4Lot"  ""
${StationOverride} "Rail Stations" "Marrast" "marrast_prs_compact_1x6_ce7e18c3.SC4Lot"  "marrast_prs_compact_1x6.dat"
${StationOverride} "Rail Stations" "Marrast" "marrast_prs_dual_2x6_ee7e97f8.SC4Lot"  "marrast_prs_dual_2x6.dat"
${StationOverride} "Rail Stations" "Marrast" "marrast_prs_medium_edd021e6.SC4Lot"  ""
${StationOverride} "Rail Stations" "Marrast" "mrrst_prs_diag_Bitlateral1_ae81ffd1.SC4Lot"  "mrrst_prs_dia_BILATERAL_approach.dat"
${StationOverride} "Rail Stations" "Marrast" "mrrst_prs_diag_Bitlateral2_0e82fd86.SC4Lot"  "mrrst_prs_dia_BILATERAL_approach.dat"
${StationOverride} "Rail Stations" "Marrast" "mrrst_prs_diag_Unitlateral1_ee89a8c1.SC4Lot"  "mrrst_prs_dia_UNILATERAL_approach.dat"
${StationOverride} "Rail Stations" "Marrast" "mrrst_prs_diag_Unitlateral2_ae89a8aa.SC4Lot"  "mrrst_prs_dia_UNILATERAL_approach.dat"
${StationOverride} "Rail Stations" "r102" "Utils2x2_PassengerRailStation_035Kappa_4d12f437.SC4Lot" ""
${StationOverride} "Rail Stations" "rajfurke" "dworzec_5d097f10.SC4Lot"  ""
${StationOverride} "Rail Stations" "SimGoober" "SG_4x5_PassengerDepot01_f098355e.SC4Lot"  ""
${StationOverride} "Rail Stations" "SimGoober" "SG_5x5_CentralTrainStation_f08c4dfb.SC4Lot"  ""
${StationOverride} "Rail Stations" "SimGoober" "SG_6x4_FreightRailStation_110598e2.SC4Lot"  ""
${StationOverride} "Rail Stations" "SimGoober" "SG_6x5_ClockTowerTrainStation_b0a6d460.SC4Lot"  ""
${StationOverride} "Rail Stations" "SimGoober" "SG_7x6_SimTropolisTrainStation_90cd0c41.SC4Lot"  ""
${StationOverride} "Rail Stations" "SimGoober" "SG_8x4_FreightRailStation_710ade6b.SC4Lot"  ""
${StationOverride} "Rail Stations" "xannepan" "JENX Gare du Nord V05_1471715c.SC4Lot" ""
${StationOverride} "Rail Stations" "xannepan" "JENXPARIS Gare Orsay_9b470b90.SC4Lot" ""
${StationOverride} "Rail Stations\Rail Utility Lots" "Deadwoods" "BSC_SimCityRailUtils_v2.dat"  "BSC_Railyard_CarParking_0e3e6419.SC4Lot"
${StationOverride} "Rail Stations\Rail Utility Lots" "Deadwoods" "BSC_SimCityRailUtils_v2.dat"  "BSC_Railyard_CarParking_1x1Filler_2e3e6f63.SC4Lot"
${StationOverride} "Rail Stations\Rail Utility Lots" "Deadwoods" "BSC_SimCityRailUtils_v2.dat"  "BSC_Railyard_GoodsPlatform_6e314775.SC4Lot"
${StationOverride} "Rail Stations\Rail Utility Lots" "Deadwoods" "BSC_SimCityRailUtils_v2.dat"  "BSC_Railyard_SignalBox_0e26c596.SC4Lot"
${StationOverride} "Rail Stations\Rail Utility Lots" "Deadwoods" "BSC_SimCityRailUtils_v2.dat"  "BSC_Railyard_StockPlatform_2e3e7a52.SC4Lot"
${StationOverride} "Rail Stations\Rail Utility Lots" "Deadwoods" "BSC_SimCityRailUtils_v2.dat"  "BSC_Railyard_WaterTower_ae3131be.SC4Lot"
${StationOverride} "Rail Stations\Rail Utility Lots" "Deadwoods" "BSC_SimCityRailUtils_v2.dat"  "BSC_Railyard_WorkersHuts_0e3e1de4.SC4Lot"
${StationOverride} "Rail Stations\Rail Utility Lots" "Deadwoods" "BSC_SimCityRailUtils_v2.dat"  "BSC_SimCityRailUtils.dat"

!macro ClearAllStations
  Call ClearStation${StationNum}
!macroend

!macro AddAllStations
  Call AddStation${StationNum}
!macroend

Function ClearStations
  !insertmacro ClearAllStations
FunctionEnd

Section "-BTM Cleanup"
SectionIn 2 3 4
  ${If} ${SectionIsSelected} ${btm1}
    SetOutPath "$z___NAM\Shinkansen Bullet Train Mod"
    SetOverwrite ifnewer
    ${Unless} ${SectionIsSelected} ${btm2}
      File "Bullet Train Mod\Ground Texture\ML Shinkansen MOD no ground texture.dat"
    ${EndIf}
    ${Unless} ${SectionIsSelected} ${btm3}
      File "Bullet Train Mod\Concrete Texture\ML Shinkansen MOD concrete texture.dat"
    ${EndIf}
  ${EndIf}
SectionEnd

Section "-El Rail Alternate Implementation Cleanup"
  ${If} ${SectionIsSelected} ${elrail_alt1}
    SetOutPath "$z___NAM\El Rail Alternate Implementation"
    SetOverwrite ifnewer
    ${IfNot} ${SectionIsSelected} ${elrail_alt2}
      File "El Rail\El Rail Alternate Implementation\Catenary and Fence Props\ML JPN ELR T21 No Catenary Prop.dat"
    ${EndIf}
    ${IfNot} ${SectionIsSelected} ${elrail_alt3}
      File "El Rail\El Rail Alternate Implementation\Catenary and Fence Props\ML JPN ELR T21 No Fence Prop.dat"
    ${EndIf}
    ${IfNot} ${SectionIsSelected} ${elrail_alt4}
      File "El Rail\El Rail Alternate Implementation\Ground Texure\No Ground Texture.dat"
    ${EndIf}
    ${IfNot} ${SectionIsSelected} ${elrail_alt5}
      File "El Rail\El Rail Alternate Implementation\Concrete Texture\Warm Color Concrete Texture.dat"
    ${EndIf}
  ${EndIf}
SectionEnd

Section "-RHW Bridge Cleanup"
SectionIn 2 3 4
  ${If} ${SectionIsSelected} ${bridge9}
  ${OrIf} ${SectionIsPartiallySelected} ${bridge9}
    SetOutPath "$INSTDIR\Additional Bridges\Real Highway Bridges"
    SetOverwrite ifnewer
    File "Additional Bridges\Real Highway Bridges\P57_Textures_ElevatedRHW_Template.dat"
;    File "Additional Bridges\Real Highway Bridges\Z_NetworkAddonMod_Bridges_Plugin_Controller_20-10-12.dat"
  ${EndIf}
SectionEnd

Section "-Extended Station Queries Cleanup"
SectionIn 1 2 3 4
  ${IfNot} ${SectionIsSelected} ${sec31}
    SetOutPath "$z___NAM\Mass Transit Lots"
    SetOverwrite ifnewer
    File "Transit Lots\Extended Station Queries\NetworkAddonMod_Queries_Simple.dat"
  ${EndIf}
SectionEnd

Section "-Additional Icons"
  SetShellVarContext all
  SetOutPath "$INSTDIR"
  WriteINIStr "$INSTDIR\Simtropolis.url" "InternetShortcut" "URL" "http://www.simtropolis.com"
  WriteINIStr "$INSTDIR\SC4Devotion.url" "InternetShortcut" "URL" "http://www.sc4devotion.com" ; if you only want to install one URL in the start menu, simply remove this line and similar lines below
  CreateDirectory "$SMPROGRAMS\Network Addon Mod" ; the start menu folder
  CreateShortCut "$SMPROGRAMS\Network Addon Mod\Simtropolis.com.lnk" "$INSTDIR\Simtropolis.url"
  CreateShortCut "$SMPROGRAMS\Network Addon Mod\SC4Devotion.com.lnk" "$INSTDIR\SC4Devotion.url"
  CreateShortCut "$SMPROGRAMS\Network Addon Mod\Uninstall Network Addon Mod.lnk" "$INSTDIR\uninst.exe"
  SetOutPath "$PROGRAMFILES\Traffic Simulator Configuration Tool"
;  IfFileExists "$PROGRAMFILES\Traffic Simulator Configuration Tool\NAM-TSCT.jar" 0 +3
;  CreateShortCut "$SMPROGRAMS\Network Addon Mod\Traffic Simulator Configuration Tool.lnk" "$PROGRAMFILES\Traffic Simulator Configuration Tool\NAM-TSCT.jar" "" "$PROGRAMFILES\Traffic Simulator Configuration Tool\TSCT_1.ico"
;  CreateShortCut "$DESKTOP\Traffic Simulator Configuration Tool.lnk" "$PROGRAMFILES\Traffic Simulator Configuration Tool\NAM-TSCT.jar" "" "$PROGRAMFILES\Traffic Simulator Configuration Tool\TSCT_1.ico"
SectionEnd

Section -Post
  WriteUninstaller "$INSTDIR\uninst.exe"
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayName" "${PRODUCT_NAME}"
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayIcon" "$INSTDIR\NAM logo.ico"
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_MINIMAL}
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "EstimatedSize" 1810
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "EstimatedSize" 434731
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "UninstallString" "$INSTDIR\uninst.exe"
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "DisplayVersion" "${PRODUCT_VERSION}"
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "URLInfoAbout" "${PRODUCT_WEB_SITE}"
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "Publisher" "${PRODUCT_PUBLISHER}"
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "NoModify" 1
  WriteRegStr ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}" "NoRepair" 1
SectionEnd

Function ComponentsLeave
  ${If} $KeepOldSimulator = ${SF_SELECTED}
    IfFileExists "$INSTDIR\NetworkAddonMod_Traffic_Plugin_*.dat" simulator_present 0
      MessageBox MB_OK|MB_ICONEXCLAMATION 'There is no older traffic simulator file in your NAM folder.  Please make another choice.  If you have a traffic simulator (and possibly data view file) in another folder, you can move them into your NAM folder at the end of this installation; you should then remove any other simulator or data view files from your NAM folder.  You may also download older traffic simulators from the "Previous NAM Simulators" download.  If you have another NAM folder, it should be removed from your Plugins folder before running the game.'
      Abort
simulator_present:
    IfFileExists "$INSTDIR\NetworkAddonMod_Traffic_Plugin_Z*.dat" 0 Not_Z
    GetFileTime "$INSTDIR\NetworkAddonMod_Traffic_Plugin_Z*.dat" $R0 $R1
    ${If} $R0 < 30055800                                       ; Simulator Z v2.2
      MessageBox MB_OK|MB_ICONEXCLAMATION 'You are using an obsolete version of Simulator Z.  Please select one of the NAM Simulators, which are built on Simulator Z, or select "I want to build a custom simulator", which will allow you to build a custom simulator based on the NAM Simulator later on.'
      Abort
    ${EndIf}
    Call FixComponents
    Return
Not_Z:
    Push $1
    Push $2
    Push $3
    FindFirst $1 $0 $INSTDIR\NetworkAddonMod_Traffic_Plugin_*.dat
    FindClose $1
    StrLen $1 $0
    IntOp $1 $1 - 3
    StrCpy $2 $0 $1
    StrCpy $3 "$2sav"
    Delete $INSTDIR\$3
    Rename $INSTDIR\$0 $INSTDIR\$3
    IfFileExists $INSTDIR\NetworkAddonMod_Volume_Data_View_*.dat 0 not_supported
    FindFirst $1 $0 $INSTDIR\NetworkAddonMod_Volume_Data_View_*.dat
    FindClose $1
    StrLen $1 $0
    IntOp $1 $1 - 3
    StrCpy $2 $0 $1
    StrCpy $3 "$2sav"
    Delete $INSTDIR\$3
    Rename $INSTDIR\$0 $INSTDIR\$3
not_supported:
    MessageBox MB_OK|MB_ICONEXCLAMATION 'Your traffic simulator is no longer recommended or supported for the NAM; it has been renamed to have a .sav extension.  You can upgrade to a version of the NAM Simulator that is compatible with your simulator by checking the box labeled "I want to build a custom simulator" in the main window, and following the instructions for building a compatible version of your simulator that will appear at the end of this installation.  Otherwise, please choose a different simulator.'
    Pop $3
    Pop $2
    Pop $1
    Abort
  ${ElseIf} $CustomizeSimulator = ${SF_SELECTED}
Java_again:
    StrCpy $1 0
Java_again2:
    ClearErrors
    ReadRegStr $0 HKLM "SOFTWARE\JavaSoft\Java Runtime Environment" "CurrentVersion"
    IfErrors 0 Java_Installed
    ${If} $1 = 0
      SetRegView 64
      StrCpy $1 1
      Goto Java_again2
    ${Endif}
    ClearErrors
    MessageBox MB_YESNO|MB_ICONEXCLAMATION 'Building a custom traffic simulator requires the use of a Java program, but you do not have Java installed.  If you have installation privileges and would like to install Java now, select "Yes".  Otherwise, select "No" and make a different choice for your traffic simulator, or exit the NAM installation and restart it from an account with installation privileges.' IDYES Install_Java
    Abort
Install_Java:
    ExecShell open "www.java.com"
    MessageBox MB_OK 'A browser window will now open, allowing you to download and install Java.  Click on "OK" once you have finished installing Java, or if you decide not to install Java now.'
    goto Java_again
Java_Installed:
    SetRegView 32
    ReadRegStr $0 HKCU "Software\Traffic Simulator Configuration Tool" "Install Path"
    IfErrors +2
    IfFileExists "$0\TSCT.jar" CL1
    GetTempFileName $0 "$ProgramFiles"
    IfFileExists $0 Select_Custom
    MessageBox MB_YESNO|MB_ICONEXCLAMATION 'WARNING:  Your selection requires installing the Traffic Simulator Configuration Tool.  Normally, this is installed in the Program Files folder.  However, you do not have permission to write into this folder.  Select "Yes" to continue with this selection, and select a folder such as "My Documents" when prompted later on, or select "No" and either make another traffic simulator selection, or cancel the NAM installation and rerun it with the necessary privileges.' IDYES Select_Custom
    Abort
Select_Custom:
    Delete $0
  ${EndIf}
CL1:
  Call FixComponents
  StrCpy $WriteController 1
;  Call ProcessController
FunctionEnd

Function FixComponents
  ${If} ${SectionIsSelected} ${sec23}       ;Project Symphony
    SectionSetFlags ${rhw00} ${SF_SELECTED}
    SectionSetFlags ${rhw02} ${SF_SELECTED}
    SectionSetFlags ${rhw03} ${SF_SELECTED}
    SectionSetFlags ${rhw22} ${SF_SELECTED}
    SectionSetFlags ${rhw23} ${SF_SELECTED}
  ${EndIf}
  ${If} ${SectionIsPartiallySelected} ${sec24}
  ${AndIfNot} ${SectionIsSelected} ${btm1}
    SectionSetFlags ${btm1} ${SF_SELECTED}
  ${EndIf}
  ${If} ${SectionIsSelected} ${sec4}
    StrCpy $Cleanitol 1
  ${Else}
    StrCpy $Cleanitol 0
  ${EndIf}
  ${If} ${SectionIsSelected} ${sec25}
    WriteRegDWORD HKCU "Software\Network Addon Mod" "Decoupled Networks and Rules" 1
  ${Else}
    WriteRegDWORD HKCU "Software\Network Addon Mod" "Decoupled Networks and Rules" 0
  ${EndIf}
  ${If} ${SectionIsSelected} ${sec36}
    WriteRegDWORD HKCU "Software\Network Addon Mod" "NAM Standard Stations" 1
  ${Else}
    WriteRegDWORD HKCU "Software\Network Addon Mod" "NAM Standard Stations" 0
  ${EndIf}
FunctionEnd

!macro _ShowConfirmation item text level
  Push $0
  Push $1
  Push $3
  StrCpy $1 "- ${text}"         ;Must come first
  StrCpy $0 ${item}
  StrCpy $3 ${level}
  Call ConfirmOption
  Pop $3
  Pop $1
  Pop $0
!macroend

Function ConfirmOption
  SectionGetFlags $0 $2
  IntOp $4 ${SF_SELECTED} | ${SF_PSELECTED}
  IntOp $2 $2 & $4
  ${If} $2 = ${SF_SELECTED}
  ${OrIf} $2 = ${SF_PSELECTED}
    ${IfThen} $3 = 2 ${|} StrCpy $1 "    $1" ${|}
    ${IfThen} $3 = 3 ${|} StrCpy $1 "        $1" ${|}
    ${IfThen} $3 = 4 ${|} StrCpy $1 "            $1" ${|}
    !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE $1
  ${EndIf}
FunctionEnd

!define ShowConfirmation `!insertmacro _ShowConfirmation`

!macro _ShowTrafficSimulator num capacity
  !insertmacro SectionFlagIsSet ${capa${num}} ${SF_SELECTED} 0 EndTS${num}
    Push $1
    StrCpy $1 ${capacity}
    Call ShowSimulatorCapacity
    Pop $1
EndTS${num}:
!macroend

Function ShowSimulatorCapacity
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "Traffic simulator type:  $1 capacity"
FunctionEnd

!define ShowTrafficSimulator `!insertmacro _ShowTrafficSimulator`

!macro _ShowAutomataController num type
  !insertmacro SectionFlagIsSet ${auto${num}} ${SF_SELECTED} 0 EndAC${num}
    Push $1
    StrCpy $1 "${type}"
    ${If} ${SectionIsSelected} ${auto0}
      StrCpy $1 "$1 (Persistent)"
    ${EndIf}
    Call ShowControllerType
    Pop $1
EndAC${num}:
!macroend

Function ShowControllerType
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "Automata controller type:  $1"
FunctionEnd

!define ShowAutomataController `!insertmacro _ShowAutomataController`

!macro _ShowRHWConfirmation level
  ${ShowConfirmation} ${rhw${level}} "RHW L${level} Networks" 2
!if ${level} < 3
  ${ShowConfirmation} ${rhw${level}0} "RHW L${level} RHW-2" 3
  ${ShowConfirmation} ${rhw${level}1} "RHW L${level} RHW-3" 3
!endif
  ${ShowConfirmation} ${rhw${level}2} "RHW L${level} MIS" 3
  ${ShowConfirmation} ${rhw${level}3} "RHW L${level} RHW-4" 3
  ${ShowConfirmation} ${rhw${level}4} "RHW L${level} RHW-6S" 3
!if ${level} < 3
  ${ShowConfirmation} ${rhw${level}5} "RHW L${level} RHW-8S" 3
  ${ShowConfirmation} ${rhw${level}6} "RHW L${level} RHW-10S" 3
  ${ShowConfirmation} ${rhw${level}7} "RHW L${level} RHW-6C" 3
  ${ShowConfirmation} ${rhw${level}8} "RHW L${level} RHW-8C" 3
!endif
!macroend

!define ShowRHWConfirmation `!insertmacro _ShowRHWConfirmation`

Function ConfirmText
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "Main Installation Location:"
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "  $INSTDIR"
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "Documentation Location:"
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "  $NAMAuxDir\Documentation"
  ${If} ${SectionIsSelected} ${sec4}
    !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "Cleanitol and the Station Updater will be run"
  ${EndIf}
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE ""
  IntOp $0 $UMUI_INSTALLFLAG & ${UMUI_MINIMAL}
  ${If} $0 = 0
    IntOp $0 $UMUI_INSTALLFLAG & ${UMUI_STANDARD}
    ${If} $0 = 0
      IntOp $0 $UMUI_INSTALLFLAG & ${UMUI_COMPLETE}
      ${If} $0 = 0
        StrCpy $0 "Custom Installation"
      ${Else}
        StrCpy $0 "Complete Installation"
      ${EndIf}
    ${Else}
      StrCpy $0 "Networks and Traffic Simulator"
    ${EndIf}
  ${Else}
    StrCpy $0 "Traffic Simulator and maxis Fixes Only"
  ${EndIf}
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "Network Controller:  $0"
  !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
    ${If} ${SectionIsSelected} ${controller1}
      StrCpy $0 "Right"
    ${Else}
      StrCpy $0 "Left"
    ${EndIf}
    !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "Traffic Driving Side:  $0 side of road"
    ${ShowTrafficSimulator} 1 Classic
    ${ShowTrafficSimulator} 2 Low
    ${ShowTrafficSimulator} 3 Medium
    ${ShowTrafficSimulator} 4 High
    ${ShowTrafficSimulator} 5 Ultra
    !insertmacro SectionFlagIsSet ${capa6} ${SF_SELECTED} 0 CustomizeTraffic
      !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "The current traffic simulator will be retained."
      Goto Zones
CustomizeTraffic:
    !insertmacro SectionFlagIsSet ${capa7} ${SF_SELECTED} 0 Zones
      !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "Traffic simulator type:  To be customized"
Zones:
    !insertmacro SectionFlagIsSet ${sec16} ${SF_SELECTED} 0 Zones1
      StrCpy $0 "New (NAM)"
      Goto Zones2
Zones1:
      StrCpy $0 "Standard (Maxis)"
Zones2:
    !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "Zones Data View: $0"
    ${ShowAutomataController} 1 "Standard"
    ${ShowAutomataController} 2 "Standard 24h"
    ${ShowAutomataController} 3 "Radical"
    ${ShowAutomataController} 4 "Radical 24h"
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  ${If} ${SectionIsPartiallySelected} ${secgrp2}
    !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE ""
    !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "The following networks and/or network expansions will be installed:"
  ${EndIf}
  ${ShowConfirmation} ${btm1} "Bullet Train Mod (BTM) by Moonlight" 1
  ${If} ${SectionIsSelected} ${btm1}
    ${ShowConfirmation} ${btm2} "Ground Texture" 2
    ${IfNot} ${SectionIsSelected} ${btm3}
      !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "    - Primary Concrete Texture"
    ${EndIf}
    ${ShowConfirmation} ${btm3} "Alternate Concrete Texture" 2
    ${ShowConfirmation} ${btm4} "Fence Prop" 2
    ${ShowConfirmation} ${btm5} "N700 Series Shinkansen Train" 2
  ${EndIf}
  StrCpy $0 "Canal Addon Mod (CAN-AM) -"
  ${ShowConfirmation} ${can1} "$0 SimGoober's Canals" 1
  ${ShowConfirmation} ${can2} "$0 Callagrafx' Canals" 1
  ${ShowConfirmation} ${plugin2} "Diagonal Streets" 1
  ${ShowConfirmation} ${plugin6} "Double-Height Monorail / Bullet Train Mod" 1
  ${ShowConfirmation} ${plugin5} "El Rail" 1
  ${ShowConfirmation} ${elrail1} "El Rail Alternate Implementation" 2
  ${ShowConfirmation} ${elrail_alt1} "Core El Rail Network" 3
  ${ShowConfirmation} ${elrail_alt2} "El Rail Catenaries" 3
  ${ShowConfirmation} ${elrail_alt3} "El Rail Fence Props" 3
  ${ShowConfirmation} ${elrail_alt4} "El Rail Ground Texture" 3
  ${ShowConfirmation} ${elrail_alt5} "El Rail Cool Color Concrete Texture" 3
  ${If} ${SectionIsSelected} ${elrail_alt1}
  ${AndIfNot} ${SectionIsSelected} ${elrail_alt5}
    !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "    - El Rail Warm Color Concrete Texture"
  ${EndIf}
  ${ShowConfirmation} ${elrail2a} "El Rail over Avenue Networks" 2
  ${ShowConfirmation} ${elrail2} "El Rail over Road Networks" 2
  ${ShowConfirmation} ${elrail3} "Double-Height Elevated Rail" 2
  ${ShowConfirmation} ${sec26} "Elevated Road Networks" 1
  ${ShowConfirmation} ${elroadnet1} "Draggable Elevated Road Networks" 2
  ${ShowConfirmation} ${elroadnet2} "Modular Elevated Road Networks" 2
  ${ShowConfirmation} ${plugin8} "Flexible Underpasses (FLUPs)" 1
  ${ShowConfirmation} ${sec22} "Fractionally Angled Networks (FANs)" 1
  ${ShowConfirmation} ${fan1} "Fractionally Angled Road Networks (FARs)" 2
  ${ShowConfirmation} ${fan2} "Fractionally Angled Railroads (FARRs)" 2
  ${ShowConfirmation} ${fan3} "Draggable FAR" 2
  ${ShowConfirmation} ${sec18} "Ground Light Rail / Tram" 1
  ${ShowConfirmation} ${tram1} "Ground Light Rail" 2
  ${ShowConfirmation} ${tram2} "Tram in Avenue" 2
  ${ShowConfirmation} ${tram3} "Tram in Road" 2
  ${ShowConfirmation} ${tram4} "Tram in Street" 2
  ${ShowConfirmation} ${tram5} "Extended Draggable Ground Light Rail" 2
  ${ShowConfirmation} ${sec30} "High Speed Rail Project (HSRP)" 1
  ${ShowConfirmation} ${sec23} "Maxis Highway Override" 1
  ${ShowConfirmation} ${sec20} "Network Widening Mod (NWM)" 1
  ${ShowConfirmation} ${nwmgroup1} "Network Widening Mod" 2
  ${ShowConfirmation} ${nwm1} "NWM TLA-3" 3
  ${ShowConfirmation} ${nwm2} "NWM AVE-2" 3
  ${ShowConfirmation} ${nwm3} "NWM ARD-3" 3
  ${ShowConfirmation} ${nwm4} "NWM OWR-1" 3
  ${ShowConfirmation} ${nwm5} "NWM OWR-3" 3
  ${ShowConfirmation} ${nwm6} "NWM NRD-4" 3
  ${ShowConfirmation} ${nwm7} "NWM TLA-5" 3
  ${ShowConfirmation} ${nwm8} "NWM OWR-4" 3
  ${ShowConfirmation} ${nwm9} "NWM OWR-5" 3
  ${ShowConfirmation} ${nwm10} "NWM RD-4" 3
  ${ShowConfirmation} ${nwm11} "NWM RD-6" 3
  ${ShowConfirmation} ${nwm12} "NWM Triple-Tile Networks" 3
  ${ShowConfirmation} ${nwmgroup2} "Legacy Transition Piece Wealthification" 2
  ${ShowConfirmation} ${sec28} "Ped Malls" 1
  ${ShowConfirmation} ${sec33} "Rail" 1
  ${ShowConfirmation} ${rail0} "Maxis Rail Options" 2
  ${ShowConfirmation} ${rail1} "RealRailway (RRW)" 2
  ${ShowConfirmation} ${rail2} "Single Track Rail (STR)" 2
  ${ShowConfirmation} ${rail5} "Underground Rail" 2
  ${ShowConfirmation} ${rail6} "Viaduct Rail" 2
  ${ShowConfirmation} ${sec19} "Real Highway Mod (RHW)" 1
  ${ShowRHWConfirmation} 0
  ${ShowRHWConfirmation} 1
  ${ShowRHWConfirmation} 2
  ${ShowRHWConfirmation} 3
  ${ShowRHWConfirmation} 4
  ${ShowConfirmation} ${rhw5} "DDRHW Networks" 2
  ${ShowConfirmation} ${rhw53} "RHW DDRHW-4" 3
  ${ShowConfirmation} ${rhw60} "FARHW" 2
  ${ShowConfirmation} ${rurp1} "Rural Roads Plugin" 1
  ${ShowConfirmation} ${sec21} "Street Addon Mod (SAM)" 1
  ${ShowConfirmation} ${sam1} "SAM Set 1 - Parking Lots" 2
  ${ShowConfirmation} ${sam2} "SAM Set 2 - Herringbone Brick Streets" 2
  ${ShowConfirmation} ${sam3} "SAM Set 3 - PEG Dirt Streets" 2
  ${ShowConfirmation} ${sam4} "SAM Set 4 - PEG Gravel Streets" 2
  ${ShowConfirmation} ${sam5} "SAM Set 5 - Trolca Dirt Streets" 2
  ${ShowConfirmation} ${sam5} "SAM Set 6 - Klinker Streets" 2
  ${ShowConfirmation} ${sam7} "SAM Set 7 - Asphalt Streets" 2
  ${ShowConfirmation} ${sam8} "SAM Set 8 - Cobblestone Streets" 2
  ${ShowConfirmation} ${sam9} "SAM Set 9 - Brick Streets" 2
  ${ShowConfirmation} ${sam10} "SAM Set 10 - Japanese Streets" 2
  ${ShowConfirmation} ${sam11} "SAM Set 11 - IndustrieSAM" 2
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE ""
  !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "The following stations, ports, and network transitions will be installed:"
  ${ShowConfirmation} ${transit1} "Upgraded Maxis Transit Lots" 1
  StrCpy $0 "Airport Capacity:"
  ${ShowConfirmation} ${air1} "$0  Low (Standard Maxis)" 1
  ${ShowConfirmation} ${air2} "$0  Medium (4x Maxis)" 1
  ${ShowConfirmation} ${air3} "$0  High (8x Maxis)" 1
  ${ShowConfirmation} ${transit4} "Bus Rapid Transit Stations" 1
  ${ShowConfirmation} ${brt1} "BriPizza Elevated Roadway Station" 2
  ;${ShowConfirmation} ${brt2} "Modern Arched Bus Rapid Transit Station" 2
  ${ShowConfirmation} ${brt3} "Overhanging Bus Rapid Transit Station" 2
  ${ShowConfirmation} ${brt4} "Bus Rapid Transit Filter Lots" 2
  ${ShowConfirmation} ${brt_filter0} "Bus Rapid Transit Filter for L0 RHW-2" 3
  ${ShowConfirmation} ${brt_filter1} "Bus Rapid Transit Filter for L1 RHW-2" 3
  ${ShowConfirmation} ${brt_filter2} "Bus Rapid Transit Filter for L2 RHW-2" 3
  ${ShowConfirmation} ${transit3} "El Rail Stations" 1
  ${ShowConfirmation} ${eltrain0a} "El Rail Station with Bus and Subway" 2
  ${ShowConfirmation} ${eltrain0} "Victorian El Rail Station (Orthogonal)" 2
  ${ShowConfirmation} ${eltrain1} "Victorian El Rail Station (Diagonal)" 2
  ${ShowConfirmation} ${eltrain2} "Modern El Train Station" 2
  ${ShowConfirmation} ${eltrain2a} "Overhanging El Rail Station" 2
  ${ShowConfirmation} ${eltrain3} "Diagonal El Rail Station" 2
  ${ShowConfirmation} ${eltrain4} "Morifari Straight El Rail Station" 2
  ${ShowConfirmation} ${eltrain5} "Morifari Diagonal El Rail Station" 2
  ${ShowConfirmation} ${eltrain6} "Double-Height Elevated Rail Station" 2
  ${ShowConfirmation} ${eltrain7} "El Rail over Avenue Stations" 2
  ${ShowConfirmation} ${elrailave1} "Morgan-Lake Station" 3
  ${ShowConfirmation} ${eltrain8} "El Rail over Road Stations" 2
  ${ShowConfirmation} ${elrailroad1} "CTA Madison and Wells Station" 3
  ${ShowConfirmation} ${elrailroad2} "CTA Ashland Station" 3
  ${ShowConfirmation} ${elrailroad3} "Overhanging El Rail over Road Station" 3
  ${ShowConfirmation} ${transit5} "GLR and Tram Stations" 1
  ${ShowConfirmation} ${glr} "GLR Stations" 2
  ${ShowConfirmation} ${glr1} "SFBT Dentei GLR Station (Orthogonal)" 3
  ${ShowConfirmation} ${glr2} "SFBT Dentei GLR Station (Diagonal)" 3
  ${ShowConfirmation} ${glr3} "Modern GLR Station" 3
  ${ShowConfirmation} ${tram_stations} "Tram Stations" 2
  ${ShowConfirmation} ${tram_station1} "SFBT Dentei Tram-in-Avenue Station (Orthogonal)" 3
  ${ShowConfirmation} ${tram_station2} "SFBT Dentei Tram-in-Avenue Station (Diagonal)" 3
  ${ShowConfirmation} ${tram_station3} "SFBT Tram-in-Road Station (Single Length)" 3
  ${ShowConfirmation} ${tram_station4} "SFBT Tram-in-Road Station (Double Length)" 3
  ${ShowConfirmation} ${tram_station5} "SFBT Tram-in-Road Station (Triple Length)" 3
  ${ShowConfirmation} ${tram_station6} "SFBT Tram-on-Street Stop" 3
  ${ShowConfirmation} ${transit6} "High Speed Rail Stations" 1
  ${ShowConfirmation} ${hsr1} "Modern Arched HSR Station" 2
  ${ShowConfirmation} ${hsr2} "Modern Arched GHSR Station" 2
  ${ShowConfirmation} ${hsr3} "Diagonal HSR Station" 2
  ${ShowConfirmation} ${hsr4} "Overhanging HSR Station" 2
  ${ShowConfirmation} ${hsr5} "Morifari Straight HSR Station" 2
  ${ShowConfirmation} ${hsr6} "HSRP Transit Hub" 2
  ${ShowConfirmation} ${transit7} "Monorail and Bullet Train Stations" 1
  ${ShowConfirmation} ${monorail0} "Modern Monorail and Bullet Train Station" 2
  ${ShowConfirmation} ${monorail1} "Overhanging Monorail / Bullet Train Station" 2
  ${ShowConfirmation} ${monorail2} "Diagonal Monorail / Bullet Train Station" 2
  ${ShowConfirmation} ${monorail3} "Double-Height Monorail / Bullet Train Station" 2
  ${ShowConfirmation} ${monorail4} "Japanese Bullet Train Station" 2
  ${ShowConfirmation} ${monorail5} "Morifari Straight Monorail / Bullet Train Station" 2
  ${ShowConfirmation} ${monorail6} "Morifari Diagonal Monorail / Bullet Train / HSR Station" 2
  ${ShowConfirmation} ${transit8} "Multi-Purpose Stations" 1
  ${ShowConfirmation} ${multi1} "BriPizza 15m Multi-Purpose Station" 2
  ${ShowConfirmation} ${multi2} "BriPizza 15m Multi-Purpose Station with Parking" 2
  ${ShowConfirmation} ${multi3} "BriPizza Arched Station" 2
  ${ShowConfirmation} ${multi4} "BriPizza 0m-15m Multi-Purpose Station" 2
  ${ShowConfirmation} ${multi5} "BriPizza 15m-30m Multi-Purpose Station" 2
  ${ShowConfirmation} ${multi6} "BriPizza Norikae Station" 2
  ${ShowConfirmation} ${multi7} "Ninja Boulevard Kiosk" 2
  ${ShowConfirmation} ${multi8} "Ninja Boulevard Station" 2
  ${ShowConfirmation} ${transit9} "Network Transitions and Connectors" 1
  ${ShowConfirmation} ${transition0} "SFBT GLR to Subway Transition" 2
  ${ShowConfirmation} ${transition1} "Tram to Subway Transitions" 2
  ${ShowConfirmation} ${transition2} "Subway to Underground Rail Connectors (ESURE)" 2
  ${ShowConfirmation} ${transit10} "Rail Stations" 1
  ${ShowConfirmation} ${rail_station1} "Modern Arched Rail Station" 2
  ${ShowConfirmation} ${rail_station2} "Viaduct Rail Stations" 2
  ${ShowConfirmation} ${viaduct_rail0} "Modern Viaduct Rail Station" 2
  ${ShowConfirmation} ${viaduct_rail1} "Overhanging Viaduct Rail Station" 3
  ${ShowConfirmation} ${viaduct_rail2} "Diagonal Viaduct Rail Station" 3
  ${ShowConfirmation} ${viaduct_rail3} "Victorian Viaduct Rail Station (Orthogonal)" 3
  ${ShowConfirmation} ${viaduct_rail4} "Victorian Viaduct Rail Station (Diagonal)" 3
  ${ShowConfirmation} ${viaduct_rail5} "Morifari Straight Viaduct Rail Station" 3
  ${ShowConfirmation} ${viaduct_rail6} "Morifari Diagonal Viaduct Rail Station" 3
  ${If} ${SectionIsPartiallySelected} ${secgrp4}
    !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE ""
    !insertmacro UMUI_CONFIRMPAGE_TEXTBOX_ADDLINE "The following additional features and customizations will be installed:"
  ${EndIf}
  ${ShowConfirmation} ${plugin1} "Additional Bridges" 1
/*  ${ShowConfirmation} ${bridge1} "Basic Additional Bridges" 2
  ${ShowConfirmation} ${bridge2} "Avenue Bridges" 2
  ${ShowConfirmation} ${avenue_bridge1} "JENX PARIS Pont Alexandre III" 3
  ${ShowConfirmation} ${avenue_bridge2} "Millau Viaduct" 3
  ${ShowConfirmation} ${bridge3} "El Rail Bridges" 2
  ${ShowConfirmation} ${elrail_bridge1} "Concrete Box Girder El Rail Bridge" 3
  ${ShowConfirmation} ${elrail_bridge2} "Steel Bailey Under Truss El Rail Bridge" 3
  ${ShowConfirmation} ${elrail_bridge3} "Cable Stayed El Rail Bridge" 3
  ${ShowConfirmation} ${bridge4} "Elevated Highway Bridges" 2
  ${ShowConfirmation} ${elhighway_bridge1} "Jeronij TsingMa Single Deck Bridge" 3
  ${ShowConfirmation} ${bridge5} "Ground Highway Bridges" 2
  ${ShowConfirmation} ${grndhighway_bridge1} "Akashi Kaikyo Bridge" 3
  ${ShowConfirmation} ${bridge6} "High Speed Rail Bridges" 2
  ${ShowConfirmation} ${hsr_bridge1} "Basic HSR Bridge" 3
  ${ShowConfirmation} ${hsr_bridge2} "Basic GHSR Bridge" 3
  ${ShowConfirmation} ${hsr_bridge3} "Concrete Box-Girder GHSR Bridge" 3
  ${ShowConfirmation} ${hsr_bridge4} "Cable Stayed HSR Bridge" 3
  ${ShowConfirmation} ${hsr_bridge5} "Cable Stayed GHSR Bridge" 3
  ${ShowConfirmation} ${hsr_bridge6} "HSR Concrete Pier Bridge" 3
  ${ShowConfirmation} ${hsr_bridge7} "GHSR Concrete Pier Bridge" 3
  ${ShowConfirmation} ${hsr_bridge8} "HSR Suspension Bridge" 3
  ${ShowConfirmation} ${hsr_bridge9} "Bailey Truss HSR Bridge" 3
  ${ShowConfirmation} ${hsr_bridge10} "Warren Thru-Truss GHSR Bridge" 3
  ${ShowConfirmation} ${hsr_bridge11} "Fences for HSR and GHSR Bridges" 3
  ${ShowConfirmation} ${bridge7} "Monorail Bridges" 2
  ${ShowConfirmation} ${monorail_bridge1} "AIT Concrete Pier Monorail Bridge" 3
  ${ShowConfirmation} ${monorail_bridge2} "Cable-Stayed Monorail Bridge" 3
  ${ShowConfirmation} ${monorail_bridge3} "Monorail Suspension Bridge" 3
  ${ShowConfirmation} ${monorail_bridge4} "Concrete Y-Pier Monorail Bridge" 3
  ${ShowConfirmation} ${bridge15} "Network Widening Mod Bridges" 2
  ${ShowConfirmation} ${nwm_bridge1} "Road-4 Bridge" 3
  ${ShowConfirmation} ${nwm_bridge2} "Road-6 Bridge" 3
  ${ShowConfirmation} ${bridge8} "Railway Bridges" 2
  ${ShowConfirmation} ${rail_bridge1} "Gltzsch Viaduct" 3
  ${ShowConfirmation} ${rail_bridge2} "JRJ Warzone Bridge" 3
  ${ShowConfirmation} ${rail_bridge3} "Garabit Viaduct" 3
  ${ShowConfirmation} ${rail_bridge4} "Howe Truss Rail Bridge (Standard)" 3
  ${ShowConfirmation} ${rail_bridge5} "Howe Truss Rail Bridge (Single Track)" 3
  ${ShowConfirmation} ${rail_bridge6} "Metal Arch Rail Bridge" 3
  ${ShowConfirmation} ${rail_bridge7} "Metal Pylon Bridge" 3
  ${ShowConfirmation} ${rail_bridge8} "Modern Rail Bridge" 3
  ${ShowConfirmation} ${rail_bridge9} "Plate Girder Single Track Rail Bridge" 3
  ${ShowConfirmation} ${rail_bridge10} "Wooden Trestle Single Track Rail Bridge" 3
  ${ShowConfirmation} ${wooden_trestle_rail_bridge1} "Bridge Structure" 4
  ${ShowConfirmation} ${wooden_trestle_rail_bridge2} "Stronger Wake Effect" 4
  ${ShowConfirmation} ${wooden_trestle_rail_bridge3} "Weaker Wake Effect" 4
  ${ShowConfirmation} ${rail_bridge11} "Royal Albert Single Track Rail Bridge" 3
  ${ShowConfirmation} ${rail_bridge12} "PvM JRJ Green Garabit Rail Bridge" 3
  ${ShowConfirmation} ${bridge9} "Real Highway Bridges" 2
  ${ShowConfirmation} ${rhw_bridge1} "RHW-2 Concrete Girder Bridge" 3
  ${ShowConfirmation} ${rhw_bridge2} "RHW-2 Small Steel Arch Bridge" 3
  ${ShowConfirmation} ${rhw_bridge16} "RHW-4 Concrete Arch Bridge" 3
  ${ShowConfirmation} ${rhw_bridge3} "RHW-4 Large Steel Arch Bridge" 3
  ${ShowConfirmation} ${rhw_bridge4} "RHW-4 Steel Girder Bridge" 3
  ${ShowConfirmation} ${rhw_bridge5} "RHW-4 Steel Girder Bridge Dual" 3
  ${ShowConfirmation} ${rhw_bridge5a} "RHW-4 Steel Girder Bridge Dual 2" 3
  ${ShowConfirmation} ${rhw_bridge6} "RHW-4 Suspension Bridge Compact" 3
  ${ShowConfirmation} ${rhw_bridge7} "RHW-6S Cable-Stayed Bridge Compact" 3
  ${ShowConfirmation} ${rhw_bridge8} "RHW-6S Concrete Arch Bridge" 3
  ${ShowConfirmation} ${rhw_bridge9} "RHW-6S Concrete Arch Bridge Dual" 3
  ${ShowConfirmation} ${rhw_bridge10} "RHW-6S Steel Arch Bridge Compact" 3
  ${ShowConfirmation} ${rhw_bridge11} "RHW-8S Undertruss Bridge" 3
  ${ShowConfirmation} ${rhw_bridge12} "RHW-10S Cable Stayed Bridge" 3
  ${ShowConfirmation} ${rhw_bridge13} "RHW-10S Large Concrete Arch" 3
  ${ShowConfirmation} ${rhw_bridge14} "RHW-MIS Bridges" 3
  ${ShowConfirmation} ${rhw_bridge15} "DDRHW-4 Basic Bridge" 3
  ${ShowConfirmation} ${bridge16} "Real Railway Bridges" 2
  ${ShowConfirmation} ${rrw_bridge1} "RRW Single-Track Timber Trestle" 3
  ${ShowConfirmation} ${rrw_bridge2} "RRW Dual-Track Iron Girder" 3
  ${ShowConfirmation} ${rrw_bridge3} "RRW Dual-Track Steel Overtruss" 3
  ${ShowConfirmation} ${rrw_bridge4} "RRW Dual-Track Stone Arch" 3
  ${ShowConfirmation} ${bridge10} "Road Bridges" 2
  ${ShowConfirmation} ${road_bridge1} "Kwanyoni Bridge" 3
  ${ShowConfirmation} ${road_bridge2} "DT Road Bridge" 3
  ${ShowConfirmation} ${road_bridge3} "JENX Tower Bridge" 3
  ${ShowConfirmation} ${road_bridge4} "JENX PARIS Pont Royal" 3
  ${ShowConfirmation} ${road_bridge5} "JENX PARIS Pont Saint Michel" 3
  ${ShowConfirmation} ${road_bridge6} "JENX PARIS Pont Neuf (Road)" 3
  ${ShowConfirmation} ${road_bridge7} "Krummbach Bridge" 3
  ${ShowConfirmation} ${road_bridge8} "Old Road Bridge" 3
  ${ShowConfirmation} ${road_bridge9} "Pont Sant Angelo" 3
  ${ShowConfirmation} ${road_bridge10} "Wooden Covered Road Bridge" 3
  ${ShowConfirmation} ${bridge11} "Rural Street and Rail Bridge" 2
  ${ShowConfirmation} ${bridge12} "Street Addon Mod (SAM) Bridges" 2
  ${ShowConfirmation} ${bridge13} "Street Bridges" 2
  ${ShowConfirmation} ${street_bridge1} "Concrete Street Bridge" 3
  ${ShowConfirmation} ${street_bridge2} "Covered Street Bridge" 3
  ${ShowConfirmation} ${street_bridge3} "JENX PARIS Pont Neuf (Street)" 3
  ${ShowConfirmation} ${street_bridge4} "Steel Girder Street Bridge" 3
  ${ShowConfirmation} ${bridge14} "Tram in Road Bridges" 2
  ${ShowConfirmation} ${TiR_bridge1} "Pont Notre Dame" 3 */
  ${ShowConfirmation} ${bridge_height} "Bridge Height Mod" 1
  ${ShowConfirmation} ${menu1} "Custom Menu Icon Layouts" 1
  ${ShowConfirmation} ${menu1} "Custom Highway Menu" 2
  ${ShowConfirmation} ${menu2} "Custom Rail Menu" 2
  ${ShowConfirmation} ${menu3} "Custom Misc. Transportation Menu" 2
  ${ShowConfirmation} ${sec25} "Enable Decoupling of Networks and Rules" 1
  ${ShowConfirmation} ${sec31} "Extended Station Queries" 1
  ${ShowConfirmation} ${hsr_tex} "High Speed Rail Textures by vershner" 1
  ${ShowConfirmation} ${hole1} "Standard Hole Diggers and Ground Raisers" 2
  ${ShowConfirmation} ${hole2} "Auto-Destruct Hole Diggers and Ground Raisers" 2
  ${ShowConfirmation} ${sec27} "Maxis Highway Interchange & Ramp Additions" 1
  ${ShowConfirmation} ${sec7} "One-Way Arrow Mods" 1
  ${ShowConfirmation} ${arrow1} "Eliminate Most One-Way Arrows" 2
  ${ShowConfirmation} ${arrow2} "Reduce One-Way Arrows by Half" 2
  ${ShowConfirmation} ${arrow3} "Eliminate One-Way Arrows at Roundabouts" 2
  ${ShowConfirmation} ${rail_texture1} "Darker rail textures by SFBT" 1
  ${ShowConfirmation} ${rail_texture2} "Alternative rail textures by dedgren" 1
  ${ShowConfirmation} ${rail_texture3} "Maxis default rail textures" 1
  StrCpy $0 "Rail Viaduct Style:"
  ${ShowConfirmation} ${style1} "$0  Grey Rocks" 1
  ${ShowConfirmation} ${style2} "$0  Brown Bricks" 1
  ${ShowConfirmation} ${style3} "$0  Red Bricks" 1
  ${ShowConfirmation} ${sec34} "Real Highway Options" 1
  ${ShowConfirmation} ${rhw_op1} "Real Highway Mod Regional Transport View" 2
  ${ShowConfirmation} ${rhw_op2} "Single Median Barriers for Compact RHW Networks" 2
  ${ShowConfirmation} ${sec32} "Road Textures and Markings" 1
  ${ShowConfirmation} ${road_texture1} "Maxis Standard Road Textures (American style)" 2
  ${ShowConfirmation} ${road_texture2} "Retextured Standard Road Textures (American style)" 2
  ${ShowConfirmation} ${road_texture3} "Standard Euro Road Textures" 2
  ${ShowConfirmation} ${road_texture4} "Australian Euro Road Textures" 2
  ${ShowConfirmation} ${road_texture5} "Hamburg Euro Road Textures" 2
  ${ShowConfirmation} ${road_texture6} "Euro Road Textures - Single Solid Line" 2
  ${ShowConfirmation} ${road_texture7a} "Options for American Road Textures" 2
  ${ShowConfirmation} ${road_texture_option1b} "New York City-style Large Intersections" 3
  ${ShowConfirmation} ${road_texture7} "Options for Euro Road Textures" 2
  ${ShowConfirmation} ${road_texture_option1} "Alternative Euro TuLEP Textures" 3
  ${ShowConfirmation} ${tulep1} "Dexter's UK Euro TuLEP Textures" 4
  ${ShowConfirmation} ${tulep2} "Mandelsoft's Euro TuLEP Textures" 4
  ${ShowConfirmation} ${tulep3} "Riiga's Euro TuLEP Textures (Dashed)" 4
  ${ShowConfirmation} ${tulep4} "UK Old Euro TuLEP Textures" 4
  ${ShowConfirmation} ${road_texture_option2} "Additional UK Texture Replacements" 3
  ${ShowConfirmation} ${road_texture8} "Alternate Arrow Textures" 2
  ${ShowConfirmation} ${alt_arrow1} "Arrow Textures for Australia" 3
  ${ShowConfirmation} ${alt_arrow2} "Arrow Textures for Belgium" 3
  ${ShowConfirmation} ${alt_arrow3} "Arrow Textures for Schellingen" 3
  ${ShowConfirmation} ${alt_arrow4} "Arrow Textures for Switzerland" 3
  ${ShowConfirmation} ${alt_arrow5} "Arrow Textures for Germany" 3
  ${ShowConfirmation} ${alt_arrow6} "Arrow Textures for Denmark" 3
  ${ShowConfirmation} ${alt_arrow7} "Arrow Textures for France" 3
  ${ShowConfirmation} ${alt_arrow8} "Arrow Textures for Imaginia" 3
  ${ShowConfirmation} ${alt_arrow9} "Arrow Textures for the Netherlands" 3
  ${ShowConfirmation} ${alt_arrow10} "Arrow Textures for Ontario" 3
  ${ShowConfirmation} ${alt_arrow11} "Arrow Textures for Burgtheland" 3
  ${ShowConfirmation} ${alt_arrow12} "Arrow Textures for Sweden" 3
  ${ShowConfirmation} ${alt_arrow13} "Arrow Textures for the United States" 3
  ${ShowConfirmation} ${road_texture9} "Cul-de-Sacs" 2
  ${ShowConfirmation} ${road_texture10} "Asphalt Textures for Maxis Highways" 2
  ${ShowConfirmation} ${sec8} "Roundabouts and Other Interchanges" 1
  ${ShowConfirmation} ${round2} "Street Roundabouts" 2
  ${ShowConfirmation} ${round1} "Road Roundabouts" 2
  ${ShowConfirmation} ${round3} "Oneway Roundabouts" 2
  ${ShowConfirmation} ${round4} "Avenue Roundabouts and Interchanges" 2
  ${ShowConfirmation} ${round5} "Turbo Roundabouts" 2
  ${ShowConfirmation} ${sec9} "Turning Lanes" 1
  ${ShowConfirmation} ${turn2} "Road Turning Lanes" 2
  ${ShowConfirmation} ${turn1} "Avenue Turning Lanes" 2
  ${ShowConfirmation} ${turn4} "FLEX Turn Lanes (FTLs)" 2
  ${ShowConfirmation} ${turn5} "One-Way Road Signalized Intersection and Turn Arrow Plugin (SITAP)" 2
  ${ShowConfirmation} ${turn3} "Turning Lane Extension Plugin (TuLEP) (Old/Deprecated)" 2
  ${ShowConfirmation} ${sec13} "Wide Radius Curves" 1
  ${ShowConfirmation} ${curve1} "Wide Curves for Streets, Roads, and Avenues" 2
  ${ShowConfirmation} ${curve2} "Wide Curves for Rails" 2
  ${ShowConfirmation} ${curve3} "Wide Curves for Monorail and Bullet Train" 2
FunctionEnd

Function RecordNAM
  !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_CUSTOM}
    Call FixComponents
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  WriteRegStr HKCU "Software\Network Addon Mod" "Install Dir" "$INSTDIR"
  ${If} $NewNAM > 0
    WriteRegStr HKCU "Software\Network Addon Mod" "NAM Version" ${PRODUCT_VERSION}
  ${EndIf}
FunctionEnd

; Section descriptions, referred by the labels in the Section line
!insertmacro MUI_FUNCTION_DESCRIPTION_BEGIN
  !insertmacro MUI_DESCRIPTION_TEXT ${air1} "Uses the standard capacity Maxis airports in the game."
  !insertmacro MUI_DESCRIPTION_TEXT ${air2} "Makes the Maxis airports handle four times the commercial and freight capacity of the standard airports, and creates demand for four times the jobs for them."
  !insertmacro MUI_DESCRIPTION_TEXT ${air3} "Makes the Maxis airports handle eight times the commercial and freight capacity of the standard airports, and creates demand for eight times the jobs for them."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow1} "This option replaces the standard arrow textures with ones similar to those used in Australia."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow2} "This option replaces the standard arrow textures with ones similar to those used in Belgium."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow3} "This option replaces the standard arrow textures with ones similar to those used in the fictional country of Schellingen."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow4} "This option replaces the standard arrow textures with ones similar to those used in Switzerland."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow5} "This option replaces the standard arrow textures with ones similar to those used in Germany."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow6} "This option replaces the standard arrow textures with ones similar to those used in Denmark."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow7} "This option replaces the standard arrow textures with ones similar to those used in France."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow8} "This option replaces the standard arrow textures with ones similar to those used in the fictional country of Imaginia."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow9} "This option replaces the standard arrow textures with ones similar to those used in the Netherlands."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow10} "This option replaces the standard arrow textures with ones similar to those used in Ontario, Canada."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow11} "This option replaces the standard arrow textures with ones similar to those used in the fictional country of Burgtheland."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow12} "This option replaces the standard arrow textures with ones similar to those used in Sweden."
  !insertmacro MUI_DESCRIPTION_TEXT ${alt_arrow13} "This option replaces the standard arrow textures with ones similar to those used in the United States."
  !insertmacro MUI_DESCRIPTION_TEXT ${arrow1} "This option will remove most of the One-Way Road arrows."
  !insertmacro MUI_DESCRIPTION_TEXT ${arrow2} "This option will reduce the number of arrows in the OWR networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${arrow3} "This option will remove the arrows from the One-Way Road roundabout."
  !insertmacro MUI_DESCRIPTION_TEXT ${auto0} "This option makes the display of all automata last longer.  It reduces the game speed slightly."
  !insertmacro MUI_DESCRIPTION_TEXT ${auto1} "At a minimum, this option is required as it adds additional functionality."
  !insertmacro MUI_DESCRIPTION_TEXT ${auto2} "This option increases the overall display of automata so that they appear for most of the 24 hour Sim day.  It reduces the game speed slightly."
  !insertmacro MUI_DESCRIPTION_TEXT ${auto3} "This option signifcantly adjusts the overall display of Automata so that they appear more.  It reduces the game speed slightly."
  !insertmacro MUI_DESCRIPTION_TEXT ${auto4} "This option signifcantly adjusts the overall display of Automata so that they appear more for most of the 24 hour Sim day.  It reduces the game speed moderately."
  !insertmacro MUI_DESCRIPTION_TEXT ${avenue_bridge1} "Pont Alexandre III is an arch bridge that spans the Seine, connecting the Champs-lyses quarter and the Invalides and Eiffel Tower quarter; it is widely regarded as the most ornate, extravagant bridge in Paris."
  !insertmacro MUI_DESCRIPTION_TEXT ${avenue_bridge2} "The Millau Viaduct is a large cable-stayed road-bridge that spans the valley of the River Tarn near Millau in southern France. It is the tallest vehicular bridge in the world, with one pier's summit at 343 meters."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge1} "A basic pack of additional bridges for the game."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge2} "Custom bridges for avenues."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge3} "Custom bridges for Elevated Rail."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge4} "Custom bridges for Elevated Highways."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge5} "Custom bridges for Ground Highways."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge6} "This option contains all the bridges for the High Speed Rail network.  That network must be enabled in order to be able to select any of these bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge7} "Custom bridges for Monorail Networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge8} "Custom Railway Bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge9} "This option contains all the bridges for the Real Highway (RHW) network.  That network must be enabled in order to be able to select any of these bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge10} "Custom Road Bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge11} "Here are two versions of an old Roman aqueduct-style bridge. There's one bridge for streets and one for railroads. The models are based on an existing bridge in jeronij's hometown of Soller, Mallorca, Balearic Islands, Spain."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge12} "This option contains all the bridges for the Street Addon Mod network.  That network must be enabled in order to be able to select any of these bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge13} "Custom Street Bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge14} "This option contains all the bridges for the Tram in Road network.  That network must be enabled in order to be able to select any of these bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge15} "This option contains all the bridges for the Network Widening Mod (NWM) networks.  That option must be enabled in order to be able to select any of these bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge16} "This option contains all the bridges for the RealRailway (RRW) networks.  That option must be enabled in order to be able to select any of these bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${bridge_height} "This mod reduces the clearance needed by all Maxis bridges to zero.  As a result, a wider variety of bridges can be built in a wider variety of locations."
  !insertmacro MUI_DESCRIPTION_TEXT ${brt_filter0} "This single-tile lot appear as a single tile of the L0 RHW-2 network.  It allows only buses and pedestrians to pass through it and block all other motorized traffic."
  !insertmacro MUI_DESCRIPTION_TEXT ${brt_filter1} "This single-tile lot appear as a single tile of the L1 RHW-2 network.  It allows only buses to pass through it and block all other traffic."
  !insertmacro MUI_DESCRIPTION_TEXT ${brt_filter2} "This single-tile lot appear as a single tile of the L2 RHW-2 network.  It allows only buses to pass through it and block all other traffic."
  !insertmacro MUI_DESCRIPTION_TEXT ${brt1} "A bus and subway station for elevated toadways, based on a station by E-N (BriPizza).  For elevated roads, one station on one side will serve both directions.  For elevated avenues, a station on each side is needed for full service."
  ;!insertmacro MUI_DESCRIPTION_TEXT ${brt2} "This is a 1x6 modern bus rapid transit station that uses the same model as Xyloxadoria's GHSR station; it is based on the RHW-2 network.  Subway service is optional."
  !insertmacro MUI_DESCRIPTION_TEXT ${brt3} "A modern bus rapid transit station modeled by Xyloxadoria that includes optional subway service.  Be sure to plop the Bus Rapid Transit Other Side lot in the far column."
  !insertmacro MUI_DESCRIPTION_TEXT ${brt4} "These single-tile lots appear as appropriate levels of the RHW-2.  They allow only buses to pass through them and block all other motorized traffic."
  !insertmacro MUI_DESCRIPTION_TEXT ${btm1} "Installs the core files necessary for using the Bullet Train Mod."
  !insertmacro MUI_DESCRIPTION_TEXT ${btm2} "Installs a special ground texture resembling a shadow underneath the Bullet Train Mod tracks."
  !insertmacro MUI_DESCRIPTION_TEXT ${btm3} "Replaces the Primary Concrete Texture with an almost-identical alternate one."
  !insertmacro MUI_DESCRIPTION_TEXT ${btm4} "Adds a fence at ground level all around the route of the Bullet Train Mod."
  !insertmacro MUI_DESCRIPTION_TEXT ${btm5} "Replaces the standard monorail train with a detailed replica of the N700 Series Shinkansen train."
  !insertmacro MUI_DESCRIPTION_TEXT ${can1} "With this option you can build functional canals for SimGoober's canal system."
  !insertmacro MUI_DESCRIPTION_TEXT ${can2} "With this option you can build functional canals for Callagrafx' canal system."
  !insertmacro MUI_DESCRIPTION_TEXT ${capa1} "Uses the standard Maxis capacities; useful for rural areas and towns."
  !insertmacro MUI_DESCRIPTION_TEXT ${capa2} "Increases capacities a little; useful for small to medium-sized cities."
  !insertmacro MUI_DESCRIPTION_TEXT ${capa3} "Increases capacities a bit more; useful for medium to large-sized cities."
  !insertmacro MUI_DESCRIPTION_TEXT ${capa4} "Increases capacities considerably; useful for large cities, or very large cities with little mass transit."
  !insertmacro MUI_DESCRIPTION_TEXT ${capa5} "Increases capacities a lot; useful for very large cities, especially with much regional traffic."
  !insertmacro MUI_DESCRIPTION_TEXT ${capa6} "Retains the traffic simulator that is currently installed."
  !insertmacro MUI_DESCRIPTION_TEXT ${capa7} "Allows you to build a custom traffic simulator at the end of this installation."
  !insertmacro MUI_DESCRIPTION_TEXT ${controller1} "Choose this option only if your traffic drives on the right side of the road in the game."
  !insertmacro MUI_DESCRIPTION_TEXT ${controller2} "Choose this option only if your traffic drives on the left side of the road in the game."
  !insertmacro MUI_DESCRIPTION_TEXT ${curve1} "With this option you can build wide radius and fractionally angled Roads and Streets."
  !insertmacro MUI_DESCRIPTION_TEXT ${curve2} "With this option you can build wide radius and fractionally angled Railway."
  !insertmacro MUI_DESCRIPTION_TEXT ${curve3} "With this option you can build wide curves for the Monorail and Bullet Train."
  !insertmacro MUI_DESCRIPTION_TEXT ${elhighway_bridge1} "The Tsing Ma bridge, found in Hong Kong. Due to actual technical limitations, the included bridge works as an elevated highway bridge and the second deck's railroad is not functional."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail_alt1} "Installs the core files necessary for using Moonlinght's El Rail Alternate Implementation."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail_alt2} "Adds catenary props to the El Rail Alternate Implementation."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail_alt3} "Adds a fence at ground level all around the route of Moonlinght's El Rail Alternate Implementation."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail_alt4} "Installs a special ground texture resembling a shadow underneath the El Rail tracks."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail_alt5} "Replaces the standard Warm Color Concrete Texture with a slightly cooler-colored one."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail_bridge1} "A concrete box girder bridge based off the Edmonton Light Rail Transit system in Canada.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail_bridge2} "A steel bailey under truss bridge.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail_bridge3} "A cable stayed bridge modeled after the Vancouver Skybridge in Canada.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail1} "This is Moononght's implementation of the El Rail network.  Although it is based on a Japanese El Rail network, it has more complex pieces than the standard El Rail, and fits in almost anywhere."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail2} "This option allows you to create El Rail over Road and El Rail over Street networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail2a} "This option allows you to create El Rail over Avenue and El Rail over RD-4 networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrail3} "This option contains puzzle pieces for creating double-height sections of your Elevated Rail networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrailave1} "This is a detailed replica by Droric of the new CTA station at Morgan and Lake on Chicago's Green and Pink lines.  It can be used in an Avenue or RD-4 network.  Bus and optional subway service are included."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrailroad1} "This is a detailed replica by Ardecila of the CTA Beaux-Arts style El Rail over Road station that stood at the intersection of Madison and Wells in Chicago's Loop from 1897 to 1994.  Bus and optional subway service are included."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrailroad2} "This is a detailed replica by Ardecila of the CTA Queen Anne style El Rail over Road station that was built at the intersection of Ashland and Lake in Chicago in 1892.  Bus and optional subway service are included."
  !insertmacro MUI_DESCRIPTION_TEXT ${elrailroad3} "An El Rail over Road station built on Xyloxadoria's Modern Overhanging Station model.  Build your network and optional intersection around the two station end tiles, then plop this station and the El Rail over Road Other Side lot."
  !insertmacro MUI_DESCRIPTION_TEXT ${elroadnet1} "Installs draggable, elevated versions of the Road, one-Way Road, and Avenue networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${elroadnet2} "Installs both overpasses and puzzle pieces for the elevated versions of the Road, one-Way Road, and Avenue networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain0a} "A basic El Rail Station, based on the Maxis El Rail Station, but including bus and optional subway service."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain0} "A Victorian El Rail station by Morifari with a one-tile overhang designed to go over a road.  Bus and optional subway service are included.  Drag the El Rail tool through the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain1} "A diagonal version of the Victorian El Rail station by Morifari, also with a one-tile overhang designed to go over a road.  Bus and optional subway service are included.  Drag the El Rail tool through the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain2} "A modern El Train station by Brenda Xne with bus and subway service, as well as car parking.  It has a translucent roof (made by Swamper77), so you can see the trains go by inside the station."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain2a} "A modern overhanging El Train station by Xyloxadoria.  Bus and optional subway service are included.  Drag the El Rail tool through the station to activate it, then be sure to plop the El Rail Other Side lot in the opposite column."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain3} "A modern diagonal El Train station by Xyloxadoria.  Bus and optional subway service are included.  Drag the El Rail tool through the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain4} "A modern overhanging El Train station by Morifari.  Bus and optional subway service are included.  Drag the El Rail tool through the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain5} "A modern diagonal El Train station by Morifari.  Bus and optional subway service are included.  Drag the El Rail tool through the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain6} "This is a station by Xyloxadoria for double-height Elevated Rail.  Bus and optional subway service are included, as well as parking."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain7} "These stations are for use use with the NAM's El Rail over Avenue and El Rail over RD-4 networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${eltrain8} "These stations are for use use with the NAM's El Rail over Road network."
  !insertmacro MUI_DESCRIPTION_TEXT ${fan1} "This option allows you to create Fractionally Angled Roads, One-Way Roads, and Avenues using puzzle pieces."
  !insertmacro MUI_DESCRIPTION_TEXT ${fan2} "This option allows you to create Fractionally Angled Railroads using puzzle pieces."
  !insertmacro MUI_DESCRIPTION_TEXT ${fan3} "This option allows you to create Fractionally Angled Roads by dragging without having to use puzzle pieces."
  !insertmacro MUI_DESCRIPTION_TEXT ${glr} "This option contains GLR stations; GLR is essentially a ground form of Elevated Rail."
  !insertmacro MUI_DESCRIPTION_TEXT ${glr1} "A basic straight GLR station, two tiles long, with bus service.  Model by NOB, station by Chrisim."
  !insertmacro MUI_DESCRIPTION_TEXT ${glr2} "A basic diagonal GLR station, two tiles long, with bus service.  Model by NOB, station by Chrisim."
  !insertmacro MUI_DESCRIPTION_TEXT ${glr3} "A modern 1x4 GLR Station with integrated bus stop by Brenda Xne."
  !insertmacro MUI_DESCRIPTION_TEXT ${grndhighway_bridge1} "The Akashi-Kaikyo Bridge, also known as Pearl Bridge, is a suspension bridge in Japan that crosses the Akashi Strait. It is the longest suspension bridge in the world to date.  (Bridge by Fukuda.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hole1} "This option provides a standard set of lots that, when demolished, raise or lower the tile below them the specified number of meters.  They may be demolished by drawing a road over them."
  !insertmacro MUI_DESCRIPTION_TEXT ${hole2} "These lots raise or lower the tile beneath them, then immediately auto-destruct.  Unlike the Standard version of these lots, the auto-destruct lots may destroy buildings or networks in the tiles immediately surrounding them."
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge1} "A basic bridge for High Speed Rail.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge2} "A basic bridge for Ground High Speed Rail.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge3} "A concrete box-girder GHSR bridge used along the InterCityExpress lines in Germany.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge4} "A cable stayed HSR bridge, modelled slightly after the Cooper River Bridge in South Carolina.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge5} "A cable stayed GHSR bridge, slightly modeled after the Tsurumi Tsubasa Bridge in Japan.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge6} "A simple HSR concrete pier bridge adapted from pier's used in the Pulaski Skyway in New Jersey.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge7} "A simple GHSR concrete pier bridge adapted from pier's used in the Charilaos Trikoupis bridge in Greece.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge8} "A HSR suspension bridge, slightly modeled after the Kurushima-Kaikyo Bridge in Japan.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge9} "A bailey truss HSR bridge, inspired by various pics around the Net.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge10} "A basic warren thru-truss GHSR bridge, found along the Shinkansen line from Tokyo to Fukuoka, Japan.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_bridge11} "Optional fence props for th HSR and GHSR bridges."
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr1} "A long, 1x6 modern arched High Speed Rail station by Xyloxadoria.  Includes bus and subway service."
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr2} "A long, 1x6 modern arched Ground High Speed Rail station by Xyloxadoria.  Includes bus service."
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr3} "A modern diagonal high speed rail station by Xyloxadoria that includes bus and optional subway service.  Be sure to drag the monorail tool through the station after plopping it; you must start dragging from an HSR tile."
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr4} "A modern overhanging HSR station by Xyloxadoria that includes bus and subway service.  Be sure to plop the HSR Other Side lot in the far column and then drag the monorail tool through the station, starting from an HSR tile."
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr5} "A modern overhanging HSR station by Morifari.  Bus and optional subway service are included.  Starting from an HSR tile, drag the Monorail tool through the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr6} "A large, 6x8 High Speed Rail Project Transit Hub by 3ddz, refurbished by Andreas.  It contains two HSR lines, one rail line with both passenger and freight service, freight service for trucks, bus service, and subway service."
  !insertmacro MUI_DESCRIPTION_TEXT ${hsr_tex} "An alternate darker texture mod for the High Speed Rail networks, designed by vershner."
  !insertmacro MUI_DESCRIPTION_TEXT ${menu1} "This option will group some of the Highway menu buttons."
  !insertmacro MUI_DESCRIPTION_TEXT ${menu2} "This option will reorder some of the Rail menu buttons."
  !insertmacro MUI_DESCRIPTION_TEXT ${menu3} "This option will reorder some of the Misc. Transportation menu buttons."
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail_bridge1} "A simple concrete pier monorail bridge adapted from a picture on the Net.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail_bridge2} "This bridge is modeled after the Rama VIII Bridge in Bangkok, Thailand, a cable-stayed bridge with a span of 2.45 km that crosses the Chao Phraya River.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail_bridge3} "A suspension bridge for the monorail network that should help with any long spans.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail_bridge4} "The Y Pier bridge was inspired by Phoenix Light Rail System.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail0} "A Modern Monorail and Bullet Train Station by Brenda Xne that includes bus and optional subway service."
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail1} "A modern overhanging monorail or bullet train station by Xyloxadoria that includes bus and subway service.  Be sure to plop the Monorail Other Side lot in the far column and then drag the monorail tool through the station."
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail2} "A modern diagonal monorail or bullet train station by Xyloxadoria that includes bus and optional subway service.  Be sure to drag the monorail tool through the station after plopping it."
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail3} "A modern double-height monorail or bullet train station by Xyloxadoria that includes bus and optional subway service, as well as parking.  Plop this 1x4 station in place after building the network around it."
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail4} "A Japanese Shinkansen Bullet Train station by Moonlinght.  Includes bus and optional subway service."
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail5} "A modern overhanging Monorail or Bullet Train station by Morifari.  Bus and optional subway service are included.  Drag the Monorail tool through the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${monorail6} "A modern diagonal Monorail, Bullet Train, or HSR station by Morifari.  Bus and optional subway service are included.  Drag the Monorail tool through the station to activate it.  Start from an HSR tile if you want an HSR station."
  !insertmacro MUI_DESCRIPTION_TEXT ${multi1} "A station offering service for any single-width 15m network, in addition to bus and optional subway service.  Created by E-N (BriPizza)."
  !insertmacro MUI_DESCRIPTION_TEXT ${multi2} "A station offering service for any single-width 15m network, in addition to bus, parking, and optional subway service.  Created by E-N (BriPizza)."
  !insertmacro MUI_DESCRIPTION_TEXT ${multi3} "A station with multiple arches offering service for any single-width 15m network, in addition to bus and optional subway service.  Created by E-N (BriPizza)."
  !insertmacro MUI_DESCRIPTION_TEXT ${multi4} "A station offering any combination of single-width ground level and 15m networks, in addition to bus and optional subway service.  Created by E-N (BriPizza)."
  !insertmacro MUI_DESCRIPTION_TEXT ${multi5} "A station offering any combination of single-width 15m and 30m networks, in addition to bus and optional subway service.  Created by E-N (BriPizza)."
  !insertmacro MUI_DESCRIPTION_TEXT ${multi6} "A more elaborate station offering any combination of single-width ground level and 15m networks, in addition to bus and optional subway service.  Created by E-N (BriPizza)."
  !insertmacro MUI_DESCRIPTION_TEXT ${multi7} "A 1x1 five-function transit building that supports parking, buses, subways, trains and freight trucks, all dependant on what you connect to the building.  Created by RalphaelNinja."
  !insertmacro MUI_DESCRIPTION_TEXT ${multi8} "A 1x5 five-function transit building that supports parking, buses, subways, trains and freight trucks, all dependant on what you connect to the building.  Created by RalphaelNinja."
  !insertmacro MUI_DESCRIPTION_TEXT ${nwmgroup1} "The Network Widening Mod adds new network variations with variable widths to the game for Roads, One-Way Roads, and Avenues, built from starter pieces."
  !insertmacro MUI_DESCRIPTION_TEXT ${nwmgroup2} "Adds grass/sidewalk textures to Transition Puzzle Pieces.  MAY NOT WORK WITH SOME GRAPHICS CARDS."
  !insertmacro MUI_DESCRIPTION_TEXT ${plugin1} "Use this option for installing additional bridges.  The original full documentation for these bridges can be found in the folder 'NAM Auxiliary Files\Documentation\Additional Bridges'."
  !insertmacro MUI_DESCRIPTION_TEXT ${nwm_bridge1} "A basic bridge for Road-4 network, designed by eggman121."
  !insertmacro MUI_DESCRIPTION_TEXT ${nwm_bridge2} "A basic bridge for Road-6 network, designed by eggman121."
  !insertmacro MUI_DESCRIPTION_TEXT ${plugin2} "Use this option for installing Diagonal Streets."
  !insertmacro MUI_DESCRIPTION_TEXT ${plugin5} "Contains different variations and extensions of the El Rail network."
  !insertmacro MUI_DESCRIPTION_TEXT ${plugin6} "Use this option for creating double-height Monorail or Bullet Train (Shinkansen) networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${plugin8} "Use this option for creating Flexible Underpasses."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge1} "The Gltzsch Viaduct is a railway bridge in Germany. It is the largest brick-built bridge in the world containing more than 26 million custom sized bricks.  (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge2} "A concrete railroad bridge modelled and modded by jeronij."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge3} "A modern rail bridge with an appearance similar to the Garabit Viaduct rail bridge in Southern France. The Garabit Viaduct is a railroad arch bridge spanning the Truyre river near Ruynes-en-Margeride."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge4} "This classic wooden truss bridge was inspired by the style of bridge dating back to the 1800s. (Bridge by Threestooges.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge5} "This classic wooden truss bridge was inspired by the style of bridge dating back to the 1800s. (Bridge by Threestooges.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge6} "A common Metal Arch rail bridge,such as can be found throughout the world. (Bridge by Fukuda.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge7} "A Metal Pylon rail bridge, which looks excellent in mountainous areas with deep gorges. (Bridge by Fukuda.) (Not to be confused with the Monty Python rail bridge.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge8} "A modern rail bridge with an appearance similar to Santiago Calatrava's futuristic bridges. (Bridge by jeronij.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge9} "Plate Girders are common, cost effective solutions for spans. Not recommended visually for deep spans, but it will work in any height you attempt to use it. Its a sturdy design that should work well in industrial settings."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge10} "This classic design was derived from the numerous bridges that span smaller gaps and valleys in the early days of US westward expansion. Commonly seen in western movies, this bridge is ideally designed for dry crossings."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge11} "The Royal Albert Bridge is a railway bridge that spans the Rive Tamar in the United Kingdom between Plymouth, on the Devon bank, and Saltash, on the Cornish bank. (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_bridge12} "A rural rail bridge modelled by Paulvmonfort, re-textured with full permission and modded by jeronij."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_station1} "This is a 1x6 modern train station that uses the same model as Xyloxadoria's GHSR station.  Bus service is included, and subway service is optional."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_station2} "These stations all service Viaduct Rail, which is the elevated version of standard heavy rail.  The stations all include bus and optional subway service."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_texture1} "This option contains darker Rail textures for zoom 1 to 4 in order to fix the color shift between Maxis and custom textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_texture2} "This option contains a completely new Rail texture style that looks closer to reality."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail_texture3} "This option keeps the default Maxis Rail textures (not recommended)."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail0} "Includes expansion options for the default Maxis-spec version of the Rail network.  Note that no future additions to functionality are planned for Maxis-spec Rail.  Selecting RealRailway will unselect this section."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail1} "Changes the look of the default heavy rail network to a more realistic look and adds considerable new functionality.  Selecting Maxis-spec Rail will unselect this section."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail2} "Installs Single-Track Railroads for Maxis-spec Rail."
;  !insertmacro MUI_DESCRIPTION_TEXT ${rail3} "Installs Triple-Track Railroads."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail5} "Installs the Underground Rail network, which is an underground version of the standard heavy rail network."
  !insertmacro MUI_DESCRIPTION_TEXT ${rail6} "Installs Viaduct Rail, which is an elevated version of the standard heavy rail network.  This option includes puzzle pieces in Maxis-spec Rail form.  Draggable Rail Viaducts are only available in RealRailway form."
  !insertmacro MUI_DESCRIPTION_TEXT ${rhw_op1} "Installs RHW-compatible Region Transport View.  Not compatible with other Region Transport View Mods.  PLEASE READ DOCUMENTATION."
  !insertmacro MUI_DESCRIPTION_TEXT ${rhw_op2} "Installs single median barriers between the roadways of compact RHW networks (currently RHW-6C and RHW-8C), instead of the old double barriers."
  !insertmacro MUI_DESCRIPTION_TEXT ${rhw_op3} "Installs button to access deprecated RHW height transitions, now made obsolete by the FlexHeight system."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge1} "The Kwanyoni Bridge bridge is modeled after a typical South African bridge. This is a LOW LEVEL bridge, not suitable for heights over 30 metres or so, and it is should be placed to wedge into a canyon. (Bridge by Colyn.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge2} "A modern road bridge, designed after a bridge near Dusktrooper's hometown, Houston, Texas, USA. (Bridge by Dusktrooper.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge3} "Tower Bridge is a combined bascule and suspension bridge in London, England, over the River Thames. It is close to the Tower of London, which gives it its name. (Bridge by xannepan.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge4} "The Pont Royal is a bridge crossing the river Seine in Paris. It is the third oldest bridge in Paris, after the Pont Neuf and the Pont Marie. (Bridge by xannepan.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge5} "Pont Saint-Michel is a bridge linking the Place Saint-Michel on the left bank of the river Seine to the le de la Cit. It was named after the nearby chapel of Saint-Michel. (Bridge by xannepan.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge6} "The Pont Neuf (bridge nine) is, despite its name, the oldest standing bridge across the river Seine in Paris, France. Its name was given to distinguish it from older bridges that were lined on both sides with houses. (Bridge by xannepan.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge7} "The Krummbach bridge is found in Wallis, Switzerland. It carries the Simplon pass road. The bridge was built in 1978 and has a total lenght of 621 meters, with the main arch being 124 meters long. (Bridge by jeronij.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge8} "An 18th Century style road bridge, specifically designed for old european urban centers. (Bridge by jeronij.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge9} "Ponte Sant'Angelo, once the Aelian Bridge or Pons Aelius, meaning the Bridge of Hadrian, is a Roman bridge in Rome, Italy, completed in 134 AD by Roman Emperor Hadrian, to span the Tiber.  (Bridge by debussyman.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_bridge10} "This is a covered bridge, as is common in the New England states in the north-eastern part of the USA. The roof is intended to protect the wooden bridge from moisture, in order to extend its lifetime. (Bridge by Threestooges.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture_option1} "The following options let you select different textures for TuLEPs (Turning Lane Extension Project)."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture_option1b} "Uses New York City-style crosshatching for large intersections.  This affects the NWM networks OWR-3, OWR-4, OWR-5, NRD-4, RD-6, AVE-6, and TLA-7, as well as certain TuLEPs."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture_option2} "Additional UK texture replacements"
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture_style1} "This option allows you to choose one of the main American-style or European-style road textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture1} "This option selects the standard, unmodified Maxis road textures that come with the game."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture2} "This option replaces most of the default Maxis intersection textures with smooth corners, along with correct geometry for orthogonal to diagonal draggable curve, improvements to many road networks, and much more."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture3} "This is the Euro version of the Retextured Standard Road Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture4} "This is the Euro version of the Retextured Standard Road Textures, with special NWM customization for Australian roads."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture5} "This is the Euro version of the Retextured Standard Road Textures, with special NWM customization for Hamburg-style roads."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture6} "This is the Euro version of the Retextured Standard Road Textures, with a single solid line used as a divider for the NWM networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture7a} "The following options are available for any of the four main American textures mods."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture7} "The following options are available for any of the four main European textures mods."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture8} "This option provides a number of alternate arrow styles wherever arrows are used."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture9} "Inserts cul-de-sacs at the ends of roads.  For American-style textures, inserts cul-de-sacs at the ends of streets as well."
  !insertmacro MUI_DESCRIPTION_TEXT ${road_texture10} "This option replaces all the white concrete textures of the Maxis highways with a black asphalt texture.  This plugin is not compatible with the Maxis Highway Override."
  !insertmacro MUI_DESCRIPTION_TEXT ${round1} "With this option you can create Road roundabouts."
  !insertmacro MUI_DESCRIPTION_TEXT ${round2} "With this option you can create Street roundabouts."
  !insertmacro MUI_DESCRIPTION_TEXT ${round3} "With this option you can create One-Way Road roundabouts."
  !insertmacro MUI_DESCRIPTION_TEXT ${round4} "With this option you can create Avenue roundabouts, interchanges and wide curves."
  !insertmacro MUI_DESCRIPTION_TEXT ${round5} "With this option you can create Turbo roundabouts.  These are special multi-lane roundabouts that are especially helpful in facilitating traffic flow."
  !insertmacro MUI_DESCRIPTION_TEXT ${rrw_bridge1} "A timber trestle bridge for Single-Track Rail, designed to RealRailway (RRW) specifications by eggman121."
  !insertmacro MUI_DESCRIPTION_TEXT ${rrw_bridge2} "An iron girder bridge for Dual-Track Rail, designed to RealRailway (RRW) specifications by eggman121."
  !insertmacro MUI_DESCRIPTION_TEXT ${rrw_bridge3} "A steel overtruss bridge for Dual-Track Rail, designed to RealRailway (RRW) specifications by eggman121."
  !insertmacro MUI_DESCRIPTION_TEXT ${rrw_bridge4} "A stone arch bridge for Dual-Track Rail, designed to RealRailway (RRW) specifications by eggman121."
  !insertmacro MUI_DESCRIPTION_TEXT ${rurp1} "This installs a series of cosmetic puzzle pieces designed to make roads look more rural."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam1} "This installs the SAM Parking Lot Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam2} "This installs the Herringbone Brick Street Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam3} "This installs the PEG Dirt Street Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam4} "This installs the PEG Gravel Street Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam5} "This installs the Trolca Dirt Street Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam6} "This installs the Klinker Euro Street Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam7} "This installs the Asphalt Street Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam8} "This installs the Cobblestone Street Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam9} "This installs the Brick Street Textures."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam10} "This installs the Japanese Street Textures, created by Moonlinght."
  !insertmacro MUI_DESCRIPTION_TEXT ${sam11} "This installs the IndustrieSAM Street Textures, created by mgb204."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec1} "The Network Addon Mod will introduce numerous network and traffic enhancements to the game."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec2} "This will install the documentation for the Network Addon Mod."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec3} "The traffic driving side is usually set automatically, but can be changed here if necessary."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec4} "Run the Cleanitol program, which removes all plugins incompatible with the NAM from your system.  This is automatically done at a NAM upgrade, and usually doesn't have to be done otherwise."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec5} "Choose options for reorderning menu icons."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec6} "Choose options for Elevated (Heavy) Rail Viaduct styles."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec7} "Various options for removing or reducing One-Way Road arrows."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec8} "Choose options for creating Roundabouts."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec9} "Choose options for creating Avenue or Road Turning Lanes."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec10} "Choose one of the Automata Controllers here. Custom Automata Controllers can be created with external tools, such as Ilive's Reader."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec11} "Choose one of the Traffic Simulators here. Custom Traffic Simulators can be created with the Traffic Simulator Configuration Tool, which is optionally installed at the end of the main NAM installation."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec13} "Choose this option for building Wide Radius Curves for road and/or rail networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec14} "Choose options for Rail Texture styles. Fixes the color shift between the Maxis textures and custom Rail textures.  This option is not used when the RealRailway (RRW) is installed."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec15} "Allows you to choose either the SimGoober or Callagrafx version of the Canal Addon Mod."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec16} "Choose this option to add all networks and props to the standard Zones Data View.  The exact composition of this view can be refined by using the Traffic Simulator Configuration Tool."
;  !insertmacro MUI_DESCRIPTION_TEXT ${sec17} "Installs the Traffic Simulator Configuration Tool that can be used for creating a custom Traffic Simulator."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec18} "Choose options for Ground Light Rail / Tram functionality."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec19} "Includes the full Real Highway Mod, which is a completely different alternative to the standard Maxis highways, with almost innumerable types of customizations available.  It does not replace the Maxis highways."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec20} "Choose options for Network Widening Mod functionality.  The Network Widening Mod contains roads, one-way roads, and avenues with more lanes, and/or center turning lanes for avenues, as well as other options."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec21} "Choose options for Street Addon Mod functionality."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec22} "Enable Fractionally Angled Networks.  Currently, two angles are supported:  18.43 and 26.57, along with their complements, 71.57 and 63.43.  The basic repeating patterns require 2x3 tiles and 2x2 tiles, respectively."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec23} "Overrides the standard Maxis Highway with a highway more compatible with the RHW. The standard Maxis Highway interchanges are replaced and fractionally-angled Maxis Highway (FAMHW) support is added."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec24} "Installs the Bullet Train Mod by Moonlight.  This mod completely replaces the standard monorail, and has many additional features.  It is based on the Japanese Shinkansen high-speed rail line."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec25} "Allows you to select networks and rules independently for those networks that have rules associated with them.  One click on a network selects both the network and its rules; a second click selects only the network, boldfacing it."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec26} "Contains both the Draggable and Modular versions of the  Elevated Road Networks, which consist of elevated versions of the Road, One-Way Road, and Avenue networks.  These two options are totally independent."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec27} "Additional interchanges and ramps for the Maxis Highways.  Not compatible with the Maxis Highway Override."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec28} "Installs ped malls, which are tiles of various textures that permit pedestrian traffic in all directions, but no other type of traffic."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec29} "These lots allow the current tile to be raised or lowered by the specified amount.  They are typically used every other tile for the distance needed."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec30} "The High Speed Rail Project adds a new Monorail-based network extension to the game, with the look and feel of a High Speed Rail Project line.  It does not replace the current Monorail or Bullet Train network."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec31} "Includes additional information in the station queries, including number of tiles of this station type in the city, the average usage of this type of station, the total number of tiles in this station's network, and their utilization."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec32} "The options here allow you to customize various road textures and markings."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec33} "Includes new types of rail networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec34} "Additional options for the RHW."
  !insertmacro MUI_DESCRIPTION_TEXT ${sec36} "Adds bus and/or subway service to the original stations when appropriate.  See the main documentation for further details."
  !insertmacro MUI_DESCRIPTION_TEXT ${secgrp1} "Includes options for the NAM Traffic Simulator, the Automata Controller, and the new Zones Data View."
  !insertmacro MUI_DESCRIPTION_TEXT ${secgrp2} "Contains all the new NAM networks, as well as extensions to the existing Maxis networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${secgrp3} "Upgrades the standard Maxis transit lots, and includes many more stations and network transitions that are useful with the NAM."
  !insertmacro MUI_DESCRIPTION_TEXT ${secgrp4} "Contains various features and customizations that do not fit into any of the previous categories."
  !insertmacro MUI_DESCRIPTION_TEXT ${street_bridge1} "A concrete box girder bridge, modelled slightly after the Smartroad Bridge over Wilson's Creek. It is the tallest bridge in Virginia at 175 feet (53 m) tall. (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${street_bridge2} "A street version of the Maxis covered road bridge. (Bridge by choco.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${street_bridge3} "The Pont Neuf (bridge nine) is, despite its name, the oldest standing bridge across the river Seine in Paris, France. Its name was given to distinguish it from older bridges that were lined on both sides with houses. (Bridge by xannepan.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${street_bridge4} "A simple steel girder street bridge commonly found crossing small creeks and rivers around Western Pennsylvania. It utilizes a cost effective steel beam/concrete deck design well suited for small crossings in hilly terrains."
  !insertmacro MUI_DESCRIPTION_TEXT ${style1} "This option will change the Rail Viaduct texture to a grey rock color."
  !insertmacro MUI_DESCRIPTION_TEXT ${style2} "This option will change the Rail Viaduct texture to a brown brick color."
  !insertmacro MUI_DESCRIPTION_TEXT ${style3} "This option will change the Rail Viaduct texture to a red brick color."
  !insertmacro MUI_DESCRIPTION_TEXT ${TiR_bridge1} "The Pont Notre-Dame is a bridge that crosses the Seine in Paris, France linking the quai de Gesvres on the Rive Droite with the quai de la Corse on the le de la Cit. (Bridge by xannepan.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${tram_stations} "Tram stations are for tram lines, which go down the middle of streets, roads, and avenues."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram_station1} "A basic straight tram station, going down the space between avenue lanes. It is two tiles long, and includes bus service.  Model by NOB, station by Chrisim."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram_station2} "A basic diagonal tram station, going down the space between avenue lanes. It is two tiles long, and includes bus service.  Model by NOB, station by Chrisim."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram_station3} "A basic straight tram station, going down the space between two road lanes. It is one tile long, and includes bus service.  Station by Chrisim."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram_station4} "A basic straight tram station, going down the space between two road lanes. It is two tiles long, and includes bus service.  Station by Chrisim."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram_station5} "A basic straight tram station, going down the space between two road lanes. It is three tiles long, and includes bus service.  Station by Chrisim."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram_station6} "A basic straight tram station, going down the middle of a street. It is one tile long, and includes bus service.  Station by Chrisim."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram1} "Use this option for creating Ground Light Rail networks.  These are differentiated from the Tram networks in that Ground Light Rail does not travel in or on streets, roads, or avenues."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram2} "Use this option for creating Tram in Avenue networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram3} "Use this option for creating Tram in Road and Tram on Road networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram4} "Use this option for creating Tram in Street networks."
  !insertmacro MUI_DESCRIPTION_TEXT ${tram5} "Use this option to enable two additional Tram styles with customizable base textures (requires rebuilding pillars on Elevated Rail)."
  !insertmacro MUI_DESCRIPTION_TEXT ${transition0} "This transition permits surface Ground Light Rail to enter a tunnel to connect up with a subway network."
  !insertmacro MUI_DESCRIPTION_TEXT ${transition1} "These transitions convert Tram in Avenue and Tram in Road to standard Avenue and Road, with the tram going underground and joining a subway and/or Underground Rail line."
  !insertmacro MUI_DESCRIPTION_TEXT ${transition2} "These transitions convert Underground Rail to Subway and vice versa; they come in a number of lots with different road and ped mall transit options on top.  These lots are most useful for extending the Underground Rail network."
  !insertmacro MUI_DESCRIPTION_TEXT ${transit1} "Upgrades the capacities and transit switch entry costs (TSECs) of the standard Maxis transit lots to conform with the NAM standard."
  !insertmacro MUI_DESCRIPTION_TEXT ${transit2} "Set the commercial and freight capacity of the Maxis airports, along with the demand for jobs for them.  Switching among these options affects airports that are already placed in the game.  (Airports are operated by Nocturnal Aviation.)"
  !insertmacro MUI_DESCRIPTION_TEXT ${transit3} "This option contains the El Rail stations that are available for the various El Rail networks, including the basic Maxis El Rail Network."
  !insertmacro MUI_DESCRIPTION_TEXT ${transit5} "This option contains stations for Ground Light Rail, both in its standalone form and as trams, which go down the middle of roadways."
  !insertmacro MUI_DESCRIPTION_TEXT ${transit6} "High Speed Rail stations are designed for the High Speed Rail network, which is a monorail-based network that can coexist with either monorail or the Bullet Train Mod."
  !insertmacro MUI_DESCRIPTION_TEXT ${transit7} "These stations serve monorail lines, or the Bullet Train (Shinkansen) lines if that mod is installed."
  !insertmacro MUI_DESCRIPTION_TEXT ${transit8} "These stations serve multiple major transportation types, in addition to including bus and optional subway service."
  !insertmacro MUI_DESCRIPTION_TEXT ${transit9} "These are transit lots that are not stations, but instead permit Sims to transfer smoothly from one network to another."
  !insertmacro MUI_DESCRIPTION_TEXT ${transit10} "These lots contain various rail stations, including stations for Viaduct Rail."
  !insertmacro MUI_DESCRIPTION_TEXT ${tulep1} "This option allows you to select Dexter's UK Euro TuLEP (Turning Lane Extension Project) style."
  !insertmacro MUI_DESCRIPTION_TEXT ${tulep2} "This option allows you to select Mandelsoft's Euro TuLEP (Turning Lane Extension Project) style."
  !insertmacro MUI_DESCRIPTION_TEXT ${tulep3} "This option allows you to select Riiga's Euro TuLEP (Turning Lane Extension Project) style."
  !insertmacro MUI_DESCRIPTION_TEXT ${tulep4} "This option allows you to select the UK Old Euro TuLEP (Turning Lane Extension Project) style."
  !insertmacro MUI_DESCRIPTION_TEXT ${turn1} "With this option, Avenue intersections will have turning lanes."
  !insertmacro MUI_DESCRIPTION_TEXT ${turn2} "With this option, Road intersections can have turning lanes.  To activate these turning lanes, plop a single one-way road tile on top of the intersection (they no longer automatically appear)."
  !insertmacro MUI_DESCRIPTION_TEXT ${turn3} "With this option, you can build puzzle piece-based turn lane setups.  Please note that this feature is deprecated, and will not receive any future updates or improvements."
  !insertmacro MUI_DESCRIPTION_TEXT ${turn4} "With this option, you can build a variety of FLEX/draggable turn lane setups."
  !insertmacro MUI_DESCRIPTION_TEXT ${turn5} "With this option, you can build signalized intersections with turn arrows for the One-Way Road.  To activate these signals, transition to Road one-tile before reaching the intersection, and overclick with One-Way Road if intersecting two One-Way Roads.  See documentation for more detail."
  !insertmacro MUI_DESCRIPTION_TEXT ${viaduct_rail0} "A modern Viaduct Rail station by Brenda Xne with bus and subway service, as well as car parking.  It has a translucent roof (made by Swamper77).  Drag the Rail tool through the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${viaduct_rail1} "A modern overhanging Viaduct Rail station by Xyloxadoria that includes bus and subway service.  Be sure to plop the Viaduct Rail Other Side lot in the far column and then click on both columns with the rail tool."
  !insertmacro MUI_DESCRIPTION_TEXT ${viaduct_rail2} "A modern diagonal Viaduct Rail station by Xyloxadoria that includes bus and optional subway service.  Be sure to click the central rail pieces in the station with the rail tool after plopping the station."
  !insertmacro MUI_DESCRIPTION_TEXT ${viaduct_rail3} "Victorian Viaduct Rail station by Morifari and ArkenbergeJoe, with a one-tile overhang designed to go over a road.  Bus and optional subway service are included.  Click on the two center lot pieces of the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${viaduct_rail4} "A diagonal version of the Victorian Viaduct Rail station by Morifari and ArkenbergeJoe.  Bus and optional subway service are included.  Click on the two center lot pieces of the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${viaduct_rail5} "A modern overhanging Viaduct Rail station by Morifari.  Bus and optional subway service are included.  Drag the Monorail tool through the station to activate it."
  !insertmacro MUI_DESCRIPTION_TEXT ${viaduct_rail6} "A modern diagonal Viaduct Rail station by Morifari.  Bus and optional subway service are included.  Drag the Rail tool through the station to activate  it."
  !insertmacro MUI_DESCRIPTION_TEXT ${wooden_trestle_rail_bridge1} "This is the main bridge structure.  This option must be checked if you want to use this bridge."
  !insertmacro MUI_DESCRIPTION_TEXT ${wooden_trestle_rail_bridge2} "Creates a wake effect around all pillars of the bridge."
  !insertmacro MUI_DESCRIPTION_TEXT ${wooden_trestle_rail_bridge3} "Creates a lesser wake effect around the pillars of the bridge."
!insertmacro MUI_FUNCTION_DESCRIPTION_END

Function AbortNAM
  ${DirState} $INSTDIR $0
  ${IfThen} $0 = 0 ${|} RMDir $INSTDIR ${|}
  ${DirState} $z___NAM $0
  ${IfThen} $0 = 0 ${|} RMDir $z___NAM ${|}
  ${DirState} $NAMAuxDir $0
  ${IfThen} $0 = 0 ${|} RMDir $NAMAuxDir ${|}
FunctionEnd

; Uninstaller message.
Function un.onInit
!insertmacro MUI_UNGETLANGUAGE
  MessageBox MB_ICONQUESTION|MB_YESNO|MB_DEFBUTTON2 "Would you like to uninstall $(^Name) and all of its components?" IDYES +2
  Abort
FunctionEnd

Function un.onUninstSuccess
  HideWindow
  MessageBox MB_ICONINFORMATION|MB_OK "$(^Name) was successfully uninstalled."
FunctionEnd

Section Uninstall
  RMDir /r $INSTDIR
  RMDir /r "$DOCUMENTS\SimCity 4\Plugins\z___NAM"
  RMDir /r "$DOCUMENTS\SimCity 4\NAM Auxiliary Files"
  SetShellVarContext all
  RMDir /r "$SMPROGRAMS\Network Addon Mod"
  DeleteRegKey ${PRODUCT_UNINST_ROOT_KEY} "${PRODUCT_UNINST_KEY}"
  DeleteRegKey HKCU "Software\Network Addon Mod"
  SetAutoClose true
SectionEnd

Function .onInit
; remove semicolon below to activate language selection box
;  !insertmacro MUI_LANGDLL_DISPLAY

  StrCpy $AdminAbort 0
  StrCpy $AlreadyInstalled 0
  StrCpy $ButtonGroup1 ${capa3}
  StrCpy $ButtonGroup2 ${auto1}
  StrCpy $ButtonGroup3 ${style1}
  StrCpy $ButtonGroup4 ${rail_texture1}
  StrCpy $ButtonGroup5 ${controller1}
  StrCpy $ButtonGroup6 ${can1}
  StrCpy $ButtonGroup7 ${air2}
  StrCpy $ButtonGroup8 ${road_texture2}
  StrCpy $ButtonGroup9 0
  StrCpy $ButtonGroup10 0
  StrCpy $ButtonGroup11 0
  StrCpy $ButtonGroup12 0
  StrCpy $ButtonGroup13 0
  StrCpy $CalledNWMCore 0
  StrCpy $CalledRHWCore 0
  StrCpy $CalledSAMCore 0
  StrCpy $Cleanitol 0
  StrCpy $ConfElevatedRoad 0
  StrCpy $ConfElRail 0
  StrCpy $ConfElRailOverRoad 0
  StrCpy $ConfGLR 0
  StrCpy $ConfMonorail 0
  StrCpy $ConfMultiPurpose 0
  StrCpy $ConfRail 0
  StrCpy $ConfStationOverride 0
  StrCpy $ConfTramInAvenue 0
  StrCpy $ConfTramInRoad 0
  StrCpy $ConfTramInStreet 0
  StrCpy $ConfTransitions 0
  StrCpy $DirectoryWarning ""
  StrCpy $ElRailAlt 0
  StrCpy $Eseries 0
  StrCpy $InstalledBTM 0
  StrCpy $InstalledDoubleHeightElRail 0
  StrCpy $InstalledDoubleHeightMonorail 0
  StrCpy $InstalledElevatedRoad 0
  StrCpy $InstalledElRailOverAvenue 0
  StrCpy $InstalledElRailOverRoad 0
  StrCpy $InstalledGLR 0
  StrCpy $InstalledGoltzschViaduct 0
  StrCpy $InstalledHSR 0
  StrCpy $InstalledNWM 0
  StrCpy $InstalledRHW 0
  StrCpy $InstalledRoyalAlbert 0
  StrCpy $InstalledRRW 0
  StrCpy $InstalledSAM 0
  StrCpy $InstalledSAMBridges 0
  StrCpy $InstalledSTR 0
  StrCpy $InstalledTramInAvenue 0
  StrCpy $InstalledTramInRoad 0
  StrCpy $InstalledTramInStreet 0
  StrCpy $InstalledViaductRail 0
  StrCpy $LanguageKnown 0
  StrCpy $LanguageReminder 0
  StrCpy $NAMAuxDir "$DOCUMENTS\SimCity 4\NAM Auxiliary Files"
  StrCpy $NewNAM 0
  StrCpy $OSLang 0
  StrCpy $PersistentAutomata 0
  StrCpy $SC4Docs $DOCUMENTS
  StrCpy $SC4InstallDir ""
  StrCpy $SelectCount 0
  StrCpy $Sseries 1
  StrCpy $OldInstallDir ""
  StrCpy $MonolithicNAM 0
  StrCpy $LastLoadDir 0
  StrCpy $Wine 0
  Strcpy $z___NAM "$DOCUMENTS\SimCity 4\Plugins\z___NAM"

  ClearErrors
  ReadRegDWORD $SC4Lang HKLM "Software\Maxis\SimCity 4\1.0" Language
  IfErrors +1 Known
    StrCpy $OSLang 1
    ${If} $Language = 2057   ;UK English
    ${OrIf} $Language = 3081 ;Australian English
    ${OrIf} $Language = 1041 ;Japanese
      goto Left
    ${ElseIf} $Language > 1000
      goto Known
    ${EndIf}
    StrCpy $LanguageReminder 1
    StrCpy $OSLang 0
    return
Known:
  StrCpy $bRight 1
  ${If} $SC4Lang = 19   ;UK English
  ${OrIf} $SC4Lang = 14 ;Japanese
Left:
    StrCpy $bRight 0
  ${EndIf}
  StrCpy $LanguageKnown 1

  ${If} $bRight = 1
    StrCpy $ButtonGroup5 ${controller1}
  ${Else}
    StrCpy $ButtonGroup5 ${controller2}
  ${EndIf}
  ClearErrors
  ReadRegStr $0 HKCU "Software\Network Addon Mod" "Install Dir"
  IfErrors Ini1
  StrCpy $INSTDIR $0
  ${DirState} $0 $1
  ${If} $1 = 1
    StrCpy $MonolithicNAM 1
    StrCpy $ButtonGroup1 ${capa6}
  ${EndIf}
  ReadRegStr $NAMOldVersion HKCU "Software\Network Addon Mod" "NAM Version"
  ${If} $NAMOldVersion == ""
Ini1:
    StrCpy $NAMOldVersion 1
  ${EndIf}
  Math::Script "r0 = ( ${PRODUCT_VERSION} - $NAMOldVersion ) * 10)"
  ${IfThen} $0 > 0 ${|} StrCpy $NewNAM 1 ${|}
  ClearErrors
  EnumRegKey $0 HKCU "Software\Wine" 0
  IfErrors +2 0
    StrCpy $Wine 1
	UserInfo::GetName
	IfErrors Ini2
  Pop $0
  ${If} $0 == "Administrator"
    MessageBox MB_YESNO|MB_ICONEXCLAMATION|MB_DEFBUTTON2 "WARNING!  You are running the NAM installer while logged in as the Administrator.  Running the installer as Administrator will cause the NAM to be installed in the Adminstrator's Plugins folder, and should be done only if you plan to play SimCity 4 while logged in as Adminstrator.  Do you want to continue this installation under the Administrator account?" IDYES +2
    Quit
  ${EndIf}
Ini2:
;  !insertmacro SetSectionFlag ${secgrp2} ${SF_RO}
;  !insertmacro SetSectionFlag ${road_texture_option1a} ${SF_RO}
FunctionEnd

!macro SetOption Option
  ${If} ${Option} <> 0
    !insertmacro SelectSection ${Option}
    !insertmacro ClearSectionFlag ${Option} ${SF_RO}
  ${EndIf}
!macroend

!macro ClearOption Option
  ${If} ${Option} <> 0
    !insertmacro UnselectSection ${Option}
    !insertmacro SetSectionFlag ${Option} ${SF_RO}
  ${EndIf}
!macroend

!macro _FlipOptions Network Installed Option1 Option2 Option3 Option4 Option5 Option6 Option7 Option8 Option9 Option10 MoreOptions
  Push $0
  Push $1
  StrCpy $1 0
  ${If} ${SectionIsSelected} ${sec25}
  ${AndIf} ${network} = ${sec19}
    SectionGetText ${sec19} $0
    StrCpy $0 $0 6
    ${If} $0 == "*NR*  "
      StrCpy $1 1
    ${EndIf}
  ${EndIf}
  ${If} ${SectionIsSelected} ${Network}
  ${OrIf} ${SectionIsPartiallySelected} ${Network}
  ${OrIf} $1 = 1
    ${If} ${Installed} = 0
      ${If} ${MoreOptions} = 0
        Strcpy ${Installed} 1
      ${EndIf}
      !insertmacro SetOption ${Option1}
      !insertmacro SetOption ${Option2}
      !insertmacro SetOption ${Option3}
      !insertmacro SetOption ${Option4}
      !insertmacro SetOption ${Option5}
      !insertmacro SetOption ${Option6}
      !insertmacro SetOption ${Option7}
      !insertmacro SetOption ${Option8}
      !insertmacro SetOption ${Option9}
      !insertmacro SetOption ${Option10}
    ${EndIf}
  ${ElseIfNot} ${SectionIsSelected} ${Network}
  ${AndIfNot} ${SectionIsPartiallySelected} ${Network}
  ${AndIf} ${Installed} = 1
    ${If} ${MoreOptions} = 0
      Strcpy ${Installed} 0
    ${EndIf}
    !insertmacro ClearOption ${Option1}
    !insertmacro ClearOption ${Option2}
    !insertmacro ClearOption ${Option3}
    !insertmacro ClearOption ${Option4}
    !insertmacro ClearOption ${Option5}
    !insertmacro ClearOption ${Option6}
    !insertmacro ClearOption ${Option7}
    !insertmacro ClearOption ${Option8}
    !insertmacro ClearOption ${Option9}
    !insertmacro ClearOption ${Option10}
  ${EndIf}
  Pop $1
  Pop $0
!macroend

!define FlipOptions `!insertmacro _FlipOptions`

!macro SetBridge Option
  ${If} ${Option} <> 0
    !insertmacro SelectSection ${Option}
    !insertmacro SetSectionFlag ${Option} ${SF_RO}
  ${EndIf}
!macroend

!macro ClearBridge Option
  ${If} ${Option} <> 0
    !insertmacro ClearSectionFlag ${Option} ${SF_RO}
  ${EndIf}
!macroend

!macro _SyncBridges Network Installed Option1 Option2 Option3 Option4 Option5 Option6 Option7 Option8 Option9 Option10 MoreOptions
  ${If} ${SectionIsSelected} ${Network}
  ${OrIf} ${SectionIsPartiallySelected} ${Network}
    ${If} ${Installed} = 0
      ${If} ${MoreOptions} = 0
        Strcpy ${Installed} 1
      ${EndIf}
      !insertmacro SetBridge ${Option1}
      !insertmacro SetBridge ${Option2}
      !insertmacro SetBridge ${Option3}
      !insertmacro SetBridge ${Option4}
      !insertmacro SetBridge ${Option5}
      !insertmacro SetBridge ${Option6}
      !insertmacro SetBridge ${Option7}
      !insertmacro SetBridge ${Option8}
      !insertmacro SetBridge ${Option9}
      !insertmacro SetBridge ${Option10}
    ${EndIf}
  ${ElseIfNot} ${SectionIsSelected} ${Network}
  ${AndIfNot} ${SectionIsPartiallySelected} ${Network}
  ${AndIf} ${Installed} = 1
    ${If} ${MoreOptions} = 0
      Strcpy ${Installed} 0
    ${EndIf}
    !insertmacro ClearBridge ${Option1}
    !insertmacro ClearBridge ${Option2}
    !insertmacro ClearBridge ${Option3}
    !insertmacro ClearBridge ${Option4}
    !insertmacro ClearBridge ${Option5}
    !insertmacro ClearBridge ${Option6}
    !insertmacro ClearBridge ${Option7}
    !insertmacro ClearBridge ${Option8}
    !insertmacro ClearBridge ${Option9}
    !insertmacro ClearBridge ${Option10}
  ${EndIf}
!macroend

!define SyncBridges `!insertmacro _SyncBridges`

Function .onSelChange

	Push $2
  StrCpy $KeepOldSimulator 0
  StrCpy $CustomizeSimulator 0
	StrCpy $2 ${SF_SELECTED}
	SectionGetFlags ${capa1} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${capa2} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${capa3} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${capa4} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${capa5} $0
	IntOp $2 $2 & $0
	SectionGetFlags ${capa6} $0
	IntOp $2 $2 & $0
	SectionGetFlags ${capa7} $0
	IntOp $2 $2 & $0
	StrCmp $2 0 skip1
	
		SectionSetFlags ${capa1} 0
		SectionSetFlags ${capa2} 0
		SectionSetFlags ${capa3} 0
		SectionSetFlags ${capa4} 0
		SectionSetFlags ${capa5} 0
		SectionSetFlags ${capa6} 0
		SectionSetFlags ${capa7} 0

	skip1:
	Pop $2

  !insertmacro StartRadioButtons $ButtonGroup1
    !insertmacro RadioButton ${capa1}
    !insertmacro RadioButton ${capa2}
    !insertmacro RadioButton ${capa3}
    !insertmacro RadioButton ${capa4}
    !insertmacro RadioButton ${capa5}
    !insertmacro RadioButton ${capa6}
    !insertmacro RadioButton ${capa7}
  !insertmacro EndRadioButtons
  
	SectionGetFlags ${capa6} $0
  	IntOp $KeepOldSimulator $0 & ${SF_SELECTED}
	SectionGetFlags ${capa7} $0
  	IntOp $CustomizeSimulator $0 & ${SF_SELECTED}

	StrCpy $2 ${SF_SELECTED}
	SectionGetFlags ${auto1} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${auto2} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${auto3} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${auto4} $0
	IntOp $2 $2 & $0
	StrCmp $2 0 skip2
	
		SectionSetFlags ${auto1} 0
		SectionSetFlags ${auto2} 0
		SectionSetFlags ${auto3} 0
		SectionSetFlags ${auto4} 0
                              
	skip2:

  !insertmacro StartRadioButtons $ButtonGroup2
    !insertmacro RadioButton ${auto1}
    !insertmacro RadioButton ${auto2}
    !insertmacro RadioButton ${auto3}
    !insertmacro RadioButton ${auto4}
  !insertmacro EndRadioButtons

  !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
    Push $2
    StrCpy $2 ${SF_SELECTED}
    SectionGetFlags ${style1} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${style2} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${style3} $0
    IntOp $2 $2 & $0
    StrCmp $2 0 skip3

      SectionSetFlags ${style1} 0
      SectionSetFlags ${style2} 0
      SectionSetFlags ${style3} 0

    skip3:
    Pop $2

    !insertmacro StartRadioButtons $ButtonGroup3
      !insertmacro RadioButton ${style1}
      !insertmacro RadioButton ${style2}
      !insertmacro RadioButton ${style3}
    !insertmacro EndRadioButtons
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  
  !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
    Push $2
    StrCpy $2 ${SF_SELECTED}
    SectionGetFlags ${rail_texture1} $0
    IntOp $2 $2 & $0
          SectionGetFlags ${rail_texture2} $0
    IntOp $2 $2 & $0
          SectionGetFlags ${rail_texture3} $0
    IntOp $2 $2 & $0
    StrCmp $2 0 skip4

      SectionSetFlags ${rail_texture1} 0
      SectionSetFlags ${rail_texture2} 0
      SectionSetFlags ${rail_texture3} 0

    skip4:
    Pop $2

    !insertmacro StartRadioButtons $ButtonGroup4
      !insertmacro RadioButton ${rail_texture1}
      !insertmacro RadioButton ${rail_texture2}
      !insertmacro RadioButton ${rail_texture3}
    !insertmacro EndRadioButtons
  !insertmacro UMUI_ENDIF_INSTALLFLAG

	Push $2
	StrCpy $2 ${SF_SELECTED}
	SectionGetFlags ${controller1} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${controller2} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${controller3} $0
	IntOp $2 $2 & $0
 	StrCmp $2 0 skip5

		SectionSetFlags ${controller1} 0
		SectionSetFlags ${controller2} 0
		SectionSetFlags ${controller3} 0

	skip5:
	Pop $2

  !insertmacro StartRadioButtons $ButtonGroup5
    !insertmacro RadioButton ${controller1}
    !insertmacro RadioButton ${controller2}
    !insertmacro RadioButton ${controller3}
  !insertmacro EndRadioButtons

  ${If} ${SectionIsSelected} ${can1}
  ${OrIf} ${SectionIsSelected} ${can2}
    !insertmacro StartRadioButtons $ButtonGroup6
      !insertmacro RadioButton ${can1}
      !insertmacro RadioButton ${can2}
    !insertmacro EndRadioButtons
  ${EndIf}

	Push $2
	StrCpy $2 ${SF_SELECTED}
	SectionGetFlags ${air1} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${air2} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${air3} $0
	IntOp $2 $2 & $0
 	StrCmp $2 0 skip7

		SectionSetFlags ${air1} 0
		SectionSetFlags ${air2} 0
    SectionSetFlags ${air3} 0

	skip7:
	Pop $2

  !insertmacro StartRadioButtons $ButtonGroup7
    !insertmacro RadioButton ${air1}
    !insertmacro RadioButton ${air2}
    !insertmacro RadioButton ${air3}
  !insertmacro EndRadioButtons
	
	Push $2
	StrCpy $2 ${SF_SELECTED}
	SectionGetFlags ${road_texture1} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${road_texture2} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${road_texture3} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${road_texture4} $0
	IntOp $2 $2 & $0
  SectionGetFlags ${road_texture5} $0
	IntOp $2 $2 & $0
	SectionGetFlags ${road_texture6} $0
	IntOp $2 $2 & $0
	StrCmp $2 0 skip8
	
		SectionSetFlags ${road_texture1} 0
		SectionSetFlags ${road_texture2} 0
		SectionSetFlags ${road_texture3} 0
		SectionSetFlags ${road_texture4} 0
		SectionSetFlags ${road_texture5} 0
		SectionSetFlags ${road_texture6} 0

	skip8:
	Pop $2

  !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
    !insertmacro StartRadioButtons $ButtonGroup8
      !insertmacro RadioButton ${road_texture1}
      !insertmacro RadioButton ${road_texture2}
      !insertmacro RadioButton ${road_texture3}
      !insertmacro RadioButton ${road_texture4}
      !insertmacro RadioButton ${road_texture5}
      !insertmacro RadioButton ${road_texture6}
    !insertmacro EndRadioButtons
    
    ${If} ${SectionIsSelected} ${tulep1}
    ${OrIf} ${SectionIsSelected} ${tulep2}
    ${OrIf} ${SectionIsSelected} ${tulep3}
    ${OrIf} ${SectionIsSelected} ${tulep4}
      Push $2
      StrCpy $2 ${SF_SELECTED}
      SectionGetFlags ${tulep1} $0
      IntOp $2 $2 & $0
      SectionGetFlags ${tulep2} $0
      IntOp $2 $2 & $0
      SectionGetFlags ${tulep3} $0
      IntOp $2 $2 & $0
      SectionGetFlags ${tulep4} $0
      IntOp $2 $2 & $0
      StrCmp $2 0 skip9

        SectionSetFlags ${tulep1} 0
        SectionSetFlags ${tulep2} 0
        SectionSetFlags ${tulep3} 0
        SectionSetFlags ${tulep4} 0

  skip9:
  !insertmacro UMUI_ENDIF_INSTALLFLAG

    !insertmacro StartRadioButtons $ButtonGroup9
      !insertmacro RadioButton ${tulep1}
      !insertmacro RadioButton ${tulep2}
      !insertmacro RadioButton ${tulep3}
      !insertmacro RadioButton ${tulep4}
    !insertmacro EndRadioButtons
	${EndIf}
  
  ${If} ${SectionIsSelected} ${alt_arrow1}
  ${OrIf} ${SectionIsSelected} ${alt_arrow2}
  ${OrIf} ${SectionIsSelected} ${alt_arrow3}
  ${OrIf} ${SectionIsSelected} ${alt_arrow4}
  ${OrIf} ${SectionIsSelected} ${alt_arrow5}
  ${OrIf} ${SectionIsSelected} ${alt_arrow6}
  ${OrIf} ${SectionIsSelected} ${alt_arrow7}
  ${OrIf} ${SectionIsSelected} ${alt_arrow8}
  ${OrIf} ${SectionIsSelected} ${alt_arrow9}
  ${OrIf} ${SectionIsSelected} ${alt_arrow10}
  ${OrIf} ${SectionIsSelected} ${alt_arrow11}
  ${OrIf} ${SectionIsSelected} ${alt_arrow12}
  ${OrIf} ${SectionIsSelected} ${alt_arrow13}
    Push $2
    StrCpy $2 ${SF_SELECTED}
    SectionGetFlags ${alt_arrow1} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow2} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow3} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow4} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow5} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow6} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow7} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow8} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow9} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow10} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow11} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow12} $0
    IntOp $2 $2 & $0
    SectionGetFlags ${alt_arrow13} $0
    IntOp $2 $2 & $0
    StrCmp $2 0 skip10

      SectionSetFlags ${alt_arrow1} 0
      SectionSetFlags ${alt_arrow2} 0
      SectionSetFlags ${alt_arrow3} 0
      SectionSetFlags ${alt_arrow4} 0
      SectionSetFlags ${alt_arrow5} 0
      SectionSetFlags ${alt_arrow6} 0
      SectionSetFlags ${alt_arrow7} 0
      SectionSetFlags ${alt_arrow8} 0
      SectionSetFlags ${alt_arrow9} 0
      SectionSetFlags ${alt_arrow10} 0
      SectionSetFlags ${alt_arrow11} 0
      SectionSetFlags ${alt_arrow12} 0
      SectionSetFlags ${alt_arrow13} 0

    skip10:
    Pop $2

    !insertmacro StartRadioButtons $ButtonGroup10
      !insertmacro RadioButton ${alt_arrow1}
      !insertmacro RadioButton ${alt_arrow2}
      !insertmacro RadioButton ${alt_arrow3}
      !insertmacro RadioButton ${alt_arrow4}
      !insertmacro RadioButton ${alt_arrow5}
      !insertmacro RadioButton ${alt_arrow6}
      !insertmacro RadioButton ${alt_arrow7}
      !insertmacro RadioButton ${alt_arrow8}
      !insertmacro RadioButton ${alt_arrow9}
      !insertmacro RadioButton ${alt_arrow10}
      !insertmacro RadioButton ${alt_arrow11}
      !insertmacro RadioButton ${alt_arrow12}
      !insertmacro RadioButton ${alt_arrow13}
    !insertmacro EndRadioButtons
  ${EndIf}
  ${If} $ElRailAlt = 0
    ${If} ${SectionIsPartiallySelected} ${elrail1}
      Call EnableElRailAltOptions
      !insertmacro SelectSection ${elrail1}
    ${EndIf}
  ${ElseIf} ${SectionIsPartiallySelected} ${elrail1}
  ${AndIfNot} ${SectionIsSelected} ${elrail_alt1}
    StrCpy $ElRailAlt 0
    !insertmacro UnselectSection ${elrail_alt2}
    !insertmacro UnselectSection ${elrail_alt3}
    !insertmacro UnselectSection ${elrail_alt4}
    !insertmacro UnselectSection ${elrail_alt5}
    !insertmacro SetSectionFlag ${elrail_alt2} ${SF_RO}
    !insertmacro SetSectionFlag ${elrail_alt3} ${SF_RO}
    !insertmacro SetSectionFlag ${elrail_alt4} ${SF_RO}
    !insertmacro SetSectionFlag ${elrail_alt5} ${SF_RO}
  ${EndIf}
  ${If} ${SectionIsSelected} ${road_texture1}
  ${OrIf} ${SectionIsSelected} ${road_texture2}
    !insertmacro UnselectSection ${road_texture7}
  ${Else}
    !insertmacro UnselectSection ${road_texture7a}
  ${EndIf}

  ${If} ${SectionIsSelected} ${rail1}
  ${OrIf} ${SectionIsPartiallySelected} ${rail1}
    StrCpy $InstalledRRW 1
    StrCpy $InstalledRailTexture $ButtonGroup4
    !insertmacro UnselectSection ${rail2}
    !insertmacro UnselectSection ${sec14}
  ${ElseIf} $InstalledRRW = 1
    StrCpy $InstalledRRW 1
    StrCpy $ButtonGroup4 $InstalledRailTexture
  ${EndIf}
  
    ${If} ${SectionIsSelected} ${rail1}
    ${OrIf} ${SectionIsSelected} ${rail0}
    ${OrIf} ${SectionIsSelected} ${tulep3}
    ${OrIf} ${SectionIsSelected} ${tulep4}
      Push $2
      StrCpy $2 ${SF_SELECTED}
      SectionGetFlags ${rail1} $0
      IntOp $2 $2 & $0
      SectionGetFlags ${rail0} $0
      IntOp $2 $2 & $0
      StrCmp $2 0 skip11

        SectionSetFlags ${rail1} 0
        SectionSetFlags ${rail0} 0

  skip11:
  Pop $2

  ;${If} ${SectionIsSelected} ${rail0}
  ;${OrIf} ${SectionIsSelected} ${rail1}
    !insertmacro StartRadioButtons $ButtonGroup11
      !insertmacro RadioButton ${rail0}
      !insertmacro RadioButton ${rail1}
    !insertmacro EndRadioButtons
  ${EndIf}
  
  ${FlipOptions} ${btm1} $InstalledBTM ${monorail4} 0 0 0 0 0 0 0 0 0 0
  ${FlipOptions} ${plugin6} $InstalledDoubleHeightMonorail ${monorail3} 0 0 0 0 0 0 0 0 0 0
  ${FlipOptions} ${elrail3} $InstalledDoubleHeightElRail ${eltrain6} 0 0 0 0 0 0 0 0 0 0
  ${FlipOptions} ${elrail2a} $InstalledElRailOverAvenue ${eltrain7} ${elrailave1} 0 0 0 0 0 0 0 0 0
  ${FlipOptions} ${elrail2} $InstalledElRailOverRoad  ${eltrain8} ${elrailroad1} ${elrailroad2} ${elrailroad3} 0 0 0 0 0 0 0
  ${FlipOptions} ${sec26} $InstalledElevatedRoad ${transit4} ${brt1} 0 0 0 0 0 0 0 0 0
  ${FlipOptions} ${tram1} $InstalledGLR ${transit5} ${glr1} ${glr2} ${glr3} ${transition0} 0 0 0 0 0 0
  ${FlipOptions} ${tram2} $InstalledTramInAvenue ${tram_station1} ${tram_station2} 0 0 0 0 0 0 0 0 0
  ${FlipOptions} ${tram3} $InstalledTramInRoad  ${bridge14} ${TiR_bridge1} ${tram_station4} 0 0 0 0 0 0 0 0
  ${FlipOptions} ${tram4} $InstalledTramInStreet  ${tram_station6} 0 0 0 0 0 0 0 0 0 0
  ${FlipOptions} ${sec30} $InstalledHSR ${bridge6} ${hsr_bridge1} ${hsr_bridge2} ${hsr_bridge3} ${hsr_bridge4} ${hsr_bridge5} ${hsr_bridge6} ${hsr_bridge7} ${hsr_bridge8} ${hsr_bridge9} 1
  ${FlipOptions} ${sec30} $InstalledHSR ${hsr_bridge10} ${hsr_bridge11} ${transit6} ${hsr1} ${hsr2} ${hsr3} ${hsr4} ${hsr5} ${hsr6} 0 0
  ${FlipOptions} ${sec20} $InstalledNWM ${bridge15} ${nwm_bridge1} ${nwm_bridge2} 0 0 0 0 0 0 0 0
  ${FlipOptions} ${sec19} $InstalledRHW ${bridge9} ${rhw_bridge1} ${rhw_bridge2} ${rhw_bridge16} ${rhw_bridge3} ${rhw_bridge4} ${rhw_bridge5} ${rhw_bridge5a} ${rhw_bridge6} ${rhw_bridge7} 1
  ${FlipOptions} ${sec19} $InstalledRHW ${rhw_bridge8} ${rhw_bridge8} ${rhw_bridge9} ${rhw_bridge10} ${rhw_bridge11} ${rhw_bridge12} ${rhw_bridge13} ${rhw_bridge14} ${rhw_bridge15} ${brt3} 1
  ${FlipOptions} ${sec19} $InstalledRHW ${brt4} ${brt_filter0} ${brt_filter1} ${brt_filter2} 0 0 0 0 0 0 0
  ${FlipOptions} ${rail1} $InstalledRRW ${bridge16} ${rrw_bridge1} ${rrw_bridge2} ${rrw_bridge3} ${rrw_bridge4} ${rail_bridge5} ${rail_bridge9} ${rail_bridge10} ${rail_bridge11} ${wooden_trestle_rail_bridge1} 1
  ${FlipOptions} ${rail1} $InstalledRRW ${wooden_trestle_rail_bridge2} ${wooden_trestle_rail_bridge3} ${rail_station2} ${viaduct_rail0} ${viaduct_rail1} ${viaduct_rail2} ${viaduct_rail3} ${viaduct_rail4} ${viaduct_rail5} ${viaduct_rail6} 0
  ${FlipOptions} ${sec21} $InstalledSAM ${bridge12} 0 0 0 0 0 0 0 0 0 0
  StrCpy $0 $InstalledSTR
  ${FlipOptions} ${rail2} $InstalledSTR ${rail_bridge5} ${rail_bridge9} ${rail_bridge10} ${rail_bridge11} ${wooden_trestle_rail_bridge1} ${wooden_trestle_rail_bridge2} ${wooden_trestle_rail_bridge3} 0 0 0 0
  ${FlipOptions} ${rail6} $InstalledViaductRail ${rail_station2} ${viaduct_rail0} ${viaduct_rail1} ${viaduct_rail2} ${viaduct_rail3} ${viaduct_rail4} ${viaduct_rail5} ${viaduct_rail6} 0 0 0
  
  ${SyncBridges} ${rail_bridge1} $InstalledGoltzschViaduct ${rail_bridge3} ${rail_bridge12} ${rail_bridge6} 0 0 0 0 0 0 0 0
  ${SyncBridges} ${bridge12} $InstalledSAMBridges ${bridge11} ${street_bridge1} ${street_bridge2} ${street_bridge4} 0 0 0 0 0 0 0
  ${SyncBridges} ${rail_bridge11} $InstalledRoyalAlbert ${rail_bridge1} ${rail_bridge3} ${rail_bridge6} ${rail_bridge12} 0 0 0 0 0 0 0
  ${If} $InstalledRoyalAlbert = 0
    StrCpy $InstalledGoltzschViaduct 0
    ${SyncBridges} ${rail_bridge1} $InstalledGoltzschViaduct ${rail_bridge3} ${rail_bridge12} ${rail_bridge6} 0 0 0 0 0 0 0 0
  ${EndIf}

  ${If} ${SectionIsSelected} ${wooden_trestle_rail_bridge2}
  ${OrIf} ${SectionIsSelected} ${wooden_trestle_rail_bridge3}
    ${If} $InstalledSTR = $0
      !insertmacro StartRadioButtons $ButtonGroup12
        !insertmacro RadioButton ${wooden_trestle_rail_bridge2}
        !insertmacro RadioButton ${wooden_trestle_rail_bridge3}
      !insertmacro EndRadioButtons
    ${Else}
      !insertmacro UnselectSection ${wooden_trestle_rail_bridge2}
      !insertmacro UnselectSection ${wooden_trestle_rail_bridge3}
      StrCpy $ButtonGroup12 0
    ${EndIf}
  ${EndIf}
  ${IfNot} ${SectionIsSelected} ${wooden_trestle_rail_bridge1}
    ${If} ${SectionIsSelected} ${wooden_trestle_rail_bridge2}
      !insertmacro UnselectSection ${wooden_trestle_rail_bridge2}
    ${EndIf}
    ${If} ${SectionIsSelected} ${wooden_trestle_rail_bridge3}
      !insertmacro UnselectSection ${wooden_trestle_rail_bridge3}
    ${EndIf}
  ${ElseIf} ${SectionIsSelected} ${wooden_trestle_rail_bridge2}
  ${AndIf} ${SectionIsSelected} ${wooden_trestle_rail_bridge3}    ;It could happen!  :(
    !insertmacro UnselectSection ${wooden_trestle_rail_bridge2}
    !insertmacro UnselectSection ${wooden_trestle_rail_bridge3}
    StrCpy $ButtonGroup12 0
  ${EndIf}
  ${If} ${SectionIsSelected} ${sec25}
    StrCpy $R7 0
    Call CheckRNetworkStates
  ${EndIf}
FunctionEnd

Function EnableElRailAltOptions
  StrCpy $ElRailAlt 1
  !insertmacro ClearSectionFlag ${elrail_alt2} ${SF_RO}
  !insertmacro ClearSectionFlag ${elrail_alt3} ${SF_RO}
  !insertmacro ClearSectionFlag ${elrail_alt4} ${SF_RO}
  !insertmacro ClearSectionFlag ${elrail_alt5} ${SF_RO}
FunctionEnd

Function DisableElRailAltOptions
  !insertmacro SetSectionFlag ${elrail_alt2} ${SF_RO}
  !insertmacro SetSectionFlag ${elrail_alt3} ${SF_RO}
  !insertmacro SetSectionFlag ${elrail_alt4} ${SF_RO}
  !insertmacro SetSectionFlag ${elrail_alt5} ${SF_RO}
FunctionEnd

Function DeleteDuplicates
  /*
   * First we have the list of Transit Lots.
   * Please keep these in alphabetical order.
   */
  nsArray::SetList NAM_Options "ADC_AshlandStation_f4708abd.SC4Lot" ${elrailroad2} /end
  nsArray::SetList NAM_Options "ADC_MadisonWellsStation.SC4Lot" ${elrailroad1} /end
  nsArray::SetList NAM_Options "BriPizza Arched Station.dat" ${multi3} /end
  nsArray::SetList NAM_Options "BriPizza Elevated Road Stop.dat" ${brt1} /end
  nsArray::SetList NAM_Options "BriPizza Norikae Station.dat" ${multi6} /end
  nsArray::SetList NAM_Options "BriPizza 0m-15m Multi-Purpose Station.dat" ${multi4} /end
  nsArray::SetList NAM_Options "BriPizza 15m-30m Multi-Purpose Station.dat" ${multi5} /end
  nsArray::SetList NAM_Options "Diagonal El-Rail Station_77abc775.SC4Lot" ${eltrain3} /end
  nsArray::SetList NAM_Options "Diagonal HSR Station.SC4Lot" ${hsr3} /end
  nsArray::SetList NAM_Options "Diagonal Monorail BTM Station_77abd579.SC4Lot" ${monorail2} /end
  nsArray::SetList NAM_Options "Diagonal_and_Straight_El-Rail_Station.dat" ${eltrain4} /end
  nsArray::SetList NAM_Options "Double Height Light Rail Station.SC4Lot" ${viaduct_rail2} /end
  nsArray::SetList NAM_Options "Double Height Monorial or BTM Station.SC4Lot" ${monorail3} /end
  nsArray::SetList NAM_Options "elevated-rail-plus-subway-and-bus.dat" ${eltrain0a} /end
  nsArray::SetList NAM_Options "El Rail Station with Bus and Subway.SC4Lot" ${eltrain2a} /end
  nsArray::SetList NAM_Options "ELRailStation_774e7d35.SC4Lot" ${eltrain2a} /end
  nsArray::SetList NAM_Options "EN_NorikaeSta_210220_v1.dat" ${multi6} /end
  nsArray::SetList NAM_Options "EN_285StaJuJi0015_v1.dat" ${multi4} /end
  nsArray::SetList NAM_Options "EN_285Sta_Juji1530_v1.dat" ${multi5} /end
  nsArray::SetList NAM_Options "EN_2905Kouka-Station_v1.dat" ${multi3} /end
  nsArray::SetList NAM_Options "GHSR Station_b5e98121.SC4Lot" ${hsr2} /end
  nsArray::SetList NAM_Options "GLR diagonal Dentei station_b597d62a.SC4Lot" ${glr2} /end
  nsArray::SetList NAM_Options "GLR orthogonal Dentei station_b597d5b9.SC4Lot" ${glr1} /end
  nsArray::SetList NAM_Options "HSR Station_b5e9804e.SC4Lot" ${hsr1} /end
  nsArray::SetList NAM_Options "HSRP Transit Hub_f13fb783.SC4Lot" ${hsr6} /end
  nsArray::SetList NAM_Options "MEBSP_Station_149b6c88.SC4Lot" ${eltrain2} /end
  nsArray::SetList NAM_Options "ML 4x1 Shinkansen Station_98dce3a3.SC4Lot" ${monorail4} /end
  nsArray::SetList NAM_Options "Modern Arched Rail Station.SC4Lot" ${rail_station1} /end
  nsArray::SetList NAM_Options "MonorailStation_774e7d84.SC4Lot" ${monorail1} /end
  nsArray::SetList NAM_Options "Morifari Diagonal El Rail Station.SC4Lot" ${eltrain5} /end
  nsArray::SetList NAM_Options "Morifari Straight El Rail Station.SC4Lot" ${eltrain4} /end
  nsArray::SetList NAM_Options "Morifari Diagonal Monorail Station.SC4Lot" ${monorail6} /end
  nsArray::SetList NAM_Options "Morifari Straight Monorail Station.SC4Lot" ${monorail5} /end
  nsArray::SetList NAM_Options "morifari_Viaduct_Rail_Station_diagonal.SC4Lot" ${viaduct_rail4} /end
  nsArray::SetList NAM_Options "morifari_Viaduct_Rail_Station_orthogonal.SC4Lot" ${viaduct_rail3} /end
  nsArray::SetList NAM_Options "NDEX_Brenda_Xne_MGLRBS_Station_11a105f9.SC4Lot" ${glr3} /end
  nsArray::SetList NAM_Options "NinjaBoulevardKiosk_ad9819d0.SC4Lot" ${multi7} /end
  nsArray::SetList NAM_Options "NinjaBoulevardStation_ad9444e6.SC4Lot" ${multi8} /end
  nsArray::SetList NAM_Options "RTMT_Tram_in_Avenue_to_Underground.SC4Lot" ${transition1} /end
  nsArray::SetList NAM_Options "SFBT_Subway-Tram_Transition.SC4Lot" ${transition2} /end
  nsArray::SetList NAM_Options "SFBT_TramStreet_Stop.dat" ${tram_station6} /end
  nsArray::SetList NAM_Options "Subway_to_Underground_Rail_Connector.dat" ${transition2} /end
  nsArray::SetList NAM_Options "TramAve 2x2 orthogonal Dentei station_9545f6eb.SC4Lot" ${tram_station1} /end
  nsArray::SetList NAM_Options "TramAve 2x3 diagonal Dentei station_1541eca0.SC4Lot" ${tram_station2} /end
  nsArray::SetList NAM_Options "TramRoad1x1stop_d67e1351.SC4Lot" ${tram_station3} /end
  nsArray::SetList NAM_Options "TramRoad1x2stop_d67e1686.SC4Lot" ${tram_station4} /end
  nsArray::SetList NAM_Options "TramRoad1x3stop_d67e18c7.SC4Lot" ${tram_station5} /end
  nsArray::SetList NAM_Options "Utils3x1_ENnamRailSta---Overhead_V2_13d2bd58.SC4Lot" ${multi2} /end
  nsArray::SetList NAM_Options "Utils3x1_NEnamLRStaV1_33d321b7.SC4Lot" ${multi1} /end
  nsArray::SetList NAM_Options "Victorian El Rail Station Diagonal.dat" ${eltrain1} /end
  nsArray::SetList NAM_Options "Victorian El Rail Station Orthogonal.dat" ${eltrain0} /end
  nsArray::SetList NAM_Options "Xne_MMSBP_Station.SC4Lot" ${monorail0} /end
  nsArray::Set NAM_Options "StationEnd"
  /*
   * And now for the textures...
   */
  nsArray::SetList NAM_Options "NAM_Retexture_and_Cosmetic_Mod_Avenue.dat" ${road_texture2} /end
  nsArray::SetList NAM_Options "NAM_Retexture_and_Cosmetic_Mod_Avenue_to_RoadStreet_VideoSea..." ${road_texture2} /end
  nsArray::SetList NAM_Options "NAM_Retexture_and_Cosmetic_Mod_OWR2.dat" ${road_texture2} /end
  nsArray::SetList NAM_Options "NAM_Retexture_and_Cosmetic_Mod_Road.dat" ${road_texture2} /end
  nsArray::SetList NAM_Options "RHW_v50_EuroTextureReplacementMod_Main.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_AUS.dat" ${alt_arrow1} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_BE.dat" ${alt_arrow2} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_BRS.dat" ${alt_arrow3} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_CH.dat" ${alt_arrow4} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_DE.dat" ${alt_arrow5} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_DK.dat" ${alt_arrow6} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_FR.dat" ${alt_arrow7} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_IM.dat" ${alt_arrow8} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_NL.dat" ${alt_arrow9} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_Ontario.dat" ${alt_arrow10} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_RBU.dat" ${alt_arrow11} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_SE.dat" ${alt_arrow12} /end
  nsArray::SetList NAM_Options "Shared_ArrowTextures_USA.dat" ${alt_arrow13} /end
  nsArray::SetList NAM_Options "z_NetworkAddonMod_TurningLanes_Extension_Plugin_EuroTRM_DexterUK.dat" ${tulep1} /end
  nsArray::SetList NAM_Options "z_NetworkAddonMod_TurningLanes_Extension_Plugin_EuroTRM_MRTNRLN.dat" ${tulep2} /end
  nsArray::SetList NAM_Options "Z_RHW_v50_EuroTextureReplacementMod_AlternativeSet_BRS.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "Z_RHW_v50_EuroTextureReplacementMod_AlternativeSet_DV_RHD.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z0_RHW_v50_EuroTextures_DV" ${road_texture3} /end
  nsArray::SetList NAM_Options "z0_RHW_v50_EuroTextures_LHDSupport" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_MHW_Override_Euro_Textures_Standard" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_CP_Autobahn" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_CP_UK" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_DV_NoMips" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_DV_RHW-2" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_DV_RHW-3" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_FLEXFly" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_LotTexturesl" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_MIS" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_NoMips" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_RHW-2" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_RHW-3" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_RHW-4" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_RHW-6C" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_RHW-6S" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_RHW-8C" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_RHW-8S" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_RHW-10S" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ireland_Special" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_NoMips" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Norway" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_RHW-2" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_RHW-3" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_RHW-4" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_RHW-6C" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_RHW-6S" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_RHW-8C" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_RHW-8S" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_Special" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_LegacySupport" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_MIS" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_NoMips" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_NWM_Support" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_Ontario_RHW-10S" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW2_P57_EuroTextures_Sweden" ${road_texture3} /end
  nsArray::SetList NAM_Options "z1_RHW_P57_EuroTextures_LHDSupport" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_AVE-2.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_AVE-6.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_Icons.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_NRD-4.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_OWR.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_RD-3.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_RD-4.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_RD-6.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_TLA-3.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_TLA-5.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_TLA-7.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_NWM_Euro_TRM_TuLEP.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_RHW_P57_EuroTextures_CP_Autobahn_LHD" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_RHW_P57_EuroTextures_CP_UK_LHD" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_RHW_P57_EuroTextures_DV_LHD_Support" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_RHW_P57_EuroTextures_Ireland_LHD_Support" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_RHW_P57_EuroTextures_LotTextures" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_RHW_P57_EuroTextures_Norway_LHD_Support" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_RHW_P57_EuroTextures_Ontario_LHD_Support" ${road_texture3} /end
  nsArray::SetList NAM_Options "z2_RHW_P57_EuroTextures_RHW-2_Schellingen" ${road_texture3} /end
  nsArray::SetList NAM_Options "z3_NWM_Euro_TRM_NRD-4_Hamburg.dat" ${road_texture5} /end
  nsArray::SetList NAM_Options "z3_NWM_Euro_TRM_RD-4_Hamburg.dat" ${road_texture5} /end
  nsArray::SetList NAM_Options "z3_NWM_Euro_TRM_RD-6_Hamburg.dat" ${road_texture5} /end
  nsArray::SetList NAM_Options "z4_NWM_Euro_TRM_NRD-4_SSL.dat" ${road_texture6} /end
  nsArray::SetList NAM_Options "z4_NWM_Euro_TRM_RD-4_SSL.dat" ${road_texture6} /end
  nsArray::SetList NAM_Options "z4_NWM_Euro_TRM_RD-6_SSL.dat" ${road_texture6} /end
  nsArray::SetList NAM_Options "z5_NWM_Euro_TRM_NRD-4_Aus.dat" ${road_texture4} /end
  nsArray::SetList NAM_Options "z5_NWM_Euro_TRM_RD-4_Aus.dat" ${road_texture4} /end
  nsArray::SetList NAM_Options "z5_NWM_Euro_TRM_RD-6_Aus.dat" ${road_texture4} /end
  nsArray::SetList NAM_Options "zNAM_Retexture_and_Cosmetic_Mod_Streets_Superhands.dat" ${road_texture2} /end
  nsArray::SetList NAM_Options "zNAM_Retexture_and_Cosmetic_Mod_White_Pedestrian_Crossings.dat" ${road_texture2} /end
  nsArray::SetList NAM_Options "zzz_ADC_Madison_Wells_Station.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_Dexter_UK_Textures.dat" ${road_texture_option2} /end
  nsArray::SetList NAM_Options "zzz_eurotexture_culdesac.dat" ${road_texture9} /end
  nsArray::SetList NAM_Options "zzz_JENX_Bourse_de_Commerce.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_Marrast_Road_Overpass.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NOB_Ftexture.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NWM_Euro_TRM_ARD-3.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NWM_Euro_TRM_AVE-2.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NWM_Euro_TRM_AVE-6.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NWM_Euro_TRM_Icons.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NWM_Euro_TRM_MAVE-4.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NWM_Euro_TRM_MAVE-6.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NWM_Euro_TRM_OWR.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NWM_Euro_TRM_TLA-3.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_NWM_Euro_TRM_TLA-5.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_PEG_CDK_Ferry.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_RHW_EuroTextures_Lots.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_SAM_2_Euro_Textures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_SAM_3_Euro_Textures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_SAM_4_Euro_Textures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_SAM_7_Euro_Textures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_SAM_8_Euro_Textures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_SAM_9_Euro_Textures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz_YDR_Chancellory.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_Curves_Plugin.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_FAR_Plugin.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_FLUPs.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_GLR.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_Remove_OWR_Arrows.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_Roundabouts.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_Rural_Roads_Plugin.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_TuLEPs.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_Turning_Lanes_Roads.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz1_NAM_Euro_Textures_URail.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz2_Euro_Textures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz7_NAM_Euro_Textures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz7_NAM_Euro_Textures_LegacySupport_URail.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzz8_NAMOverpass_EURO_Dexter.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzMHW_Retexture_America.dat" ${road_texture10} /end
  nsArray::SetList NAM_Options "zzzMHW_Retexture_Euro.dat" ${road_texture10} /end
  nsArray::SetList NAM_Options "zzzNAM_Retexture_and_Cosmetic_Mod_Culdesac_Plugin_Superhands.dat" ${road_texture9} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_Avenue.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_DarkTextures.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_FAR_Intersections.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_OWR2.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_Road.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_RTL_Avenue_RHD.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_RTL_Road_RHD.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_SAM7.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_Streets.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_WRC.dat" ${road_texture3} /end
  nsArray::SetList NAM_Options "zzzz_MRTNRLN_EuroTextures_ZebraCrossings.dat" ${road_texture3} /end
  
  Call FindLastCleanitol
  StrCpy $R1 ""
  FindFirst $R9 $0 "$4"
  ${While} $0 != ""
    StrCpy $R2 1
NextOption:
    ClearErrors
    nsArray::Get NAM_Options /next
    IfErrors DeleteEnd 0
    Pop $1
    Pop $1
    ${If} $1 == "StationEnd"
      StrCpy $R2 0
      Goto NextOption
    ${EndIf}
    ClearErrors
    nsArray::Get NAM_Options /next
    IfErrors DeleteEnd 0
    Pop $2
    Pop $2
    StrCmp $0 $1 0 NextOption
      ${If} $R2 = 1
        ${If} $R1 == ""
          StrCpy $R1 "The following Mass Transit Lots in your Plugins folder are duplicates of Mass Transit Lots found in the NAM, and have been replaced by them.  In order to take advantage of the improved function of the NAM version of these Mass Transit Lots, please bulldoze your old ones and replop them.  In many cases, this is necessary for your networks to work properly.  Newly plopped lots will use the NAM version from now on.$\r$\n$\n"
        ${EndIf}
        SectionGetText $2 $7
        StrCpy $R1 "$R1$7$\r$\n"
      ${EndIf}
      !insertmacro SelectSection $2
      ${If} $2 = ${eltrain4}
        !insertmacro SelectSection ${eltrain5}    ;Two stations in one!
      ${EndIf}
      ClearErrors
      nsArray::Get NAM_Options /reset
DeleteEnd:
    FindNext $R9 $0
  ${EndWhile}
  FindClose $R9
  ${If} $R1 != ""
    MessageBox MB_OK|MB_ICONEXCLAMATION "$R1"
  ${EndIf}
FunctionEnd

Function FindLastCleanitol
  StrCpy $CleanitolDir "$DOCUMENTS\SimCity 4\BSC_Cleanitol"
  FindFirst $R9 $0 "$CleanitolDir\*"
  StrCpy $3 0
  ${While} $0 != ""
    ${StrLoc} $1 $0 "." >
    StrCmp $1 "0" CleanNext 0
    StrCpy $1 $0 8
    StrCpy $2 $0 "" 9
    StrCpy $5 "$1$2"
    ${If} $5 > $3
      StrCpy $3 $5
      StrCpy $4 "$CleanitolDir\$1_$2\*"
      StrCpy $6 "$CleanitolDir\$1_$2\"
    ${EndIf}
CleanNext:
    FindNext $R9 $0
  ${EndWhile}
  FindClose $R9
FunctionEnd

Function UpdateStations
  !insertmacro AddAllStations
  nsArray::Set Stations "StationEnd"
  Call FindLastCleanitol
  ClearErrors
  FileOpen $R0 "$6\undo.bat" r
  IfErrors 0 +2
    Return
  StrCpy $R1 0
  ${Do}
    ClearErrors
    FileRead $R0 $0
    IfErrors 0 +2
      ${ExitDo}
    ${Do}
      ClearErrors
      nsArray::Get Stations /next
      IfErrors DeleteEnd 0
      Pop $1
      Pop $1
      ${If} $1 == "StationEnd"
        ${ExitDo}
      ${EndIf}
      ClearErrors
      nsArray::Get Stations /next
      IfErrors DeleteEnd 0
      Pop $2
      Pop $2
      ClearErrors
      nsArray::Get Stations /next
      IfErrors DeleteEnd 0
      Pop $3
      Pop $3
      ClearErrors
      nsArray::Get Stations /next
      IfErrors DeleteEnd 0
      Pop $4
      Pop $4
      ClearErrors
      nsArray::Get Stations /next
      IfErrors DeleteEnd 0
      Pop $5
      Pop $5
      StrCpy $8 "\$4$\""                ;"
      ${StrStr} $9 $0 $8
      ${If} $9 == ""
        ${If} $5 == ""
          ${Continue}
        ${EndIf}
        StrCpy $8 "\$4$\""                ;"
        ${StrStr} $9 $0 $8
        ${If} $9 == ""
          ${Continue}
        ${EndIf}
      ${EndIf}
      StrCpy $7 $1
      ${StrStr} $9 $0 "DAMN"
      ${If} $9 != ""
        IntOp $7 $7 + 1
      ${EndIf}
      !insertmacro SelectSection $7
      ${If} $R1 = 0
        ClearErrors
        FileOpen $R1 "$6\undo_stations.bat" w
        IfErrors 0 OpenOK
          MessageBox MB_OK 'Cannot create "undo_stations.bat" file.  Station updating aborted.'
          Return
OpenOK:
      ${EndIf}
      FileWrite $R1 "$0"
      ClearErrors
DeleteEnd:
    ${Loop}
    nsArray::Get Stations /reset
  ${Loop}
  ${If} $R1 <> 0
    FileClose $R1
    ReadEnvStr $R3 COMSPEC
    SetOutPath $6
    ExecWait '"$R3" /C "$6\undo_stations.bat"'
    Delete "$6\undo_stations.bat"
  ${EndIf}
FunctionEnd

!macro BitRHW
  StrCpy $3 ""
  ${For} $2 0 4
    ${If} $2 < 3
      !insertmacro BitNet $3 rhw$2 1 9
    ${Else}
      !insertmacro BitNet $3 rhw$2 3 5
    ${EndIf}
    StrLen $4 $R2
    ${If} $R2 == ""
      StrCpy $R2 $3
    ${Else}
      StrCpy $R2 "$R2 $3"
    ${EndIf}
  ${Next}
!macroend

!macro BitNet reg net num lshift
  StrCpy ${reg} ""
  StrCpy $2 ${net}
  ${For} $0 1 ${num}
    ${If} ${SectionIsSelected} $2
      IntOp $1 $0 - 1
      IntOp $1 1 << $1
      IntOp ${reg} ${reg} | $1
    ${EndIf}
    IntOp $2 $2 + 1
  ${Next}
  IntOp ${reg} ${reg} << ${lshift}
  IntFmt ${reg} "0x%04X" ${reg}
!macroend

Function ProcessController
  SetOutPath "$NAMAuxDir\Tools"
  SetOverwrite ifnewer
  StrCpy $CompilerDir "$NAMAuxDir\Tools\Controller Compiler"
  File /r "Tools\Controller Compiler"
  DetailPrint "Building network controller..."
  Call ProcessXML
  ${If} $WriteController <= 0
    Return
  IfErrors CompilerFail 0
  ${EndIf}
  ${If} ${SectionIsSelected} ${controller1}
    StrCpy $bRight 1
  ${Else}
    StrCpy $bRight 0
  ${EndIf}
  ${If} ${SectionIsSelected} ${sec23}
    StrCpy $R0 1
  ${Else}
    StrCpy $R0 0
  ${EndIf}
  !insertmacro BitNet $R1 ${nwm1} 12 0
  !insertmacro BitNet $R2 ${rhw00} 9 0
  !insertmacro BitNet $R3 ${rhw10} 9 0
  !insertmacro BitNet $R4 ${rhw20} 9 0
  !insertmacro BitNet $R5 ${rhw32} 3 2
  !insertmacro BitNet $R6 ${rhw42} 3 2
  !insertmacro BitNet $R7 ${rhw53} 1 3
  !insertmacro BitNet $R8 ${rhw60} 1 0
  !insertmacro BitNet $R9 ${sam1} 10 0
;  ${If} $Wine = 0
    ExecWait '"$CompilerDir\NAMControllerCompiler.bat" "$CompilerDir\Network Addon Mod\Controller" "$INSTDIR" $bRight $R0 $R1 $R2 $R3 $R4 $R5 $R6 $R7 $R8 $R9' $0
/*  ${Else}
    ExecWait '"cmd" "/c" "$CompilerDir\NAMControllerCompiler_Linux.bat" "$CompilerDir\Network Addon Mod\Controller" "$INSTDIR" $bRight $R0 $R1 $R2 $R3 $R4 $R5 $R6 $R7 $R8 $R9' $0
  ${EndIf} */
  ${If} $0 <> 0
CompilerFail:
    MessageBox MB_OK|MB_ICONEXCLAMATION "The controller compiler failed to build a network compiler.  Therefore, a standard, full-featured controller will be used.  The only disadvantage this has over the custom controller created by the compiler is that game loading time may be somewhat longer, and time returning from the Zone and Subway Building views may be longer as well.$\r$\n$\nThe usual reason for this error is that you do not have Java installed.  If this is the case, you can install Java when the installation completes and run the NAM installer again.  You will then get a custom-built network compiler as part of your installation."
    SetOutPath $INSTDIR
    ${If} $bRight = 1
      CopyFiles "$CompilerDir\Network Addon Mod\Controller\NetworkAddonMod_Controller_RIGHT_HAND_VERSION.dat" "$INSTDIR\NetworkAddonMod_Controller.dat"
    ${Else}
      CopyFiles "$CompilerDir\Network Addon Mod\Controller\NetworkAddonMod_Controller_LEFT_HAND_VERSION.dat" "$INSTDIR\NetworkAddonMod_Controller.dat"
    ${EndIf}
  ${EndIf}
FunctionEnd

!macro _ControllerWrite handle string
  ${If} $WriteController = 1
    ClearErrors
    FileWrite ${handle} ${string}
    IfErrors 0 +3
      SetErrors
      Return
  ${EndIf}
!macroend

!define ControllerWrite `!insertmacro _ControllerWrite`

!macro _ProcessOneNode func
  StrCpy $R3 0
  StrCpy $R4 0
  ${Do}
    Call GetNode
    IfErrors EOF${func} 0
    ${StrStr} $1 $0 'name="'
    ${IfThen} $1 == "" ${|} Return ${|}
    StrCpy $2 $1 "" 6
    ${StrLoc} $3 $2 '"' >
    StrCpy $4 $2 $3
    Call ${func}
    Call WriteNode
    IfErrors 0 +3
      SetErrors
      Return
  ${Loop}
EOF${func}:
!macroend

!define ProcessOneNode `!insertmacro _ProcessOneNode`

Function SetParentNode
  ${If} $ParentNode <> 0
    SectionGetText $ParentNode $1
    StrCpy $2 $1 6
    ${If} $R4 = 1
      ${If} $R3 = 1
        StrCmp $2 "*SR*  " SPNEnd 0
        StrCmp $2 "*NR*  " 0 +2
          StrCpy $1 $1 "" 6
        Strcpy $1 "*SR*  $1"
      ${Else}
        StrCmp $2 "*NR*  " SPNEnd 0
        StrCmp $2 "*SR*  " 0 +2
          StrCpy $1 $1 "" 6
        Strcpy $1 "*NR*  $1"
      ${EndIf}
      Goto SetParent
    ${ElseIf} $WriteController <  0
      ${If} $R3 = 1
        StrCmp $2 "*NR*  " 0 NotSet
        StrCpy $1 $1 "" 6
        Strcpy $1 "*SR*  $1"
        Goto SetParent
      ${Else}
NotSet:
        ${StrStr} $2 $1 "R*  "
        ${If} $2 != ""
          StrCpy $1 $2 "" 4
        ${EndIf}
      ${EndIf}
SetParent:
      SectionSetText $ParentNode $1
      ${If} $ParentNode = ${sec20}
        StrCpy $ParentNode ${nwmgroup1}
        Call SetParentNode
      ${EndIf}
    ${EndIf}
  ${EndIf}
SPNEnd:
FunctionEnd

Function ProcessXML
  ClearErrors
  ${If} $WriteController <= 0
    FileOpen $R0 "$CompilerDir\resources\xml\RUL2_IID_structure.xml" r
  ${Else}
    FileOpen $R0 "$CompilerDir\resources\xml\RUL2_IID_structure_default.xml" r
    FileOpen $R1 "$CompilerDir\resources\xml\RUL2_IID_structure.xml" w
  ${EndIf}
  IfErrors 0 +3
    SetErrors
    Return
  ${ProcessOneNode} ProcessNode
  FileClose $R0
  ${If} $WriteController = 1
    FileClose $R1
  ${EndIf}
FunctionEnd

Function GetNode
  ${Do}
    FileRead $R0 $0
    IfErrors 0 +3
      SetErrors
      Return
    Call CheckComments
    ${StrStr} $1 $0 "<node "
    ${IfThen} $1 != "" ${|} Return ${|}
    ${StrStr} $1 $0 "</node>"
    ${If} $1 != ""
      SetErrors
      Return
    ${EndIf}
    ${ControllerWrite} $R1 $0
  ${Loop}
FunctionEnd

Function WriteNode
  ${ControllerWrite} $R1 $0
  ${StrStr} $1 $0 "</node>"
  ${IfThen} $1 != "" ${|} Return ${|}
  ${StrStr} $1 $0 "/>"
  ${IfThen} $1 != "" ${|} Return ${|}
  StrCpy $R2 1
  ${Do}
    ClearErrors
    FileRead $R0 $0
    IfErrors 0 +2
      Return
    Call CheckComments
    ${ControllerWrite} $R1 $0
    ${StrStr} $1 $0 "<node "
    ${If} $1 != ""
      IntOp $R2 $R2 + 1
      StrCpy $1 ""
      ${Continue}
    ${EndIf}
    ${StrStr} $1 $0 "</node>"
    ${If} $1 != ""
      IntOp $R2 $R2 - 1
      ${If} $R2 > 0
        StrCpy $1 ""
        ${Continue}
      ${EndIf}
    ${EndIf}
  ${LoopWhile} $1 == ""
FunctionEnd

!macro _SetNode num parent
  StrCpy $6 ${num}
  StrCpy $7 ${parent}
  Call SetNodeSelection
!macroend

!define SetNode `!insertmacro _SetNode`

!macro _ProcessRHWLevel level
  Push $R3
  Push $R4
  StrCpy $R3 0
  StrCpy $R4 0
  ${Do}
    Call GetNode
    IfErrors EOF${level} 0
    ${StrStr} $1 $0 'name="'
    ${IfThen} $1 == "" ${|} Return ${|}
    StrCpy $2 $1 "" 6
    ${StrLoc} $3 $2 '"' >
    StrCpy $4 $2 $3
    ${Select} $4
!if ${level} < 3
      ${Case} "RHW-2"
        ${SetNode} ${rhw${level}0} ${rhw${level}}
      ${Case} "RHW-3"
        ${SetNode} ${rhw${level}1} ${rhw${level}}
!endif
!if ${level} < 5
      ${Case} "MIS"
        ${SetNode} ${rhw${level}2} ${rhw${level}}
!endif
      ${Case} "RHW-4"
        ${SetNode} ${rhw${level}3} ${rhw${level}}
!if ${level} < 5
      ${Case} "RHW-6S"
        ${SetNode} ${rhw${level}4} ${rhw${level}}
!endif
!if ${level} < 3
      ${Case} "RHW-8S"
        ${SetNode} ${rhw${level}5} ${rhw${level}}
      ${Case} "RHW-10S"
        ${SetNode} ${rhw${level}6} ${rhw${level}}
      ${Case} "RHW-6C"
        ${SetNode} ${rhw${level}7} ${rhw${level}}
      ${Case} "RHW-8C"
        ${SetNode} ${rhw${level}8} ${rhw${level}}
!endif
      ${CaseElse}
    ${EndSelect}
    Call WriteNode
    IfErrors 0 +3
      SetErrors
      Return
  ${Loop}
EOF${level}:
  StrCpy $ParentNode ${rhw${level}}
  Call SetParentNode
  ${IfThen} $R3 = 1 ${|} StrCpy $R5 1 ${|}
  ${IfThen} $R4 = 1 ${|} StrCpy $R6 1 ${|}
  Pop $R4
  Pop $R3
!macroend

!define ProcessRHWLevel `!insertmacro _ProcessRHWLevel`

Function SetNodeSelection
  ${If} ${SectionIsSectionGroup} $6
    ${ControllerWrite} $R1 $0
    ${Select} $6
      ${Case} ${sec18}
        ${ProcessOneNode} ProcessGLRNode
      ${Case} ${sec20}
        ${ProcessOneNode} ProcessNWMNode
      ${Case} ${sec19}
        StrCpy $R5 0
        StrCpy $R6 0
        ${ProcessOneNode} ProcessRHWNode
        ${IfThen} $R5 = 1 ${|} StrCpy $R3 1 ${|}
        ${IfThen} $R6 = 1 ${|} StrCpy $R4 1 ${|}
        StrCpy $ParentNode ${sec19}
      ${Case} ${rhw0}
        ${ProcessRHWLevel} 0
      ${Case} ${rhw1}
        ${ProcessRHWLevel} 1
      ${Case} ${rhw2}
        ${ProcessRHWLevel} 2
      ${Case} ${rhw3}
        ${ProcessRHWLevel} 3
      ${Case} ${rhw4}
        ${ProcessRHWLevel} 4
      ${Case} ${rhw5}
        ${ProcessRHWLevel} 5
      ${Case} ${sec21}
        ${ProcessOneNode} ProcessSAMNode 
      ${CaseElse}
    ${EndSelect}
  ${ElseIf} $WriteController = 1
    ${IfNot} ${SectionIsSelected} $6
      ${StrLoc} $5 $0 "/>" >
      ${If} $5 != ""
        StrCpy $0 $0 $5
        StrCpy $8 "/>"
      ${Else}
        ${StrLoc} $5 $0 ">" >
        StrCpy $0 $0 $5
        StrCpy $8 ">"
      ${EndIf}
      StrCpy $0 '$0 disabled="true"$8$\r$\n'
    ${Else}
      ${StrLoc} $5 $0 "disabled" >
      ${If} $5 != ""
        StrCpy $8 $0 $5
        IntOp $5 $5 + 16
        StrCpy $9 $0 "" $5
        StrCpy $0 "$8$9"
      ${EndIf}
    ${EndIf}
    ${IfNot} ${SectionIsSelected} $6
    ${OrIf} ${SectionIsBold} $6
      ${StrLoc} $5 $0 "/>" >
      ${If} $5 != ""
        StrCpy $0 $0 $5
        StrCpy $8 "/>"
      ${Else}
        ${StrLoc} $5 $0 ">" >
        StrCpy $0 $0 $5
        StrCpy $8 ">"
      ${EndIf}
      StrCpy $0 '$0 selected="true"$8$\r$\n'
    ${EndIf}
  ${ElseIf} ${SectionIsSelected} $6
    ${If} $WriteController = 0
      ${StrStr} $5 $0 'selected="true"'
      ${If} $5 != ""
        !insertmacro SetSectionFlag $6 ${SF_BOLD}
        StrCpy $R4 1
      ${Else}
        StrCpy $R3 1
      ${EndIf}
    ${Else}
      ${If} ${SectionIsBold} $6
        StrCpy $R4 1
      ${Else}
        StrCpy $R3 1
      ${EndIf}
    ${EndIf}
    StrCpy $ParentNode $7
  ${ElseIf} $WriteController < 0
  ${AndIf} ${SectionIsBold} $6
    SectionGetText ${sec19} $1
    StrCpy $1 $1 6
    SectionGetText $7 $2
    StrCpy $2 $2 6
    ${If} $6 > ${rhw0}
    ${AndIf} $6 <= ${rhw60}
    ${AndIf} $RHWNR = 1
    ${AndIf} $1 != "*NR*  "
    ${AndIf} $2 != "*SR*  "
      !insertmacro SelectSection $6
      StrCpy $R4 1
    ${Else}
      !insertmacro ClearSectionFlag $6 ${SF_BOLD}
    ${EndIf}
    StrCpy $ParentNode $7
  ${EndIf}
FunctionEnd

Function ProcessNode
  ${Select} $4
    ${Case} "El Rail over Avenue"
      ${SetNode} ${elrail2a} ${plugin5}
    ${Case} "Elevated Road Networks"
      ${SetNode} ${elroadnet1} 0
    ${Case} "Ground Light Rail"
      ${SetNode} ${sec18} 0
    ${Case} "High Speed Rail"
      ${SetNode} ${sec30} 0
    ${Case} "Network Widening Mod"
      ${SetNode} ${sec20} 0
    ${Case} "Real Highway Mod"
      ${SetNode} ${sec19} ${sec19}
    ${Case} "Street Addon Mod"
      ${SetNode} ${sec21} 0
    ${CaseElse}
  ${EndSelect}
  Call SetParentNode
FunctionEnd

Function ProcessGLRNode
  ${Select} $4
    ${Case2} "Urban GLR" "Rural GLR"
      ${SetNode} ${tram1} ${sec18}
    ${Case2} "GLR Extension Set 1" "GLR Extension Set 2"
      ${SetNode} ${tram5} ${sec18}
    ${CaseElse}
  ${EndSelect}
FunctionEnd

Function ProcessNWMNode
  ${Select} $4
    ${Case} "NWM TLA-3"
      ${SetNode} ${nwm1} ${sec20}
    ${Case} "NWM AVE-2"
      ${SetNode} ${nwm2} ${sec20}
    ${Case} "NWM ARD-3"
      ${SetNode} ${nwm3} ${sec20}
    ${Case} "NWM OWR-1"
      ${SetNode} ${nwm4} ${sec20}
    ${Case} "NWM OWR-3"
      ${SetNode} ${nwm5} ${sec20}
    ${Case} "NWM NRD-4"
      ${SetNode} ${nwm6} ${sec20}
    ${Case} "NWM TLA-5"
      ${SetNode} ${nwm7} ${sec20}
    ${Case} "NWM OWR-4"
      ${SetNode} ${nwm8} ${sec20}
    ${Case} "NWM OWR-5"
      ${SetNode} ${nwm9} ${sec20}
    ${Case} "NWM RD-4"
      ${SetNode} ${nwm10} ${sec20}
    ${Case} "NWM RD-6"
      ${SetNode} ${nwm11} ${sec20}
    ${Case} "NWM Triple-Tile Networks"
      ${SetNode} ${nwm12} ${sec20}
    ${CaseElse}
  ${EndSelect}
FunctionEnd

Function ProcessRHWNode
  ${Select} $4
    ${Case} "L0 Networks"
      ${SetNode} ${rhw0} ${sec19}
    ${Case} "L1 Networks"
      ${SetNode} ${rhw1} ${sec19}
    ${Case} "L2 Networks"
      ${SetNode} ${rhw2} ${sec19}
    ${Case} "L3 Networks"
      ${SetNode} ${rhw3} ${sec19}
    ${Case} "L4 Networks"
      ${SetNode} ${rhw4} ${sec19}
    ${Case} "DDRHW"
      ${SetNode} ${rhw5} ${sec19}
    ${Case} "FARHW"
      ${SetNode} ${rhw60} ${sec19}
    ${CaseElse}
  ${EndSelect}
FunctionEnd

Function ProcessSAMNode
  ${Select} $4
    ${Case} "Set 1 - Parking Lots"
      ${SetNode} ${sam1} ${sec21}
    ${Case} "Set 2 - Herringbone Brick Streets"
      ${SetNode} ${sam2} ${sec21}
    ${Case} "Set 3 - PEG Dirt Streets"
      ${SetNode} ${sam3} ${sec21}
    ${Case} "Set 4 - PEG Gravel Streets"
      ${SetNode} ${sam4} ${sec21}
    ${Case} "Set 5 - Trolca Dirt Streets"
      ${SetNode} ${sam5} ${sec21}
    ${Case} "Set 6 - Klinker Streets"
      ${SetNode} ${sam6} ${sec21}
    ${Case} "Set 7 - Asphalt Streets"
      ${SetNode} ${sam7} ${sec21}
    ${Case} "Set 8 - Cobblestone Streets"
      ${SetNode} ${sam8} ${sec21}
    ${Case} "Set 9 - Brick Streets"
      ${SetNode} ${sam9} ${sec21}
    ${Case} "Set 10 - Japanese Streets"
      ${SetNode} ${sam10} ${sec21}
    ${CaseElse}
  ${EndSelect}
FunctionEnd

Function CheckComments
  ${StrStr} $1 $0 "<!--"
  ${If} $1 != ""
    ${StrStr} $1 $0 "-->"
    ${While} $1 == ""
      ${ControllerWrite} $R1 $0
      FileRead $R0 $0
      IfErrors 0 +3
        FileClose $R1
        Return
      ${StrStr} $1 $0 "-->"
    ${EndWhile}
  ${EndIf}
FunctionEnd

!macro _GetNetworkState first last
  StrCpy $0 0
  ${ForEach} $1 ${last} ${first} - 1
    IntOp $0 $0 << 1
    ${If} ${SectionIsSelected} $1
      IntOp $0 $0 + 1
    ${EndIf}
  ${Next}
!macroend
 
!define GetNetworkState `!insertmacro _GetNetworkState`

Function SaveRNetworkState
  Push $0
  Push $1
  ${GetNetworkState} ${plugin5} ${elrail2a}
  StrCpy $SavedElRailOverAvenue $0
  ${GetNetworkState} ${elroadnet1} ${sec26}
  StrCpy $SavedElevatedRoad $0
  ${GetNetworkState} ${sec18} ${tram5}
  StrCpy $SavedGLR $0
  ${GetNetworkState} ${sec30} ${sec30}
  StrCpy $SavedHSR $0
  ${GetNetworkState} ${sec20} ${nwm12}
  StrCpy $SavedNWM $0
  ${GetNetworkState} ${sec19} ${rhw28}
  StrCpy $SavedRHW1 $0
  ${GetNetworkState} ${rhw3} ${rhw60}
  StrCpy $SavedRHW2 $0
  ${GetNetworkState} ${sec21} ${sam10}
  StrCpy $SavedSAM $0
  Pop $1
  Pop $0
FunctionEnd

Function CheckOneNetwork
  IntOp $4 $3 & 1
  IntOp $5 $0 & 1
  ${If} $4 = 1
    ${If} ${SectionIsSectionGroup} $2
      ${If} $5 = 0
      ${AndIfNot} ${SectionIsPartiallySelected} $2
        ${If} $2 = ${sec19}
        ${OrIf} $2 = ${sec20}
          StrCpy $9 $2
          ${If} $2 = ${sec19}
            SectionGetText $2 $6
            StrCpy $6 $6 6
            ${If} $6 == "*NR*  "
              StrCpy $R7 1
            ${EndIf}
          ${EndIf}
          Goto NextNetwork
        ${Endif}
        ${If} $8 <> 0
        ${AndIf} $7 = 1
          !insertmacro SelectSection $8
          StrCpy $7 0
        ${EndIf}
        ${If} $9 <> 0
        ${AndIf} $9 <> ${sec19}
          !insertmacro SelectSection $9
        ${EndIf}
        StrCpy $8 $2
      ${Else}
        StrCpy $8 0
      ${EndIf}
    ${Else}
      ${If} $5 = 0
        ${IfNot}  ${SectionIsBold} $2
          ${If} $2 > ${plugin5}
          ${AndIf} $2 < ${elrail2a}
          ${OrIf} $2 > ${tram1}
          ${AndIf} $2 < ${tram5}
            Goto NextNetwork
          ${EndIf}
          IntOp $6 ${SF_BOLD} | ${SF_SELECTED}
          !insertmacro SetSectionFlag $2 $6
          StrCpy $7 1
        ${EndIf}
      ${EndIf}
    ${EndIf}
    StrCpy $R0 1
  ${EndIf}
NextNetwork:
  IntOp $3 $3 >> 1
  IntOp $0 $0 >> 1
FunctionEnd

!macro _CheckNetworkState network first last
  ${If} ${network} <> $SavedRHW2
    StrCpy $7 0
    StrCpy $8 0
  ${EndIf}
  ${GetNetworkState} ${first} ${last}
  IntOp $3 ${network} ^ $0
  ${For} $2 ${first} ${last}
    Call CheckOneNetwork
  ${Next}
  ${If} $8 <> 0
  ${AndIf} ${network} <> $SavedRHW1
    ${If} $7 = 1
      !insertmacro SelectSection $8
    ${EndIf}
    ${If} $9 <> 0
      ${If} ${network} = $SavedNWM
        !insertmacro SelectSection $9
      ${EndIf}
    ${EndIf}
  ${EndIf}
!macroend

!define CheckNetworkState `!insertmacro _CheckNetworkState`

Function CheckRNetworkStates
  StrCpy $R0 0
  ${CheckNetworkState} $SavedElRailOverAvenue ${plugin5} ${elrail2a}
  ${CheckNetworkState} $SavedElevatedRoad ${sec26} ${elroadnet1}
  ${CheckNetworkState} $SavedGLR ${sec18} ${tram5}
  ${CheckNetworkState} $SavedHSR ${sec30} ${sec30}
  StrCpy $9 0
  ${CheckNetworkState} $SavedNWM ${sec20} ${nwm12}
  ${If} ${SectionIsSelected} ${sec20}
  ${AndIfNot} ${SectionIsSelected} ${nwmgroup1}
  ${AndIfNot} ${SectionIsPartiallySelected} ${nwmgroup1}
    !insertmacro UnselectSection ${sec20}
  ${EndIf}
  StrCpy $9 0
  StrCpy $RHWNR 0
  ${CheckNetworkState} $SavedRHW1 ${sec19} ${rhw28}
  ${CheckNetworkState} $SavedRHW2 ${rhw3} ${rhw60}
  StrCpy $RHWNR $R6
  ${CheckNetworkState} $SavedSAM ${sec21} ${sam10}
  ${If} $R0 = 1
    StrCpy $WriteController -1
    Call ProcessController
    Call SaveRNetworkState
    ${If} $9 = ${sec19}
    ${AndIf} ${SectionIsSelected} ${sec19}
    ${AndIf} $R7 = 1
      StrCpy $R7 0
      !insertmacro UnselectSection ${sec19}
      Call ProcessController
      Call SaveRNetworkState
    ${EndIf}
  ${EndIf}
   StrCpy $SelectCount 0
FunctionEnd

Function SetupTypeLeave
  Call OldNAMSearch
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_MINIMAL}
    IfFileExists "$INSTDIR\NetworkAddonMod_IndividualNetworkRULs.dat" 0 STL2
      StrCpy $NewNAM 0
      MessageBox MB_YESNOCANCEL|MB_DEFBUTTON1|MB_ICONQUESTION 'You currently have a version of the NAM installed.  Would you like to keep your current version?  If so, select "Yes", and you can make changes to your traffic simulator while keeping your current version of the NAM.  Otherwise, select "No", and only the traffic simulator and its related components will be checked on the Components page.  If you select "Cancel", you will be returned to the main Setup Type page.' IDYES STL1 IDNO STL2
      Abort
STL1:
      !insertmacro UMUI_UNSET_INSTALLFLAG ${UMUI_MINIMAL}
      !insertmacro UMUI_SET_INSTALLFLAG ${UMUI_CUSTOM}
STL2:
    !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_CUSTOM}
      !insertmacro SetSectionFlag ${secgrp1} ${SF_EXPAND}
      !insertmacro ClearSectionFlag ${secgrp4} ${SF_EXPAND}
    !insertmacro UMUI_ENDIF_INSTALLFLAG
  !insertmacro UMUI_ENDIF_INSTALLFLAG
FunctionEnd

Function SelectDrivingSide
  ${If} $LanguageReminder = 1
    MessageBox MB_OK "Be sure to select the traffic side on the next page."
  ${ElseIf} $LanguageKnown = 1
    ${If} $bRight = 0
      SectionSetFlags ${controller1} 0
      SectionSetFlags ${controller2} ${SF_SELECTED}
      SectionSetFlags ${controller3} 0
    ${EndIf}
    ${If} $LanguageReminder = 0
    ${AndIf} $OSLang = 0
      SectionSetText ${sec3} "Traffic Driving Side (Usually shouldn't be changed)"
      !insertmacro ClearSectionFlag ${sec3} ${SF_EXPAND}
    ${EndIf}
    !insertmacro StartRadioButtons $ButtonGroup5
      !insertmacro RadioButton ${controller1}
      !insertmacro RadioButton ${controller2}
      !insertmacro RadioButton ${controller3}
    !insertmacro EndRadioButtons
  ${EndIf}
FunctionEnd

Function OldNAMSearch
  ${DirState} $INSTDIR $0
  ${If} $0 = 1
    StrCpy $OldInstallDir $INSTDIR
    Call FindSimCity
    StrCpy $AlreadyInstalled 1
    Return
  ${EndIf}
  Call FindOldNAM
  ${If} $OldInstallDir != ""
    StrCpy $INSTDIR $OldInstallDir
  ${Else}
    StrCpy $DirectoryWarning "$\r$\n$\nIF YOU HAVE A PREVIOUS VERSION OF THE NAM INSTALLED IN A FOLDER OTHER THAN THE ONE LISTED BELOW, YOU MUST EITHER UNINSTALL THAT VERSION OF THE NAM OR CHANGE THE FOLDER BELOW TO POINT TO IT IN ORDER FOR THE NEW NAM TO WORK PROPERLY."
  ${EndIf}
FunctionEnd

; Where, oh where can our little NAM be?
; Oh where, oh where can it be?
; With its comments cut short, and its code cut long,
; Oh where, oh where can it be?

Function FindOldNAM
  Call FindSimCity
  ${IfThen} $SC4InstallDir == "" ${|} Goto Locate1 ${|}
  StrCpy $0 "$1\Plugins\Network Addon Mod"
  IfFileExists $0 0 Locate1
    StrCpy $OldInstallDir $0
    StrCpy $AlreadyInstalled 1
    Return
Locate1:
  Strcpy $0 "$DOCUMENTS\SimCity 4\Plugins"
  Call LocateTree
  IfErrors Locate2
    StrCpy $OldInstallDir $INSTDIR
    StrCpy $AlreadyInstalled 1
    Return
Locate2:
  ${If} $SC4InstallDir != ""
    Strcpy $0 "$SC4InstallDir\Plugins"
    Call LocateTree
    IfErrors Locate3
      StrCpy $OldInstallDir $INSTDIR
      StrCpy $AlreadyInstalled 1
  ${EndIf}
Locate3:
FunctionEnd

Function LocateTree
  ClearErrors
  ${Locate} $0 /L=D IsNAMDir
  IfErrors Locate1 0
    StrCpy $0 $R0
    ClearErrors
    Return
Locate1:
  SetErrors
FunctionEnd

Function DeleteCompressedNAM
  IfFileExists "$0\Plugins\Plugins_Compressed\Network Addon Mod.dat" 0 +3
    Delete "$0\Plugins\Plugins_Compressed\Network Addon Mod.dat"
    Goto DCNWarn
  IfFileExists "$0\Plugins\Plugins_Compressed\NetworkAddon*_Beta*.dat" 0 DCNEnd
    Delete "$0\Plugins\Plugins_Compressed\Network Addon Mod.dat"
DCNWarn:
    MessageBox MB_OK "A copy of the NAM has been found in your DatPacked files and has been deleted.  In the future, please do not DatPack the NAM, as doing so can cause many problems."
DCNEnd:
FunctionEnd

; Oh no, now we've lost SimCity...

Function FindSimCity
  ClearErrors
  ReadRegStr $SC4InstallDir HKLM "Software\Maxis\SimCity 4" "Install Dir"
  IfErrors CheckMore 0
  IfFileExists "$SC4InstallDir\Apps\SimCity 4.exe" FoundIt
CheckMore:
  StrCpy $SC4InstallDir "$PROGRAMFILES\Maxis\SimCity 4\"
  ${DirState} $SC4InstallDir $0 
  ${If} $0 < 1
    StrCpy $SC4InstallDir "$PROGRAMFILES\Maxis\SimCity 4 Deluxe\"
  ${EndIf}
  Strlen $0 $SC4InstallDir
  IntOp $0 $0 - 1
  StrCpy $SC4InstallDir $SC4InstallDir $0            ;Remove trailing slash
  IfFileExists $SC4InstallDir FoundIt
  StrCpy $3 'In the following dialog box, please choose the folder containing your SimCity 4 installation.  It is normally named either "SimCity 4" or "SimCity 4 Deluxe".'
  ${Locate} $PROGRAMFILES /L=F IsSimCity
  StrCmp $R0 "" 0 FixPath
    ${If} $PROGRAMFILES != $PROGRAMFILES64
      ${Locate} $PROGRAMFILES64 /L=F IsSimCity
      StrCmp $R0 "" 0 FixPath
    ${EndIf}
    MessageBox MB_YESNO|MB_ICONQUESTION|MB_DEFBUTTON2 "Are you installing the NAM on this machine so that it can be ported to a Mac?" IDNO GetSC4Folder
    StrCpy $SC4InstallDir ""
    Return
GetSC4Folder:
    MessageBox MB_OK|MB_ICONINFORMATION 'The installer cannot find the SimCity 4 installation folder on your system.  $3'
GetSC4Folder2:
    Dialogs::Folder "SimCity 4 Folder Dialog" "Please select your SimCity 4 installation folder." $PROGRAMFILES ${VAR_0}
    StrCpy $SC4InstallDir $0
    StrCmp $SC4InstallDir "" 0 FoundIt
    MessageBox MB_YESNO|MB_ICONQUESTION|MB_DEFBUTTON2 "If you do not select your SimCity 4 installation folder, the installer will have to terminate.$\r$\n$\nDo you wish to terminate the installation?" IDNO GetSC4Folder2
    Quit
FixPath:
  StrCpy $0 $R0
  StrCpy $SC4InstallDir $0 -5                       ;Remove \Apps
FoundIt:
  StrCpy $0 $SC4InstallDir
  System::Call 'kernel32::GetLongPathName(t r0, t .r1, i ${NSIS_MAX_STRLEN}) i .r2'
  StrCmp $2 error +2
  StrCpy $SC4InstallDir $1
  StrCpy $SC4Exec "$SC4InstallDir\Apps\SimCity 4.exe"
  IfFileExists $SC4Exec SC4Exists 0
    MessageBox MB_OK|MB_ICONEXCLAMATION "The file $\"SimCity 4.exe$\" cannot be found in its installation directory.  $3"
    Goto GetSC4Folder2
SC4Exists:
  MoreInfo::GetFileVersion $SC4Exec
  Pop $0
  StrCpy $1 $0 3
  StrCmp $1 "1.0" 0 CheckRH
    MessageBox MB_OK|MB_ICONSTOP "You have the original version of the game installed.  In order to run the NAM, you must have the Rush Hour Expansion pack or else the Deluxe version of the game.  The Rush Hour Expansion Pack is no longer generally available, but you can purchase the CD or downloadable version of Sim City 4 Deluxe at places such as Amazon.com, or you can get the downloadable version at places such as Steampowered.com or Origin.com.  (These latter two come with DRM restrictions.)  Simply search for $\"Sim City 4 Deluxe Edition$\" at these sites.  When you get the game, install it, and then restart the NAM installer.$\r$\n$\nThe NAM installer will now exit."
    Quit
CheckRH:
  StrCmp $1 "1.1" ValidExec 0
  MessageBox MB_OK|MB_ICONSTOP "Your version of the SimCity 4.exe file does not have the correct header, and may be damaged.  Please reinstall the game, and then restart the NAM installer."
  Quit
ValidExec:
  StrCpy $5 0
  ${Do}
    StrLen $2 $0
    IntOp $2 $2 - 4
    IntOp $2 0 - $2
    StrCpy $1 $0 3 $2
    ${StrStr} $3 $0 "641"
    ${If} $1 < 638
    ${AndIf} $3 == ""
      MessageBox MB_YESNO|MB_ICONEXCLAMATION|MB_DEFBUTTON1 "Your version of SimCity 4 does not have a required patch from EA/Maxis.  The game must be patched to at least version 1.1.638.0 in order for the NAM (and almost all custom content) to work properly.  Do you want to install this patch now?" IDYES PatchEP1
      MessageBox MB_OK|MB_ICONINFORMATION "The NAM installer will now exit.  You may rerun it once you have patched your game at least to version 1.1.638.0, or if you want the installer to guide you through this patch."
      Quit
PatchEP1:
      FindFirst $6 $7 "$SC4InstallDir\Sku_Data\Sku*"
      FindClose $6
      ${If} $7 != ""
        StrCpy $7 $7 1 3
        StrCpy $7 "SKU $7"
      ${Else}
        StrCpy $7 " proper "
      ${EndIf}
      StrCpy $4 0
      MessageBox MB_YESNO|MB_ICONINFORMATION|MB_DEFBUTTON1 'You will now be taken to the license agreement page for the 1.1.638.0 patch.  Once you accept the agreement, you will be taken to the Main Maxis Page.  The link that you want is the last one on this page; the link is entitled "SC4 Update( Rush Hour / Deluxe Version)".  When you click on this link, you will be taken to the actual download page, where you should follow the instructions for downloading the patch.  You will need the $7 patch for your region, and you must install the patch as an Administrator.  The NAM installer can wait for you while you download and install the patch, or else the NAM installer can exit now and you can restart it after you have the patch installed.  Do you want the installer to wait while you download and install the patch?' IDNO DoNotWait
      StrCpy $4 1
DoNotWait:
      ExecShell "open" "http://sc4devotion.com/forums/index.php?page=6"
      ${If} $4 = 0
        Quit
      ${Endif}
      MessageBox MB_OKCANCEL|MB_ICONINFORMATION "Select $\"OK$\" once you have successfully installed the patch, or select $\"Cancel$\" if the patch fails to install successfully, or if you wish to terminate the NAM installation." IDOK PatchEP1OK
      MessageBox MB_OK|MB_ICONINFORMATION "The NAM installation will now terminate."
      Quit
PatchEP1OK:
      MoreInfo::GetFileVersion $0
    ${Else}
      StrCpy $5 1
    ${EndIf}
  ${LoopUntil} $5 = 1
  StrCpy $0 1
  ClearErrors
  ReadRegDWORD $0 HKCU "Software\Network Addon Mod" "Night Lighting"
  ${If} $1 < 640
  ${AndIf} $3 == ""
  ${AndIf} $0 = 0
    MessageBox MB_YESNO|MB_ICONINFORMATION|MB_DEFBUTTON1 "Your game does not have the Night Lighting patch (1.1.640.0).  Although not strictly required for the operation of the NAM, this patch allows you to see lights come on at night time for buildings that have them, including a number of structures in the NAM.  This patch is highly recommended.  Do you want to install it now?" IDNO NoNightLights
    StrCpy $4 0
    MessageBox MB_YESNO|MB_ICONINFORMATION|MB_DEFBUTTON1 'You will now be taken to the download page for the 1.1.640.0 patch.  The download that you want is in the section entitled "Recommended Downloads".  The link for the patch is on the left, and is entitled "Sim City 4 Buildings Update".  You must install the patch as an Administrator.  The NAM installer can wait for you while you download and execute the patch, or else the installer can exit now and you can restart it after you have the patch installed.  Do you want the installer to wait while you download and install the patch?' IDNO DoNotWait2
    StrCpy $4 1
DoNotWait2:
    ExecShell "open" "http://sc4devotion.com/forums/index.php?page=14"
    ${If} $4 = 0
      Quit
    ${Endif}
    MessageBox MB_OKCANCEL|MB_ICONINFORMATION "Select $\"OK$\" once you have successfully installed the patch, or select $\"Cancel$\" if the patch fails to install successfully and you wish to terminate the NAM installation." IDOK PatchNLOK
    MessageBox MB_OK|MB_ICONINFORMATION "The NAM installation will now terminate."
    Quit
NoNightLights:
    WriteRegDWORD HKCU "Software\Network Addon Mod" "Night Lighting" 1
PatchNLOK:
  ${EndIf}
  Call MemoryPatches
FunctionEnd

Function IsSimCity
  StrCmp $R7 "SimCity 4.exe" +3
NotFound:
    Push 0
    return
  StrCmp $R6 "0" "" NotFound
  StrCpy $R0 $R8
  StrCpy $0 StopLocate
  Push $0
FunctionEnd

Function IsNAMDir
  StrCmp $R7 "NetworkAddon*_Beta*" 0 NotBeta
  ${DirState} $R9 $0
  ${If} $0 >= 0
    RMDir /r $R9
    Goto NotFound
  ${EndIf}
NotBeta:
  StrCmp $R7 "Network Addon Mod" Found2
  ${If} $R7 == "Plugins"
    IfFileExists "$R9\*\NetworkAddonMod_Custom_Highway_Menu_Plugin_Optional.dat" 0 NotFound0
      IfFileExists "$R9\*\*\NetworkAddonMod_Custom_Highway_Menu_Plugin_Optional.dat" 0 NotFound0
        MessageBox MB_OK|MB_ICONSTOP "NAM files have been found in the top level of your Plugins folder.  Any NAM files and folders that are directly under your Plugins folder should be manually removed, and this installation should then be restarted."
        Quit
  ${EndIf}
NotFound0:
  IfFileExists "$R9\NetworkAddonMod_IndividualNetworkRULs.dat" 0 NotFound
  ClearErrors
  FindFirst $0 $1 "$R9\*"
  ${Do}
    IfErrors NotFound 0
    ${DirState} $1 $2
    ${If} $2 >=  0
      ${Select} $1
      ${Case3} "NetworkAddonMod*.dat" "*.url" "uninst.exe"
      ${CaseElse}
        MessageBox MB_YESNOCANCEL|MB_ICONQUESTION "The folder $\"$R7$\" (full pathname $\"$R9$\") has been found to contain NAM files, but it also appears to contain files that are not from the NAM.  Is this your NAM folder or not?" IDNO NotNAM IDCANCEL CancelSearch
        FindClose $0
        Goto Found2
CancelSearch:
        Quit
NotNAM:
        Delete "$R9\NetworkAddonMod*.dat"
        MessageBox MB_OK|MB_ICONEXCLAMATION "NAM files have been deleted from the folder $\"$R9$\".  If there are any subfolders of this folder that contain NAM files or files for NAM plugins, you should delete them manually at the conclusion of this installation."
        ${ExitDo}
      ${EndSelect}
    ${EndIf}
    FindNext $0 $1
    IfErrors Found1
  ${Loop}
NotFound:
  Push 0
  Return
Found1:
  FindClose $0
Found2:
  StrCpy $R0 $R9
  StrCpy $0 StopLocate
  Push $0
FunctionEnd

Function CheckDir
  ${StrStr} $0 $INSTDIR "\Plugins"
  StrCmp $0 "" 0 Check1
  MessageBox MB_OK|MB_ICONSTOP "The installation path must include a $\"Plugins$\" folder.  Please edit the destination folder and try again."
  Abort
Check1:
  Call CreateInstDir
  IfErrors 0 +2
    Abort
  ${StrStr} $0 $INSTDIR "Documents\"
  ${If} $0 != ""
    ${StrLoc} $0 $INSTDIR "Documents\" >
    IntOp $0 $0 + 9
    StrCpy $SC4Docs $INSTDIR $0
    ${StrLoc} $0 $INSTDIR "\SimCity 4\Plugins\" <
    ${IfThen} $0 == "" ${|} Return ${|}
    IntOp $0 $0 + 1
    StrLen $1 $INSTDIR
    IntOp $1 $1 - $0
    StrCpy $2 $INSTDIR $1
    StrCpy $z___NAM "$2\z___NAM"
    IntOp $1 $1 - 8
    StrCpy $2 $INSTDIR $1
    StrCpy $NAMAuxDir "$2\NAM Auxiliary Files"
  ${EndIf}
FunctionEnd

Function CreateInstDir
  ${DirState} $INSTDIR $0
  ${If} $0 = -1
    ClearErrors
    CreateDirectory $INSTDIR
    IfErrors 0 +3
      MessageBox MB_OK|MB_ICONSTOP "Could not create installation directory"
      SetErrors
      Return
  ${EndIf}
FunctionEnd

/*
 * OK, now it's time for the memory patches!
 * "Patches?  We don't need no stinkin' patches!"
 * We'll see about that...
 */
Function MemoryPatches
  SetOutPath "$NAMAuxDir\Tools"
  File "Tools\4gb_patch.exe"
  File "Tools\Patch32.bat"
  File "Tools\Unpatch32.bat"
  ClearErrors
  ReadRegDWORD $5 HKLM "Software\Maxis\SimCity 4" "Large Address Aware"
  ${IfNot} ${AtLeastWin2000}
  ${OrIf} $5 > 0
    Return
  ${EndIf}
  # allocate
  System::Alloc 64  
  Pop $1
  # init
  System::Call "*$1(i64)"
  # call
  System::Call "Kernel32::GlobalMemoryStatusEx(i r1)"
  # get
  System::Call "*$1(i.r2, i.r3, l.r4, l.r5, l.r6, l.r7, l.r8, l.r9, l.r10)"
  # free
  System::Free $1
  System::Int64Op $4 / 1048576
  Pop $Memory
  GetVersion::WindowsPlatformArchitecture
  Pop $WindowsArchitecture
  ${If} $WindowsArchitecture = 64
  ${OrIf} $Wine = 1
    ${If} $Wine = 1
      StrCpy $1 3
    ${Else}
      StrCpy $1 4
    ${EndIf}
    StrCpy $2 "This operation is completely harmless, and has no negative side effects."
    StrCpy $4 'Select "OK" to allow the installer to make this change, or "Cancel" to terminate the NAM installation.'
  ${ElseIf} $WindowsArchitecture = 32
    /*StrCpy $1 3
    StrCpy $6 ""
    StrCpy $9 '$\r$\n$\nTo continue viewing this message, please select "OK".'
	
    ${If} ${AtLeastWinVista}
      StrCpy $3 'running the file "Unpatch32.bat", which can be found in the Tools subfolder of your main NAM folder.'
    ${Else}
      StrCpy $3 ' deleting the file "boot.ini" on your boot drive and renaming the file "boot.ini.bak" to "boot.ini".  (NOTE:  Do not remove the file "boot.ini" until you have verified that the file "boot.ini.bak" exists.)'
      ${If} ${IsWinXP}
        GetVersion::WindowsServicePack
        Pop $6
        ${If} $6 == "Service Pack 1"
          Return                          ;Can't patch SP1
        ${EndIf}
        StrCpy $6 "  Whenever you restart your system, you will need to select the 3GB option for these changes to be in effect."
      ${EndIf}
    ${EndIf}
    StrCpy $2 "If you allow the installer to make this change and later find your system has become unstable, you can undo this change by $3.  For this change to take effect, you will have to reboot your computer after the NAM installation.$6$\r$\n$\n"
    StrCpy $4 "If you don't approve this operation now, you will have to uninstall and reinstall the NAM in order to get this prompt again.$\r$\n$\nDo you want to make this change?"*/
  ${EndIf}
  StrCpy $8 '$2$4'
  ${If} $WindowsArchitecture = 64
    StrCpy $9 $8
  ${EndIf}
  StrCpy $0 'In order to provide improved stability and functionality, the NAM installer needs to set a flag in your copy of SimCity 4 that will allow it to use up to $1 GB of virtual memory.  (This is different from physical memory, and may be more or less than the amount of your installed physical memory.)  $9'
  ${If} $WindowsArchitecture = 64
  ${AndIf} $Memory > 1500
    MessageBox MB_OKCANCEL|MB_ICONINFORMATION "$0" IDOK CheckAccountType
    Quit
  /*${ElseIf} $WindowsArchitecture = 32
  ${AndIf} $Memory > 2000
    MessageBox MB_OK|MB_ICONEXCLAMATION "$0"
    MessageBox MB_YESNO|MB_ICONEXCLAMATION "$8" IDYES CheckAccountType
    Return*/
  ${EndIf}
CheckAccountType:
  UserInfo::GetAccountType
  Pop $1
  ${If} $1 != "Admin"
    MessageBox MB_OK|MB_ICONSTOP|MB_DEFBUTTON2 'Your account does not have the access necessary to perform the needed operations.  In order to allow the NAM installer to perform these operations and install the NAM in the proper place for your account, you need to do the following:$\r$\n$\n1. Log into an account with administrator priviliges.$\r$\n2. Give administrative privileges to this account.$\r$\n3. Log back into this account and run the NAM installer.$\r$\n$\nAfter that, you may remove the administrative priviliges from this account if you want.'
;  Alternatively, you can just proceed with the NAM installation now and not make the stability and functionality patches.  If you wish to make the later, you will need to run the NAM uninstaller and then run the NAM installer again.$\r$\n\nDo you want to continue with the installation without making the stability and functionality improvements?  (WARNING:  If you say "Yes", this may result in occasional crashes or freezes of your game.)'  IDNO +2
;        Return
;        MessageBox MB_OK|MB_ICONINFORMATION "The NAM installer will now exit.  Please add administrative privileges to the current account and restart the NAM installer from this account."
    Quit
  ${EndIf}
Retry4GB:
  ClearErrors
  ExecWait '"$NAMAuxDir\Tools\4gb_patch.exe" $SC4Exec' $0
  IfErrors 0 Check4GB
Error4GB:
    MessageBox MB_ABORTRETRYIGNORE|MB_ICONEXCLAMATION 'The NAM installer was unable to patch your SimCity 4 executable file.  This can happen if the game is currently running.  If that is the case, please exit the game and select "Retry".  Otherwise, select "Abort" to abort the installation, or select "Ignore", and the NAM installation will continue without the patch.' IDRETRY Retry4GB IDIGNORE PatchFailed
    Quit
PatchFailed:
  WriteRegDWORD HKLM "Software\Maxis\SimCity 4" "Large Address Aware" 2
  Return
Check4GB:
  ${If} $0 != 0
    Goto Error4GB
  ${EndIf}
  ${If} $WindowsArchitecture = 64
  ${OrIf} $Wine = 1
    WriteRegDWORD HKLM "Software\Maxis\SimCity 4" "Large Address Aware" 1
    Return                          ;We're done
  ${EndIf}
  /*
  ${If} ${AtLeastWinVista}
    ExecWait '"bcdedit.exe" /set IncreaseUserVA 3072' $0
    IfErrors 0 Check32
Error32:
    MessageBox MB_OKCANCEL|MB_ICONEXCLAMATION 'The NAM installer was unable to make a necessary change to a system file.  As a result, it was not possible to complete the change that provides improved stability and functionality when using the NAM.  It is recommended that you install a 64-bit version of Windows, where the improved stability and functionality will be available.  For now, you can continue with the NAM installation by selecting "OK", or you can terminate it by selecting "Cancel".' IDOK PatchFailed
    Quit
Check32:
    ${If} $0 != 0
      Goto Error32
    ${EndIf}
  ${Else}                         ;Windows 2000 or XP
    StrCpy $0 $WINDIR 3
    StrCpy $1 "$0\boot.ini"
    IfFileExists $1 NewBoot
      MessageBox MB_OK|MB_ICONEXCLAMATION "The NAM installer needs to make a slight change to the file boot.ini, which is normally in the root directory of your boot drive.  However, the NAM installer cannot find this file where it expects it.  In the following dialog box, please select your system's boot.ini file.  NOTE:  Boot.ini is a hidden system file."
OpenBoot:
      Dialogs::Open "All files(*.*)|*.*|Ini file (*.ini)|*.ini|" 2 "Select your system's boot.ini file" $1 ${VAR_2}
      ${If} $2 == ""
        MessageBox MB_YESNO|MB_ICONQUESTION "Do you want to cancel the remainder of the patch?" IDNO OpenBoot IDYES Error32
      ${EndIf}
      StrCpy $1 $2
NewBoot:
    StrCpy $2 "$1.SC4"
    ClearErrors
    FileOpen $0 $2 w
    IfErrors Error32
    ClearErrors
    FileOpen $3 $1 r
    IfErrors Error32
    ${Do}
      FileRead $3 $4
      FileWrite $0 $4
      StrCpy $5 $4 8
    ${LoopUntil} $5 == "default="
    StrCpy $6 $4 "" 8
    StrLen $7 $6
    IntOp $7 $7 - 2           ;Truncate CRLF
    StrCpy $6 $6 $7
    ${Do}
      ClearErrors
      FileRead $3 $4
     IfErrors 0 CheckLine
        ${Break}
CheckLine:
      StrCpy $8 $4 $7
      ${If} $8 == $6
        ${StrStr} $9 $4 "/3GB"
        ${If} $9 != ""
          FileClose $0
          FileClose $3
          Delete $2
          WriteRegDWORD HKLM "Software\Maxis\SimCity 4" "Large Address Aware" 1
          Return
        ${EndIf}
        StrLen $9 $4
        IntOp $9 $9 - 2
        StrCpy $4 $4 $9
        StrCpy $4 "$4 /3GB$\r$\n"
      ${EndIf}
      FileWrite $0 $4
    ${Loop}
    FileClose $0
    FileClose $3
    Delete "$1.bak"
    Rename $1 "$1.bak"
    Rename $2 $1
    SetFileAttributes $1 ARCHIVE|HIDDEN|SYSTEM|READONLY
	
  ${EndIf}*/
  WriteRegDWORD HKLM "Software\Maxis\SimCity 4" "Large Address Aware" 1
FunctionEnd

/*
 * !_ SetComponentState _!
 *
 * As indicated later on, this macro forms the heart of the GetOldComponents() function.  The main
 * macro is really just a shell that calls SetComponent() after setting up its arguments properly.
 * In general, there's no need to understand how this macro and function work; you just need to know
 * what arguments to provide in the macro invocation.  So here are the arguments:
 *
 * filename - This is the last part of the filename that specifies the location of the file in the
 *   user's directoy.  The root directory is presumed to be the main NAM directory, unless the
 *   variable $LastLoadDir is set to 1, in which case the root directory is presumend to be z___NAM.
 *   Note that since the directories specified in the Sections for the file are its source direc-
 *   tories, and this macro uses a destination directory, you typically can't just copy the direc-
 *   tory and filename from the "File" command and use it here.  Doing so is the biggest source of
 *   errors in using this routine.  Instead, you must construct the file and path names from a
 *   combination of the names used in the "SetOutPath" and "File" commands.  Note that this argument
 *   may be either the name of an individual file or the name of an entire directory; which one is
 *   used depends on which one is required to uniquely identify the Section to which the file or
 *   directory belongs.
 * item - This is the section index of the section to which the component beloongs, expressed as a
 *   variable, e.g. ${sec19}.
 * level - This number defines the InstType levels for which this component is used.  If the current
 *   Installation Type is less than this number, the component will not be installed.
 * dir - This argument is set to 0 if the first argument is a filename, and 1 if it is a directory.
 * first_version - This is the number of the first NAM version in which this component appears.  It
 *   allows the component to be set properly on NAM upgrades.
 * plugins - This argument is normally set to 0, but is set to 1 if the component originally
 *   appeared in the Plugins folder of NAM versions before NAM 31.  It helps the installer look for
 *   the file.
 */
!macro _SetComponentState filename item level dir first_version plugins
  ${If} $MonolithicNAM = 0
  ${AndIf} ${plugins} = 1
    ${StrStr} $0 "${filename}" "\"
    ${If} $0 != ""
      StrCpy $0 "Plugins$0"
    ${EndIf}
  ${Else}
    StrCpy $0 "${filename}"
  ${EndIf}
  ${If} $LastLoadDir = 1
    StrCpy $0 "$z___NAM\$0"
  ${Else}
    StrCpy $0 "$INSTDIR\$0"
  ${EndIf}
  StrCpy $1 ${item}
  StrCpy $2 ${level}
  StrCpy $3 ${dir}
  StrCpy $4 ${first_version}
  Call SetComponent
!macroend

!define SetComponentState `!insertmacro _SetComponentState`

Function SetComponent
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_MINIMAL}
    ${If} $2 > 1
      Goto Set2
    ${Else}
      Goto CheckDir
    ${EndIf}
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_STANDARD}
    ${If} $2 > 2
      Goto Set2
    ${Else}
      Goto CheckDir
    ${EndIf}
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_COMPLETE}
    ${If} $2 > 3
      Goto Set2
    ${Else}
      Goto CheckDir
    ${EndIf}
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_CUSTOM}
CheckDir:
    Math::Script "r5 = ( $4 - $NAMOldVersion ) * 10"
    ${If} $NewNAM > 0
    ${AndIf} $5 > 0
      !insertmacro SelectSection $1
      Return
    ${EndIf}
    ${If} $3 = 1
      ${DirState} $0 $9
      ${If} $9 < 1
        Goto Set1
      ${EndIf}
    ${Else}
      IfFileExists $0 0 Set1
    ${EndIf}
    !insertmacro SelectSection $1
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  Return
Set1:
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_CUSTOM}
Set2:
    ${If} $3 = 1
      RMDir /r $3
    ${Else}
      RMDir /r $3\..
    ${EndIf}
    !insertmacro UnselectSection $1
  !insertmacro UMUI_ENDIF_INSTALLFLAG
FunctionEnd

!macro SetRHWComponentState level
!if ${level} < 3
  ${SetComponentState} "Real Highway Mod\L${level}\RealHighway_L${level}_RHW-2.dat" ${rhw${level}0} 2 0 32 0
  ${SetComponentState} "Real Highway Mod\L${level}\RealHighway_L${level}_RHW-3.dat" ${rhw${level}1} 2 0 32 0
!endif
  ${SetComponentState} "Real Highway Mod\L${level}\RealHighway_L${level}_MIS.dat" ${rhw${level}2} 2 0 32 0
  ${SetComponentState} "Real Highway Mod\L${level}\RealHighway_L${level}_RHW-4.dat" ${rhw${level}3} 2 0 32 0
  ${SetComponentState} "Real Highway Mod\L${level}\RealHighway_L${level}_RHW-6S.dat" ${rhw${level}4} 2 0 32 0
!if ${level} < 3
  ${SetComponentState} "Real Highway Mod\L${level}\RealHighway_L${level}_RHW-8S.dat" ${rhw${level}5} 2 0 32 0
  ${SetComponentState} "Real Highway Mod\L${level}\RealHighway_L${level}_RHW-10S.dat" ${rhw${level}6} 2 0 32 0
  ${SetComponentState} "Real Highway Mod\L${level}\RealHighway_L${level}_RHW-6C.dat" ${rhw${level}7} 2 0 32 0
  ${SetComponentState} "Real Highway Mod\L${level}\RealHighway_L${level}_RHW-8C.dat" ${rhw${level}8} 2 0 32 0
!endif
!macroend

/*
 * !_ GetOldComponents _!
 *
 * This is one of the most important functions in the entire installer.  Its purpose is to determine
 * which (if any) NAM components the user has already installed, and set the selection state of
 * these components to what the user already has.  (Note that the "Networks and Traffic Simulator"
 * and "Complete Installation" options will always select their default options, regardless of
 * whether or not the user had them selected.  However, if the user had additional options in these
 * categories selected, these additional options will be preserved.)
 *
 * This function is organized in the same order as the Sections, which in turn determine the order
 * of options on the Components page, with just a few necessary exceptions at the beginning and end.
 * For ease of use, this order should be maintained.
 *
 * The main part of this function consists of repeated invocations of the macro SetComponentState.
 * In general, there is one invocation of SetComponentState for every section.  !_ Any time a new
 * section is added, a corresponding invocation of SetComponentState must be added in the appropri-
 * ate location of this function in order for the installer to be able to set the state of this
 * component based on the user's current installation. _!  For more information on the usage of
 * SetComponentState, please see its definition above (which is actually _SetComponentState).
 */
Function GetOldComponents
  ${If} $MonolithicNAM = 0
    !insertmacro UnselectSection ${elrail_alt2}
    !insertmacro UnselectSection ${elrail_alt3}
    !insertmacro UnselectSection ${elrail_alt4}
    !insertmacro UnselectSection ${elrail_alt5}
  ${EndIf}
  Call CreateInstDir
  IfErrors 0 +2
    Quit
  ${If} $OldInstallDir != ""
  ${AndIf} $OldInstallDir != $INSTDIR
    CopyFiles $OldInstallDir\* $INSTDIR
    RMDir /r $OldInstallDir
  ${EndIf}
  StrCpy $OldInstallDir $INSTDIR
  ${If} $0 = 1
    IfFileExists "$INSTDIR\NetworkAddonMod_Controller_*_e-series.dat" 0 +3
      StrCpy $Eseries 1
      StrCpy $Sseries 0
    SectionSetText ${sec3} "Traffic Driving Side (Usually shouldn't be changed)"
    !insertmacro ClearSectionFlag ${sec3} ${SF_EXPAND}
    ${SetComponentState} "NetworkAddonMod_Controller_RIGHT_HAND_VERSION.dat" ${controller1} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Controller_LEFT_HAND_VERSION.dat" ${controller2} 1 0 0 0
    ${If} ${SectionIsSelected} ${controller1}
    ${AndIf} $bRight = 0
      StrCpy $bRight 1
    ${ElseIf} ${SectionIsSelected} ${controller2}
    ${AndIf} $bRight = 1
      StrCpy $bRight 0
    ${EndIf}
    ${SetComponentState} "NetworkAddonMod_Traffic_Plugin_Z_Classic.dat" ${capa1} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Traffic_Plugin_Z_Low.dat" ${capa2} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Traffic_Plugin_Z_Medium.dat" ${capa3} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Traffic_Plugin_Z_High.dat" ${capa4} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Traffic_Plugin_Z_Ultra.dat" ${capa5} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Traffic_Plugin_Z_*_Custom.dat" ${capa6} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Zone_Data_View.dat" ${sec16} 1 0 0 0
    IfFileExists "$INSTDIR\NetworkAddonMod_Automata_Plugin_*_Persist.dat" 0 Automata
      !insertmacro SelectSection ${auto0}
Automata:
    ${SetComponentState} "NetworkAddonMod_Automata_Plugin_Standard*.dat" ${auto1} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Automata_Plugin_Automata24*.dat" ${auto2} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Automata_Plugin_Radical*.dat" ${auto3} 1 0 0 0
    ${SetComponentState} "NetworkAddonMod_Automata_Plugin_Radical_Automata24*.dat" ${auto4} 1 0 0 0
    ${If} ${SectionIsSelected} ${auto4}
      !insertmacro UnselectSection ${auto3}
    ${EndIf}
    StrCpy $LastLoadDir 1
    ${SetComponentState} "Shinkansen Bullet Train Mod" ${btm1} 2 1 0 0
    ${SetComponentState} "Shinkansen Bullet Train Mod\ML Shinkansen MOD ground texture.dat" ${btm2} 2 0 0 0
    ${SetComponentState} "Shinkansen Bullet Train Mod\z ML Shinkansen MOD concrete texture.dat" ${btm3} 2 0 0 0
    ${SetComponentState} "Shinkansen Bullet Train Mod\ML Shinkansen MOD Fence.dat" ${btm4} 2 0 0 0
    ${SetComponentState} "Shinkansen Bullet Train Mod\N700 series Shinkansen.dat" ${btm5} 2 0 0 0
    StrCpy $LastLoadDir 0
    ${SetComponentState} "Canal Addon Mod\NetworkAddonMod_CanAM_Props_SG.dat" ${can1} 2 0 0 1
    ${SetComponentState} "Canal Addon Mod\NetworkAddonMod_CanAM_Props_CAL.dat" ${can2} 2 0 0 1
    ${SetComponentState} "Diagonal Streets\NetworkAddonMod_Diagonal_Streets_Plugin.dat" ${plugin2} 2 0 0 1
	${SetComponentState} "INRUL Overides\NetworkAddonMod_Diagonal_Streets_Plugin_INRULs" ${plugin2} 2 0 0 1
    ${SetComponentState} "High Elevated Monorail\NetworkAddonMod_High_Monorail_Plugin.dat" ${plugin6} 2 0 0 1
    ${SetComponentState} "El Rail\El Rail over Avenue Networks" ${elrail2a} 2 1 32 0
    ${If} $MonolithicNAM = 1
      ${SetComponentState} "El Rail\El Rail over Road Networks" ${elrail2} 2 1 0 0
    ${Else}
      ${SetComponentState} "Plugins\NetworkAddonMod_Light_URail_Puzzle_Plugin.dat" ${elrail2} 2 0 0 0
    ${EndIf}
    ${SetComponentState} "El Rail\NetworkAddonMod_High_ElRail_Plugin.dat" ${elrail3} 2 0 0 1
    ${SetComponentState} "Elevated Road Networks\NetworkAddonMod_RoadViaducts_Draggable.dat" ${elroadnet1} 2 0 32 0
    ${If} $MonolithicNAM = 0
      ${SetComponentState} "NetworkAddonMod3.dat" ${elroadnet2} 2 0 0 0
    ${Else}
      ${SetComponentState} "NetworkAddonMod_RoadViaducts.dat" ${elroadnet2} 2 0 0 0
      ${IfNot} ${SectionIsSelected} ${elroadnet2}
        ${SetComponentState} "Elevated Road Networks\NetworkAddonMod_RoadViaducts.dat" ${elroadnet2} 2 0 0 0
      ${EndIf}
    ${EndIf}
    ${SetComponentState} "Flexible Underpasses\NetworkAddonMod_FLUPs_Plugin.dat" ${plugin8} 2 0 0 1
    ${SetComponentState} "Fractionally Angled Networks\*_Roads.dat" ${fan1} 2 0 31 0
    ${SetComponentState} "Fractionally Angled Networks\*_Rails.dat" ${fan2} 2 0 31 0
    ${SetComponentState} "Fractionally Angled Networks\*draggable*.dat" ${fan3} 2 0 31 0
	${SetComponentState} "INRUL Overrides\NetworkAddonMod_FAN_WRC_INRULs.dat" ${fan3} 2 0 31 0
    ${SetComponentState} "Ground Light Rail\NetworkAddonMod_GroundLightRail_Plugin.dat" ${tram1} 2 0 0 1
	${SetComponentState} "INRUL Overrides\NetworkAddonMod_GroundLightRail_Plugin_INRULs.dat" ${tram1} 2 0 0 1
    ${If} $MonolithicNAM = 1
      ${SetComponentState} "Ground Light Rail\NetworkAddonMod_GroundLightRailxAvenue_Plugin.dat" ${tram2} 2 0 0 0
    ${Else}
      ${SetComponentState} "Ground Light Rail\NetworkAddonMod_GroundLightRail_Plugin.dat" ${tram2} 2 0 0 1
    ${EndIf}
    ${SetComponentState} "Ground Light Rail\NetworkAddonMod_GroundLightRailxRoad_Plugin.dat" ${tram3} 2 0 0 1
    ${SetComponentState} "Ground Light Rail\NetworkAddonMod_GroundLightRailxStreet_Plugin.dat" ${tram4} 2 0 0 1
    ${SetComponentState} "Ground Light Rail\NetworkAddonMod_GroundLightRailDrag_Extension.dat" ${tram5} 2 0 0 1
    ${SetComponentState} "High Speed Rail Project" ${sec30} 2 1 31 0
    StrCpy $LastLoadDir 1
    ${SetComponentState} "Maxis Highway Override" ${sec23} 2 1 0 0
    StrCpy $LastLoadDir 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_TLA-3.dat" ${nwm1} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_AVE-2.dat" ${nwm2} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_ARD-3.dat" ${nwm3} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_OWR-1.dat" ${nwm4} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_OWR-3.dat" ${nwm5} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_NRD-4.dat" ${nwm6} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_TLA-5.dat" ${nwm7} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_OWR-4.dat" ${nwm8} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_OWR-5.dat" ${nwm9} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_RD-4.dat" ${nwm10} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_RD-6.dat" ${nwm11} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_TripleTile.dat" ${nwm12} 2 0 31 0
    ${SetComponentState} "Network Widening Mod\NetworkWideningMod_LegacyPuzzleWealthing.dat" ${nwmgroup2} 2 0 31 0
    ${If} $MonolithicNAM = 0
      ${SetComponentState} "NetworkAddonMod5.dat" ${sec28} 2 0 0 0
    ${Else}
      ${SetComponentState} "NetworkAddonMod_PedMalls.dat" ${sec28} 2 0 0 0
    ${EndIf}
    ${If} $MonolithicNAM = 1
      ${SetComponentState} "Rail\Underground Rail" ${rail5} 2 1 0 0
    ${Else}
      ${SetComponentState} "Plugins\NetworkAddonMod_Light_URail_Puzzle_Plugin.dat" ${rail5} 2 0 0 0
    ${EndIf}
    ${If} $MonolithicNAM = 0
      ${SetComponentState} "NetworkAddonMod2.dat" ${rail6} 2 0 0 0
    ${Else}
      ${SetComponentState} "NetworkAddonMod_RailViaducts.dat" ${rail6} 2 0 0 0
      ${IfNot} ${SectionIsSelected} ${rail6}
        ${SetComponentState} "Rail\NetworkAddonMod_RailViaducts.dat" ${rail6} 2 0 0 0
      ${EndIf}
    ${EndIf}
    ${SetComponentState} "Railway Addon Mod\RailroadAddonMod_STR.dat" ${rail2} 2 0 31 0
    ${IfNot} ${SectionIsSelected} ${rail2}
      ${SetComponentState} "Rail\Railway Addon Mod\RailroadAddonMod_Viaducts.dat" ${rail2} 2 0 31 0
    ${EndIf}
    ${SetComponentState} "Rail\RealRailway" ${rail1} 2 1 0 0
	${SetComponentState} "INRUL Overrides\RealRailway_Core_INRULs.dat" ${rail1} 2 1 0 0
    Math::Script "r0 = ( 32 - $NAMOldVersion ) * 10"
    ${If} $NewNAM > 0
    ${AndIf} $0 > 0
      ${SetComponentState} "Real Highway Mod\RealHighway_Core.dat" ${sec19} 2 0 31 0
      ${If} $Sseries = 1
        !insertmacro UnselectSection ${rhw3}
        !insertmacro UnselectSection ${rhw4}
      ${EndIf}
    ${Else}
      !insertmacro SetRHWComponentState 0
      !insertmacro SetRHWComponentState 1
      !insertmacro SetRHWComponentState 2
      !insertmacro SetRHWComponentState 3
      !insertmacro SetRHWComponentState 4
      ${SetComponentState} "Real Highway Mod\DDRHW\RealHighway_DD_RHW-4.dat" ${rhw53} 2 0 31 0
    ${EndIf}
    ${SetComponentState} "Rural Roads Plugin" ${rurp1} 2 1 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 1 *.dat" ${sam1} 2 0 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 2 *.dat" ${sam2} 2 0 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 3 *.dat" ${sam3} 2 0 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 4 *.dat" ${sam4} 2 0 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 5 *.dat" ${sam5} 2 0 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 6 *.dat" ${sam6} 2 0 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 7 *.dat" ${sam7} 2 0 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 8 *.dat" ${sam8} 2 0 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 9 *.dat" ${sam9} 2 0 31 0
    ${SetComponentState} "Street Addon Mod\Textures\SAM - 10 *.dat" ${sam10} 2 0 31 0
	${SetComponentState} "Street Addon Mod\Textures\SAM - 11 *.dat" ${sam11} 2 0 36 0
    StrCpy $LastLoadDir 1
    ${SetComponentState} "Mass Transit Lots\Maxis Airports - Medium.dat" ${air2} 1 0 31 0
    ${SetComponentState} "Mass Transit Lots\Maxis Airports - Large.dat" ${air3} 1 0 31 0
    ${IfNot} ${SectionIsSelected} ${air2}
    ${AndIfNot} ${SectionIsSelected} ${air3}
      !insertmacro SelectSection ${air1}
    ${EndIf}
    ${SetComponentState} "Mass Transit Lots\Elevated Road Stations\BriPizza Elevated Road Stop.dat" ${brt1} 2 0 0 0
    ${IfNot} ${SectionIsSelected} ${brt1}
      ${SetComponentState} "Mass Transit Lots\Bus Rapid Transit Stations\BriPizza Elevated Road Stop.dat" ${brt1} 2 0 31 0
    ${EndIf}
;    ${SetComponentState} "Mass Transit Lots\Bus Rapid Transit Stations\Modern Arched Bus Rapid Transit Station.SC4Lot" ${brt2} 2 0 32 0
    ${SetComponentState} "Mass Transit Lots\Bus Rapid Transit Stations\Overhanging Elevated Road Station.SC4Lot" ${brt3} 2 0 31.1 0
    ${SetComponentState} "Mass Transit Lots\Bus Rapid Transit Stations\Bus Filter for L0 RHW-2.SC4Lot" ${brt_filter0} 2 0 32 0
    ${SetComponentState} "Mass Transit Lots\Bus Rapid Transit Stations\Bus Filter for L1 RHW-2.SC4Lot" ${brt_filter1} 2 0 32 0
    ${SetComponentState} "Mass Transit Lots\Bus Rapid Transit Stations\Bus Filter for L2 RHW-2.SC4Lot" ${brt_filter2} 2 0 32 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\El Rail Station with Bus and Subway.SC4Lot" ${eltrain0a} 2 0 32 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\Victorian El Rail Station Orthogonal.dat" ${eltrain0} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\Victorian El Rail Station Diagonal.dat" ${eltrain1} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\Modern El Train Station" ${eltrain2} 2 1 31 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\Overhanging El Rail Station.SC4Lot" ${eltrain2a} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\Diagonal El-Rail Station_77abc775.SC4Lot" ${eltrain3} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\Morifari Straight El Rail Station.SC4Lot" ${eltrain4} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\Morifari Diagonal El Rail Station.SC4Lot" ${eltrain5} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\Double Height Light Rail Station.SC4Lot" ${eltrain6} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\El Rail over Road\Morgan-Lake Station"  ${elrailave1} 2 1 32 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\El Rail over Road\CTA Madison-Wells Station"  ${elrailroad1} 2 1 31 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\El Rail over Road\CTA Ashland Station"  ${elrailroad2} 2 1 0 0
    ${SetComponentState} "Mass Transit Lots\El Rail Stations\El Rail over Road\Overhanging El Rail over Road Station"  ${elrailroad3} 2 1 31 0
    ${SetComponentState} "Mass Transit Lots\GLR and Tram Stations\GLR orthogonal Dentei station_b597d5b9.SC4Lot" ${glr1} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\GLR and Tram Stations\GLR diagonal Dentei station_b597d62a.SC4Lot" ${glr2} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\GLR and Tram Stations\NDEX_Brenda_Xne_MGLRBS_Station_11a105f9.SC4Lot" ${glr3} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\GLR and Tram Stations\TramAve 2x2 orthogonal Dentei station_9545f6eb.SC4Lot" ${tram_station1} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\GLR and Tram Stations\TramAve 2x3 diagonal Dentei station_1541eca0.SC4Lot" ${tram_station2} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\GLR and Tram Stations\TramRoad1x1stop_d67e1351.SC4Lot" ${tram_station3} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\GLR and Tram Stations\TramRoad1x2stop_d67e1686.SC4Lot" ${tram_station4} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\GLR and Tram Stations\TramRoad1x3stop_d67e18c7.SC4Lot" ${tram_station5} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\GLR and Tram Stations\SFBT_TramStreet_Stop.dat" ${tram_station6} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\High Speed Rail Stations\Modern Arched HSR Station" ${hsr1} 2 1 31 0
    ${SetComponentState} "Mass Transit Lots\High Speed Rail Stations\Modern Arched GHSR Station" ${hsr2} 2 1 31 0
    ${SetComponentState} "Mass Transit Lots\High Speed Rail Stations\Morifari Straight HSR Station.SC4Lot" ${hsr3} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\High Speed Rail Stations\Modern Arched GHSR Station" ${hsr3} 2 1 31.1 0
    ${SetComponentState} "Mass Transit Lots\High Speed Rail Stations\Overhanging HSR Station.SC4Lot" ${hsr4} 2 0 31.1 0
    ${SetComponentState} "Mass Transit Lots\High Speed Rail Stations\Morifari Straight HSR Station.SC4Lot" ${hsr5} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\High Speed Rail Stations\HSRP Transit Hub" ${hsr6} 2 1 31 0
    ${SetComponentState} "Mass Transit Lots\Monorail Stations\Modern Monorail and Bullet Train Station" ${monorail0} 2 1 31 0
    ${SetComponentState} "Mass Transit Lots\Monorail Stations\Overhanging Monorail Station.SC4Lot" ${monorail1} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\Monorail Stations\Diagonal Monorail BTM Station_77abd579.SC4Lot" ${monorail2} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\Monorail Stations\Double Height Monorial or BTM Station.SC4Lot" ${monorail3} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\Monorail Stations\Japanese Bullet Train Station" ${monorail4} 2 1 0 0
    ${SetComponentState} "Mass Transit Lots\Monorail Stations\Morifari Straight Monorail Station.SC4Lot" ${monorail5} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\Monorail Stations\Morifari Diagonal Monorail Station.SC4Lot" ${monorail6} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\Multi-Purpose Stations\BriPizza 15m Station\Utils3x1_NEnamLRStaV1_33d321b7.SC4Lot" ${multi1} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\Multi-Purpose Stations\BriPizza 15m Station\Utils3x1_ENnamRailSta---Overhead_V2_13d2bd58.SC4Lot" ${multi2} 2 0 32 0
   ${SetComponentState} "Mass Transit Lots\Multi-Purpose Stations\BriPizza Arched Station.dat" ${multi3} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\Multi-Purpose Stations\BriPizza 0m-15m Multi-Purpose Station.dat" ${multi4} 2 0 31.2 0
    ${SetComponentState} "Mass Transit Lots\Multi-Purpose Stations\BriPizza 15m-30m Multi-Purpose Station.dat" ${multi5} 2 0 31.2 0
    ${SetComponentState} "Mass Transit Lots\Multi-Purpose Stations\BriPizza Norikae Station.dat" ${multi6} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\Multi-Purpose Stations\Ninja Boulevard Kiosk and Station\*Kiosk*.*" ${multi7} 2 0 31.2 0
    ${SetComponentState} "Mass Transit Lots\Multi-Purpose Stations\Ninja Boulevard Kiosk and Station\*Station*.*" ${multi8} 2 0 31.2 0
    ${SetComponentState} "Mass Transit Lots\Tram Transitions\SFBT_Subway-Tram_Transition.SC4Lot" ${transition0} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\Tram Transitions\RTMT_Tram_in_Avenue_to_Underground.SC4Lot" ${transition1} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\ESURE" ${transition2} 2 1 31 0
    ${SetComponentState} "Mass Transit Lots\Rail Stations\Modern Arched Rail Station.SC4Lot" ${rail_station1} 2 0 31.1 0
    ${SetComponentState} "Mass Transit Lots\Rail Stations\Modern Viaduct Rail Station.SC4Lot" ${viaduct_rail0} 2 0 31.1 0
    ${SetComponentState} "Mass Transit Lots\Rail Stations\Overhanging Viaduct Rail Station.SC4Lot" ${viaduct_rail1} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\Rail Stations\Diagonal Viaduct Rail Station.SC4Lot" ${viaduct_rail2} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\Rail Stations\morifari_Viaduct_Rail_Station_orthogonal.SC4Lot" ${viaduct_rail3} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\Rail Stations\morifari_Viaduct_Rail_Station_diagonal.SC4Lot" ${viaduct_rail4} 2 0 31 0
    ${SetComponentState} "Mass Transit Lots\Rail Stations\Morifari Straight Viaduct Rail Station.SC4Lot" ${viaduct_rail5} 2 0 0 0
    ${SetComponentState} "Mass Transit Lots\Rail Stations\Morifari Diagonal Viaduct Rail Station.SC4Lot" ${viaduct_rail6} 2 0 0 0
    StrCpy $LastLoadDir 0
    ${SetComponentState} "Additional Bridges\NetworkAddonMod_Additional_Bridges_Plugin.dat" ${bridge1} 2 0 0 1
    ${SetComponentState} "Additional Bridges\Avenue Bridges\NetworkAddonMod_Pont_AlexandreIII.dat" ${avenue_bridge1} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Avenue Bridges\NetworkAddonMod_Millau_Viaduct.dat" ${avenue_bridge2} 2 0 31 0
    ${SetComponentState} "Additional Bridges\El Rail Bridges\NetworkAddonMod_Concrete_El-Rail_Bridge.dat" ${elrail_bridge1} 2 0 31 0
    ${SetComponentState} "Additional Bridges\El Rail Bridges\NetworkAddonMod_Undertruss_El-Rail_Bridge.dat" ${elrail_bridge2} 2 0 31 0
    ${SetComponentState} "Additional Bridges\El Rail Bridges\NetworkAddonMod_Cable_Stayed_El-Rail_Bridge.dat" ${elrail_bridge3} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Elevated Highway Bridges\NetworkAddonMod_Tsing_Ma_Bridge.dat" ${elhighway_bridge1} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Ground Highway Bridges\NetworkAddonMod_Akashi_Kaikyo_Bridge.dat" ${grndhighway_bridge1} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_HSR_Bridge.dat" ${hsr_bridge1} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_GHSR_Bridge.dat" ${hsr_bridge2} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Box_Girder_GHSR_Bridge.dat" ${hsr_bridge3} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Cable_Stayed_HSR_Bridge.dat" ${hsr_bridge4} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Cable_Stayed_GHSR_Bridge.dat" ${hsr_bridge5} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Concrete_HSR_Bridge.dat" ${hsr_bridge6} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_Concrete_GHSR_Bridge.dat" ${hsr_bridge7} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_High_Speed_Rail_Suspension_Bridge.dat" ${hsr_bridge8} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_LatticeGrid_HSR_Bridge.dat" ${hsr_bridge9} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_ThruTruss_GHSR_Bridge.dat" ${hsr_bridge10} 2 0 31 0
    ${SetComponentState} "Additional Bridges\High Speed Rail Bridges\NetworkAddonMod_HSR_Bridge_Fence_Props.dat" ${hsr_bridge11} 2 0 32 0
    ${SetComponentState} "Additional Bridges\Monorail Bridges\NetworkAddonMod_AITPier_Monorail_Bridge.dat" ${monorail_bridge1} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Monorail Bridges\NetworkAddonMod_Cable_Stayed_Monorail_Bridge.dat" ${monorail_bridge2} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Monorail Bridges\NetworkAddonMod_Monorail_Suspension_Bridge.dat" ${monorail_bridge3} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Monorail Bridges\NetworkAddonMod_YPier_Monorail_Bridge.dat" ${monorail_bridge4} 2 0 31 0
	${SetComponentState} "Additional Bridges\Network Widening Mod Bridges\NetworkAddonMod_RD4_Bridge.dat" ${nwm_bridge1} 2 0 34 0
	${SetComponentState} "Additional Bridges\Network Widening Mod Bridges\NetworkAddonMod_RD6_Bridge.dat" ${nwm_bridge2} 2 0 34 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\Goeltzschtalbruecke.dat" ${rail_bridge1} 2 0 32.1 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\JRJ Warzone Bridge" ${rail_bridge2} 2 1 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\NetworkAddonMod_Garabit_Rail_Bridge.dat" ${rail_bridge3} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\NetworkAddonMod_Howe_Truss_Bridge.dat" ${rail_bridge4} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\NetworkAddonMod_Howe_Truss_STR_Bridge.dat" ${rail_bridge5} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\NetworkAddonMod_Metal_Arch_Rail_Bridge.dat" ${rail_bridge6} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\NetworkAddonMod_Metal_Pylon_Rail_Bridge.dat" ${rail_bridge7} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\NetworkAddonMod_Modern_Rail_Bridge.dat" ${rail_bridge8} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\NetworkAddonMod_Plate_Girder_STR_Bridge.dat" ${rail_bridge9} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\Wooden Trestle STR Bridge" ${wooden_trestle_rail_bridge1} 2 1 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\Wooden Trestle STR Bridge\TS_Wooden_Trestle_STR_All_Wake.dat" ${wooden_trestle_rail_bridge2} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\Wooden Trestle STR Bridge\TS_Wooden_Trestle_STR_Alternating_Wake.dat" ${wooden_trestle_rail_bridge3} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\Royal_Albert_STR_Bridge.dat" ${rail_bridge11} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Railway Bridges\NetworkAddonMod_PvM_Garabit_Green_Rail_JRJ.dat" ${rail_bridge12} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-2_Concrete_Girder_Bridge.dat" ${rhw_bridge1} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-2_Small_Steel_Arch_Bridge.dat" ${rhw_bridge2} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Large_Steel_Arch_Bridge.dat" ${rhw_bridge3} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Steel_Girder_Bridge.dat" ${rhw_bridge4} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Steel_Girder_Bridge_Dual.dat" ${rhw_bridge5} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Steel_Girder_Bridge_Dual_2.dat" ${rhw_bridge5a} 2 0 31.1 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4_Suspension_Bridge_Compact.dat" ${rhw_bridge6} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-6S_Cable-Stayed_Bridge_Compact.dat" ${rhw_bridge7} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-6S_Concrete_Arch_Bridge.dat" ${rhw_bridge8} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-6S_Concrete_Arch_Bridge_Dual.dat" ${rhw_bridge9} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-6S_Steel_Arch_Bridge_Compact.dat" ${rhw_bridge10} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-8S_Undertruss_Bridge.dat" ${rhw_bridge11} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-10S_Cable_Stayed_Bridge.dat" ${rhw_bridge12} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-10S_Large_Concrete_Arch.dat" ${rhw_bridge13} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-MIS_Bridges.dat" ${rhw_bridge14} 2 0 31 0
	${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_DDRHW-4_Basic_Bridge" ${rhw_bridge15} 2 0 31 0
	${SetComponentState} "Additional Bridges\Real Highway Bridges\NetworkAddonMod_RHW-4S_Concrete_Arch_Bridge" ${rhw_bridge16} 2 0 34 0
    ${SetComponentState} "Additional Bridges\Road Bridges\NetworkAddonMod_Kwanyoni_Bridge.dat" ${road_bridge1} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Road Bridges\NetworkAddonMod_Dusktrooper_Road_Bridge.dat" ${road_bridge2} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Road Bridges\NetworkAddonMod_Tower_Bridge.dat" ${road_bridge3} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Road Bridges\NetworkAddonMod_Pont_Royal_Bridge.dat" ${road_bridge4} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Road Bridges\NetworkAddonMod_Pont_Saint_Michel_Bridge.dat" ${road_bridge5} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Road Bridges\JENX PARIS Pont Neuf\NetworkAddonMod_Pont_Neuf_Bridge_Road.dat" ${road_bridge6} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Road Bridges\NetworkAddonMod_Krummbach_Bridge.dat" ${road_bridge7} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Road Bridges\NetworkAddonMod_Old_Road_Bridge.dat" ${road_bridge8} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Road Bridges\PontSantAngelo.dat" ${road_bridge9} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Road Bridges\NetworkAddonMod_Wooden_Covered_Bridge.dat" ${road_bridge10} 2 0 31 0
	${SetComponentState} "Additional Bridges\Real Railway Bridges\NetworkAddonMod_RRW_1_Timber_Trestle.dat" ${rrw_bridge1} 2 1 34 0
	${SetComponentState} "Additional Bridges\Real Railway Bridges\NetworkAddonMod_RRW_2_Iron_Girder.dat" ${rrw_bridge2} 2 1 34 0
	${SetComponentState} "Additional Bridges\Real Railway Bridges\NetworkAddonMod_RRW_2_Steel_Overtruss.dat" ${rrw_bridge3} 2 1 34 0
	${SetComponentState} "Additional Bridges\Real Railway Bridges\NetworkAddonMod_RRW_2_Stone_Arch.dat" ${rrw_bridge4} 2 1 34 0
    ${SetComponentState} "Additional Bridges\NetworkAddonMod_Rural_Street_and_Rail_Bridge.dat" ${bridge11} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Street Addon Mod Bridges\Street Addon Mod Bridges.dat" ${bridge12} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Street Bridges\NetworkAddonMod_Concrete_Street_Bridge.dat" ${street_bridge1} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Street Bridges\Covered_Street_Bridge.dat" ${street_bridge2} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Street Bridges\JENX PARIS Pont Neuf\NetworkAddonMod_Pont_Neuf_Bridge_Street.dat" ${street_bridge3} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Street Bridges\Steel_Girder_Street_Bridge.dat" ${street_bridge4} 2 0 31 0
    ${SetComponentState} "Additional Bridges\Tram in Road Bridges\NetworkAddonMod_Pont_Notre_Dame_TIR.dat" ${TiR_bridge1} 2 0 31 0
    ${SetComponentState} "NetworkAddonMod_BridgeHeightMod.dat" ${bridge_height} 2 0 31 0
    ${SetComponentState} "Custom Menu Icon Layouts\NetworkAddonMod_Custom_Highway_Menu_Plugin_Optional.dat" ${menu1} 3 0 0 1
    ${SetComponentState} "Custom Menu Icon Layouts\NetworkAddonMod_Custom_Rail_Menu_Plugin_Optional.dat" ${menu2} 3 0 0 1
    ${SetComponentState} "Custom Menu Icon Layouts\NetworkAddonMod_Custom_Misc_Transport_Menu_Plugin_Optional.dat" ${menu3} 3 0 0 1
    StrCpy $LastLoadDir 1
    ${SetComponentState} "Mass Transit Lots\NetworkAddonMod_Queries_Standard.dat" ${sec31} 2 0 31 0
    ${IfNot} ${SectionIsSelected} ${sec31}
      ${SetComponentState} "Mass Transit Lots\NetworkAddonMod_Queries_Wide.dat" ${sec31} 2 0 31 0
    ${EndIf}
	${SetComponentState} "Cosmetic Addons\HighSpeedRail_vershner_texture.dat" ${hsr_tex} 2 0 33 0
    StrCpy $LastLoadDir 0
    ${SetComponentState} "Hole Diggers and Ground Raisers\Standard Lots" ${hole1} 3 1 31 0
    ${SetComponentState} "Hole Diggers and Ground Raisers\Auto-Destruct Lots" ${hole2} 3 1 31 0
    ${If} $MonolithicNAM = 0
      ${SetComponentState} "NetworkAddonMod4.dat" ${sec27} 3 0 0 0
    ${Else}
      ${SetComponentState} "NetworkAddonMod_HighwayInterchanges.dat" ${sec27} 3 0 0 0
    ${EndIf}
    ${SetComponentState} "Cosmetic Addons\NetworkAddonMod_OneWayRoad_Arrows_Reduction_Plugin.dat" ${arrow1} 3 0 0 1
	${SetComponentState} "INRUL Overrides\NetworkAddonMod_OneWayRoad_Arrows_Reduction_Plugin_INRULs.dat" ${arrow1} 3 0 0 1
    ${SetComponentState} "Cosmetic Addons\NetworkAddonMod_OneWayRoad_Arrows_Half_Reduction_Plugin.dat"  ${arrow2} 3 0 0 0
    ${SetComponentState} "Cosmetic Addons\NetworkAddonMod_OneWayRoad_Roundabout_Arrows_Reduction_Plugin.dat" ${arrow3} 3 0 0 1
    !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_CUSTOM}
      StrCpy $0 0
      ${IfThen} ${SectionIsSelected} ${arrow1} ${|} IntOp $0 $0 + 1 ${|}
      ${IfThen} ${SectionIsSelected} ${arrow2} ${|} IntOp $0 $0 + 1 ${|}
      ${IfThen} ${SectionIsSelected} ${arrow3} ${|} IntOp $0 $0 + 1 ${|}
      ${If} $0 = 3
        SectionSetFlags ${sec7} ${SF_SELECTED}
      ${ElseIf} $0 > 0
        SectionSetFlags ${sec7} ${SF_PSELECTED}
      ${EndIf}
    !insertmacro UMUI_ENDIF_INSTALLFLAG
    ${SetComponentState} "Rail Textures\SFBT_Rail Textures Mod_Darker Textures.dat" ${rail_texture1} 3 0 0 1
    ${SetComponentState} "Railway Addon Mod\zzz_Dual_Rail_Texture_Maxis_Upgrade.dat" ${rail_texture2} 3 0 0 0
    ${IfNot} ${SectionIsSelected} ${rail_texture1}
    ${AndIfNot} ${SectionIsSelected} ${rail_texture2}
      !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
        !insertmacro SelectSection ${rail_texture3}
      !insertmacro UMUI_ENDIF_INSTALLFLAG
    ${EndIf}
    ${SetComponentState} "Rail Textures\NetworkAddonMod_Rail_Viaduct_Style_Brown.dat" ${style2} 3 0 0 1
    ${SetComponentState} "Rail Textures\NetworkAddonMod_Rail_Viaduct_Style_Red.dat" ${style3} 3 0 0 1
    ${IfNot} ${SectionIsSelected} ${style2}
    ${AndIfNot} ${SectionIsSelected} ${style3}
      !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
        !insertmacro SelectSection ${style1}
      !insertmacro UMUI_ENDIF_INSTALLFLAG
    ${EndIf}
    ${SetComponentState} "Real Highway Mod\RealHighway_Regional_Transport_Map.dat" ${rhw_op1} 3 0 0 0
    StrCpy $LastLoadDir 1
    ${SetComponentState} "Cosmetic Addons\RHW Single Median Barriers" ${rhw_op2} 3 2 32 0
    ${SetComponentState} "Road Textures\Standard Retexture and Cosmetic Mod\NAM_Retexture_and_Cosmetic_Mod_Road.dat" ${road_texture2} 3 0 0 0
    ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod" ${road_texture3} 3 1 0 0
    ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod\NWM_v2_Euro_Textures_Mod\z5_NWM_Euro_TRM_RD-4_Aus.dat" ${road_texture4} 3 0 0 0
    ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod\NWM_v2_Euro_Textures_Mod\z3_NWM_Euro_TRM_RD-4_Hamburg.dat" ${road_texture5} 3 0 0 0
    ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod\NWM_v2_Euro_Textures_Mod\z4_NWM_Euro_TRM_RD-4_SSL.dat" ${road_texture6} 3 0 0 0
    ${IfNot} ${SectionIsSelected} ${road_texture2}
    ${AndIfNot} ${SectionIsSelected} ${road_texture3}
    ${AndIfNot} ${SectionIsSelected} ${road_texture4}
    ${AndIfNot} ${SectionIsSelected} ${road_texture5}
    ${AndIfNot} ${SectionIsSelected} ${road_texture6}
      !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_MINIMAL}
        Math::Script "r0 = ( $NAMOldVersion - 31 ) * 10)"
        ${If} $0 <= 0
          !insertmacro SelectSection ${road_texture2}
        ${Else}
          !insertmacro SelectSection ${road_texture1}
        ${EndIf}
      !insertmacro UMUI_ENDIF_INSTALLFLAG
    ${ElseIf} ${SectionIsSelected} ${road_texture3}
      ${If} ${SectionIsSelected} ${road_texture4}
      ${OrIf} ${SectionIsSelected} ${road_texture5}
      ${OrIf} ${SectionIsSelected} ${road_texture6}
        !insertmacro UnselectSection ${road_texture3}
      ${EndIf}
    ${EndIf}
    ${If} ${SectionIsSelected} ${road_texture1}
    ${OrIf} ${SectionIsSelected} ${road_texture2}
      ${SetComponentState} "Road Textures\zzzNAM_Retexture_and_Cosmetic_Mod_NYC_Intersections_Optional.dat" ${road_texture_option1b} 3 0 0 0
    ${Else}
      ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod\z1_NetworkAddonMod_TurningLanes_Extension_Plugin_EuroTRM_DexterUK.dat" ${tulep1} 3 0 0 0
      ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod\z1_NetworkAddonMod_TurningLanes_Extension_Plugin_EuroTRM_MRTNRLN.dat" ${tulep2} 3 0 0 0
      ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod\z2_Riiga_Euro_TuLEPs_Dashed.dat" ${tulep3} 3 0 0 0
      ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod\UK Old NAM TuLEPs" ${tulep4} 3 1 0 0
      ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod\z1_Dexter_UK_Textures.dat" ${road_texture_option2} 3 0 0 0
    ${EndIf}
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_AUS.dat" ${alt_arrow1} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_BE.dat" ${alt_arrow2} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_BRS.dat" ${alt_arrow3} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_CH.dat" ${alt_arrow4} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_DE.dat" ${alt_arrow5} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_DK.dat" ${alt_arrow6} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_FR.dat" ${alt_arrow7} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_IM.dat" ${alt_arrow8} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_NL.dat" ${alt_arrow9} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_Ontario.dat" ${alt_arrow10} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_RBU.dat" ${alt_arrow11} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_SE.dat" ${alt_arrow12} 3 0 0 0
    ${SetComponentState} "Road Textures\Shared_ArrowTextures_USA.dat" ${alt_arrow13} 3 0 0 0
    ${SetComponentState} "Road Textures\Standard Retexture and Cosmetic Mod\zzzNAM_Retexture_and_Cosmetic_Mod_Culdesac_Plugin_Superhands.dat" ${road_texture9} 3 0 0 0
    ${IfNot} ${SectionIsSelected} ${road_texture9}
      ${SetComponentState} "Road Textures\Euro Cosmetic Re-Texture Mod\z8_eurotexture_CulDeSac.dat" ${road_texture9} 3 0 0 0
    ${EndIf}
    ${SetComponentState} "Road Textures\zzzMHW_Retexture_*.dat" ${road_texture10} 3 0 0 0
    StrCpy $LastLoadDir 0
    ${SetComponentState} "Roundabouts\NetworkAddonMod_Roundabouts_Streets_Plugin.dat" ${round2} 3 0 0 1
	${SetComponentState} "INRUL Overrides\NetworkAddonMod_Roundabouts_Streets_x_draggable_FANs.dat" ${round2} 3 0 0 1
	${IfNot} ${SectionIsSelected} ${fan3}
      ${SetComponentState} "INRUL Overrides\NetworkAddonMod_Roundabouts_Streets_Plugin_INRULs.dat" ${round1} 3 0 0 1
    ${EndIf}
    ${SetComponentState} "Roundabouts\NetworkAddonMod_Roundabouts_Roads_Plugin.dat" ${round1} 3 0 0 1
	${SetComponentState} "INRUL Overrides\NetworkAddonMod_Roundabouts_Roads_x_draggable_FANs.dat" ${round1} 3 0 0 1
    ${IfNot} ${SectionIsSelected} ${fan3}
      ${SetComponentState} "INRUL Overrides\NetworkAddonMod_Roundabouts_Roads_Plugin_INRULs.dat" ${round1} 3 0 0 1
    ${EndIf}
    ${SetComponentState} "Roundabouts\NetworkAddonMod_Roundabouts_OneWayRoads_Plugin.dat" ${round3} 3 0 0 1
    ${SetComponentState} "INRUL Overrides\NetworkAddonMod_Roundabouts_OneWayRoads_Plugin_INRULs.dat" ${round3} 3 0 0 1
    ${SetComponentState} "Roundabouts\NetworkAddonMod_Roundabouts_Turbo_Plugin.dat" ${round5} 3 0 32 0
    ${SetComponentState} "Turning Lanes\NetworkAddonMod_TurningLanes_Roads_Plugin.dat" ${turn2} 3 0 0 1
    ${SetComponentState} "Turning Lanes\NetworkAddonMod_TurningLanes_Avenues_Plugin.dat" ${turn1} 3 0 0 1
	${SetComponentState} "INRUL Overrides\NetworkAddonMod_TurningLanes_Avenues_Plugin_INRULs.dat" ${turn1} 3 0 0 1
    ${SetComponentState} "Turning Lanes\NetworkAddonMod_TurningLanes_Extension_Plugin.dat" ${turn3} 3 0 0 1
;    ${SetComponentState} "Turning Lanes\NetworkAddonMod_TurningLanes_Extension_Plugin_Advanced.dat" ${turn4} 3 0 33 0
    ${SetComponentState} "Turning Lanes\NetworkAddonMod_TurningLanes_OneWayRoadSignalization_Plugin.dat" ${turn5} 3 0 34 1
    ${SetComponentState} "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_Roads_Plugin.dat" ${curve1} 3 0 0 1
    ${SetComponentState} "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_Rails_Plugin.dat" ${curve2} 3 0 0 1
    ${SetComponentState} "Wide Radius Curves\NetworkAddonMod_WideRadiusCurves_Monorail_Plugin.dat" ${curve3} 3 0 31 0
    StrCpy $LastLoadDir 1
    ${SetComponentState} "El Rail Alternate Implementation" ${elrail_alt1} 2 1 0 0
    ${IfNot} ${SectionIsSelected} ${elrail_alt1}
      Call DisableElRailAltOptions
    ${EndIf}
    ${SetComponentState} "El Rail Alternate Implementation\z ML JPN ELR T21 Catenary Prop.dat" ${elrail_alt2} 2 0 0 0
    ${SetComponentState} "El Rail Alternate Implementation\z ML JPN ELR T21 Fence Prop.dat" ${elrail_alt3} 2 0 0 0
    ${SetComponentState} "El Rail Alternate Implementation\z Ground Texture.dat" ${elrail_alt4} 2 0 0 0
    ${SetComponentState} "El Rail Alternate Implementation\Cool Color Concrete Texture.dat" ${elrail_alt5} 2 0 0 0
    !insertmacro UMUI_IF_INSTALLFLAG_ISNOT ${UMUI_CUSTOM}
      StrCpy $0 0
      ${IfThen} ${SectionIsSelected} ${elrail_alt1} ${|} IntOp $0 $0 + 1 ${|}
      ${IfThen} ${SectionIsSelected} ${elrail_alt2} ${|} IntOp $0 $0 + 1 ${|}
      ${IfThen} ${SectionIsSelected} ${elrail_alt3} ${|} IntOp $0 $0 + 1 ${|}
      ${IfThen} ${SectionIsSelected} ${elrail_alt4} ${|} IntOp $0 $0 + 1 ${|}
      ${IfThen} ${SectionIsSelected} ${elrail_alt5} ${|} IntOp $0 $0 + 1 ${|}
      ${If} $0 = 5
        SectionSetFlags ${elrail1} ${SF_SELECTED}
      ${EndIf}
    !insertmacro UMUI_ENDIF_INSTALLFLAG
    StrCpy $LastLoadDir 0
    ${If} ${SectionIsSelected} ${elrail_alt1}
      Call EnableElRailAltOptions
    ${EndIf}
  ${Else}
    Call SelectDrivingSide
  ${EndIf}
  ${IfThen} ${SectionIsSelected} ${btm1} ${|} StrCpy $InstalledBTM 1 ${|}
  ${IfThen} ${SectionIsSelected} ${plugin6} ${|} StrCpy $InstalledDoubleHeightMonorail 1 ${|}
  ${IfThen} ${SectionIsSelected} ${elrail3} ${|} StrCpy $InstalledDoubleHeightElRail 1 ${|}
  ${IfThen} ${SectionIsSelected} ${sec26} ${|} StrCpy $InstalledElevatedRoad 1 ${|}
  ${IfThen} ${SectionIsSelected} ${elrail2a} ${|} StrCpy $InstalledElRailOverAvenue 1 ${|}
  ${IfThen} ${SectionIsSelected} ${elrail2} ${|} StrCpy $InstalledElRailOverRoad 1 ${|}
  ${IfThen} ${SectionIsSelected} ${tram1} ${|} StrCpy $InstalledGLR 1 ${|}
  ${IfThen} ${SectionIsSelected} ${sec30} ${|} StrCpy $InstalledHSR 1 ${|}
  ${If} ${SectionIsSelected} ${sec20}
  ${OrIf} ${SectionIsPartiallySelected} ${sec20}
    StrCpy $InstalledNWM 1
  ${EndIf} 
  ${If} ${SectionIsSelected} ${sec19}
  ${OrIf} ${SectionIsPartiallySelected} ${sec19}
    StrCpy $InstalledRHW 1
  ${EndIf}
  ${If} ${SectionIsSelected} ${sec21}
  ${OrIf} ${SectionIsPartiallySelected} ${sec21}
    StrCpy $InstalledSAM 1
  ${EndIf}
  ${IfThen} ${SectionIsSelected} ${rail2} ${|} StrCpy $InstalledSTR 1 ${|}
  ${IfThen} ${SectionIsSelected} ${tram2} ${|} StrCpy $InstalledTramInAvenue 1 ${|}
  ${IfThen} ${SectionIsSelected} ${tram3} ${|} StrCpy $InstalledTramInRoad 1 ${|}
  ${IfThen} ${SectionIsSelected} ${tram4} ${|} StrCpy $InstalledTramInStreet 1 ${|}
  ${IfThen} ${SectionIsSelected} ${rail6} ${|} StrCpy $InstalledViaductRail 1 ${|}

  Call .onSelChange
  ClearErrors
  ReadRegDWORD $0 HKCU "Software\Network Addon Mod" "Decoupled Networks and Rules"
  ${If} $0 = 1
    !insertmacro SelectSection ${sec25}
  ${EndIf}
  ClearErrors
  ReadRegDWORD $0 HKCU "Software\Network Addon Mod" "NAM Standard Stations"
  IfErrors SetStandard 0
  ${If} $0 = 0
    !insertmacro UnselectSection ${sec36}
  ${Else}
SetStandard:
    !insertmacro SelectSection ${sec36}
  ${EndIf}
  ${If} $NewNAM > 0
    !insertmacro SelectSection ${sec4}
    !insertmacro SetSectionFlag ${sec4} ${SF_RO}
  ${EndIf}
  ${If} ${SectionIsSelected} ${monorail4}
  ${AndIfNot} ${SectionIsSelected} ${btm1}
    !insertmacro UnselectSection ${monorail4}
  ${EndIf}
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_MINIMAL}|${UMUI_CUSTOM}
    StrCpy $WriteController 0
    Call ProcessController
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  Call SaveRNetworkState
FunctionEnd

Function CheckTSCT
  StrCpy $0 "$INSTDIR\install.log"       ;First, let's save the installation log.
  Push $0
  Call DumpLog
  !insertmacro UMUI_IF_INSTALLFLAG_IS ${UMUI_MINIMAL}
    MessageBox MB_YESNO|MB_ICONQUESTION "Do you want to customize your traffic simulator?" IDNO GameOver
    Call LaunchTSCT
GameOver:
    Abort
  !insertmacro UMUI_ENDIF_INSTALLFLAG
  !insertmacro INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field 3" "Bottom" "145"
  !insertmacro INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field 4" "Top" "145"
  !insertmacro INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field 4" "Bottom" "170"
  ${If} $CustomizeSimulator = 0
    !insertmacro INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field 3" "State" "0"
  ${EndIf}
  ${If} $NewNam = 0
    !insertmacro INSTALLOPTIONS_WRITE "ioSpecial.ini" "Field 4" "State" "0"
  ${EndIf}
FunctionEnd

Var TSCTDir
Var TSCTTry

Function LaunchTSCT
  StrCpy $TSCTTry 0
  Push $1
TSCT_again:
  ClearErrors
  ReadRegStr $TSCTDir HKCU "Software\Traffic Simulator Configuration Tool" "Install Path"
  IfErrors +2
  IfFileExists "$TSCTDir\TSCT.jar" TSCT_Found
  ${If} $TSCTTry = 1
    Pop $1
    return
  ${EndIf}
  ${If} $CustomizeSimulator = 0
    GetTempFileName $0 $ProgramFiles
    IfFileExists $0 Select_Custom
    MessageBox MB_YESNO|MB_ICONEXCLAMATION 'WARNING:  Your selection requires installing the Traffic Simulator Configuration Tool.  Normally, this is installed in the Program Files folder.  However, you do not have permission to write into this folder.  Select "Yes" to continue with this selection, and select a folder such as "My Documents" when prompted later on, or select "No" to skip the installation of this tool at this time.' IDYES Select_Custom
    Return
Select_Custom:
    Delete $0
  ${EndIf}
Install_TSCT:
  ${If} $TSCTDir != ""
    RMDir /r "$TSCTDir/*"
  ${EndIf}
  Strcpy $R0 0
  Strcpy $R1 0
  StrCpy $0 "TSCT_Setup.exe"
  SetOutPath "$INSTDIR"
  SetOverwrite on
  File "Tools\TSCT_Setup.exe"
  ClearErrors
  ExecWait $0 $1
  Delete "$INSTDIR\TSCT_Setup.exe"
  IfErrors 0 Set_TSCT
  ${If} $1 <> 0
    Pop $1
    Return
  ${EndIf}
Set_TSCT:
  ClearErrors
  GetFileTime "$TSCTDir\TSCT.jar" $R2 $R3
  IfErrors 0 +2
  Return
  ${IfThen} $R0 = $R2 ${|} Return ${|}             ;Installation failed - old version still present
  WriteRegDWORD HKCU "Software\Traffic Simulator Configuration Tool" "Version Time Stamp" $R2
  SetShellVarContext current
  CopyFiles "$SMPROGRAMS\Maxis\SimCity 4\Traffic Simulator Configuration Tool.lnk" $INSTDIR
  SetShellVarContext all
  CopyFiles "$INSTDIR\Traffic Simulator Configuration Tool.lnk" "$SMPROGRAMS\Network Addon Mod"
  SetShellVarContext current
  StrCpy $TSCTTry 1
  goto TSCT_again

TSCT_found:
  GetFileTime "$TSCTDir\TSCT.jar" $R0 $R1
  ClearErrors
  ReadRegDWORD $0 HKCU "Software\Traffic Simulator Configuration Tool" "Version Time Stamp"
  IfErrors 0 +2
  goto Install_TSCT
  ${IfThen} $0 <> $R0 ${|} goto Install_TSCT ${|}
  SetShellVarContext current
  StrCpy $OUTDIR $TSCTDir
  ExecShell "open" "$TSCTDir\TSCT.bat"
  Pop $1
FunctionEnd

!define LVM_GETITEMCOUNT 0x1004
!define LVM_GETITEMTEXT 0x102D
 
Function DumpLog
  Exch $5
  Push $0
  Push $1
  Push $2
  Push $3
  Push $4
  Push $6
 
  FindWindow $0 "#32770" "" $HWNDPARENT
  GetDlgItem $0 $0 1016
  StrCmp $0 0 exit
  FileOpen $5 $5 "w"
  StrCmp $5 "" exit
    SendMessage $0 ${LVM_GETITEMCOUNT} 0 0 $6
    System::Alloc ${NSIS_MAX_STRLEN}
    Pop $3
    StrCpy $2 0
    System::Call "*(i, i, i, i, i, i, i, i, i) i \
      (0, 0, 0, 0, 0, r3, ${NSIS_MAX_STRLEN}) .r1"
    loop: StrCmp $2 $6 done
      System::Call "User32::SendMessageA(i, i, i, i) i \
        ($0, ${LVM_GETITEMTEXT}, $2, r1)"
      System::Call "*$3(&t${NSIS_MAX_STRLEN} .r4)"
      FileWrite $5 "$4$\r$\n"
      IntOp $2 $2 + 1
      Goto loop
    done:
      FileClose $5
      System::Free $1
      System::Free $3
  exit:
    Pop $6
    Pop $4
    Pop $3
    Pop $2
    Pop $1
    Pop $0
    Exch $5
FunctionEnd
